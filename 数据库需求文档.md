# 📊 数据库需求说明

**时间**: 2025-12-05 07:45

---

## 当前使用的数据库

### ✅ SQLite（已实现）
**用途**: 本地数据缓存
- 股票列表缓存
- 更新日志
- 轻量级，无需额外安装

**位置**: `backend/data/stock_list.db`

**优点**:
- 零配置，开箱即用
- 文件型数据库，易于备份
- 适合单机应用

---

## 未来可能需要的数据库

### 📝 Redis（可选）
**用途**: 高速缓存和会话管理

**使用场景**:
1. **热榜数据缓存**
   ```python
   # 缓存东财热度（5分钟过期）
   redis.setex('eastmoney_hot', 300, json.dumps(data))
   ```

2. **API限流**
   ```python
   # 限制每分钟请求次数
   redis.incr(f'rate_limit:{user_id}')
   redis.expire(f'rate_limit:{user_id}', 60)
   ```

3. **实时数据推送**
   ```python
   # 发布订阅模式
   redis.publish('stock_updates', message)
   ```

**是否必需**: ❌ 不必需
- 当前SQLite足够
- 只有高并发时才需要

**安装方法**:
```bash
# Windows
# 下载Redis for Windows
# 或使用Docker
docker run -d -p 6379:6379 redis

# Python客户端
pip install redis
```

---

### 📝 MongoDB（可选）
**用途**: 文档型数据库

**使用场景**:
1. **新闻数据存储**
   ```javascript
   {
     "_id": ObjectId("..."),
     "stock_code": "SH600519",
     "title": "贵州茅台发布财报",
     "content": "...",
     "publish_time": ISODate("2025-12-05"),
     "tags": ["财报", "白酒"],
     "sentiment": 0.8
   }
   ```

2. **分析报告存储**
   ```javascript
   {
     "_id": ObjectId("..."),
     "stock_code": "SH600519",
     "report_type": "综合分析",
     "agents": [
       {"role": "news_analyst", "output": "..."},
       {"role": "technical_analyst", "output": "..."}
     ],
     "create_time": ISODate("2025-12-05")
   }
   ```

3. **用户数据存储**
   ```javascript
   {
     "_id": ObjectId("..."),
     "username": "user123",
     "favorites": ["SH600519", "SZ000858"],
     "settings": {...}
   }
   ```

**是否必需**: ❌ 不必需
- SQLite可以存储JSON
- 只有数据量大时才需要

**安装方法**:
```bash
# Windows
# 下载MongoDB Community Edition
# 或使用Docker
docker run -d -p 27017:27017 mongo

# Python客户端
pip install pymongo
```

---

## 推荐方案

### 🎯 当前阶段（开发/小规模）
```
只使用 SQLite ✅
```

**理由**:
- 零配置，开箱即用
- 足够满足当前需求
- 易于开发和调试

---

### 🎯 未来扩展（生产/大规模）
```
SQLite + Redis + MongoDB
```

**使用场景**:
- **SQLite**: 基础数据（股票列表、配置）
- **Redis**: 热数据缓存（热榜、实时行情）
- **MongoDB**: 大量文档（新闻、报告、用户数据）

---

## 数据存储规划

### 当前（SQLite）
```
backend/data/
├── stock_list.db          # 股票列表
└── (未来可扩展)
    ├── news.db            # 新闻数据
    ├── reports.db         # 分析报告
    └── trades.db          # 模拟交易
```

### 未来（混合方案）
```
SQLite:
  - 股票列表（5000条）
  - 系统配置
  - 用户设置

Redis:
  - 热榜缓存（实时）
  - API限流
  - 会话管理

MongoDB:
  - 新闻数据（百万级）
  - 分析报告（十万级）
  - 用户数据（可扩展）
```

---

## 性能对比

| 数据库 | 读取速度 | 写入速度 | 适用场景 |
|--------|---------|---------|---------|
| SQLite | 快 | 中 | 小数据量，单机 |
| Redis | 极快 | 极快 | 缓存，实时数据 |
| MongoDB | 快 | 快 | 大数据量，文档型 |

---

## 结论

### ✅ 当前只需要 SQLite
- 已实现股票列表缓存
- 自动更新机制
- 足够满足需求

### 📝 未来可选扩展
- **Redis**: 高并发时添加
- **MongoDB**: 数据量大时添加
- **都不是必需的**

---

## 自动更新机制

### ✅ 已实现
```python
# 启动时自动检查
if cache.need_update():
    cache.update_stock_list()

# 检查逻辑
1. 数据库为空 → 立即更新
2. 距上次更新超过24小时 → 自动更新
3. 否则 → 使用缓存
```

### 更新时机
- ✅ 首次启动：自动下载
- ✅ 每天启动：自动检查并更新
- ✅ 无需手动操作

---

**总结**: 当前只用SQLite，无需Redis和MongoDB！
