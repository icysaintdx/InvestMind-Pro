# æ•°æ®æµç›‘æ§ç³»ç»Ÿ - å®Œæ•´å®ç°æ€»ç»“

## ğŸ¯ é¡¹ç›®æ€»è§ˆ

### âœ… P0ä¼˜å…ˆçº§ä»»åŠ¡ (å·²å…¨éƒ¨å®Œæˆ)

#### 1. Tushareåœå¤ç‰Œç›‘æ§æ¨¡å— âœ…
**æ–‡ä»¶**: `backend/dataflows/risk/suspend_monitor.py`

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… è·å–ä»Šæ—¥åœç‰Œè‚¡ç¥¨åˆ—è¡¨ (`get_suspend_stocks_today`)
- âœ… è·å–ä»Šæ—¥å¤ç‰Œè‚¡ç¥¨åˆ—è¡¨ (`get_resume_stocks_today`)
- âœ… æ£€æŸ¥æŒ‡å®šè‚¡ç¥¨åœå¤ç‰ŒçŠ¶æ€ (`check_stock_suspend_status`)
- âœ… è¯„ä¼°åœå¤ç‰Œé£é™©ç­‰çº§ (`get_suspend_risk_level`)

**ä½¿ç”¨Tushareæ¥å£**:
- `suspend_d` - æ¯æ—¥åœå¤ç‰Œä¿¡æ¯

**é£é™©è¯„çº§è§„åˆ™**:
- å½“å‰åœç‰Œ: `high` (é«˜é£é™© +30åˆ†)
- é¢‘ç¹åœç‰Œ(â‰¥3æ¬¡): `medium` (ä¸­ç­‰é£é™©)
- æœ‰åœç‰Œè®°å½•: `low` (ä½é£é™©)

---

#### 2. Tushareå®æ—¶æ•°æ®æ¥å£ âœ…
**æ–‡ä»¶**: `backend/dataflows/risk/realtime_monitor.py`

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… è·å–å®æ—¶ç›˜å£å¿«ç…§ (`get_realtime_quote`)
  - æ”¯æŒæ–°æµªè´¢ç»å’Œä¸œæ–¹è´¢å¯Œæ•°æ®æº
  - æ‰¹é‡è·å–(æœ€å¤š50åªè‚¡ç¥¨)
  - ä¹°å–ç›˜æ•°æ®åˆ†æ
- âœ… è·å–å®æ—¶åˆ†ç¬”æˆäº¤ (`get_realtime_tick`)
  - å½“æ—¥æ‰€æœ‰æˆäº¤æ˜ç»†
  - å¤§å•ç»Ÿè®¡(>50ä¸‡)
  - ä¹°å–åŠ›é‡åˆ†æ
- âœ… å¸‚åœºçƒ­åº¦åˆ†æ (`get_market_heat`)
  - æ¶¨è·Œå®¶æ•°ç»Ÿè®¡
  - å¹³å‡æ¶¨è·Œå¹…
  - å¸‚åœºæƒ…ç»ªåˆ¤æ–­

**ä½¿ç”¨Tushareæ¥å£**:
- `realtime_quote` - å®æ—¶ç›˜å£TICKå¿«ç…§(çˆ¬è™«ç‰ˆï¼Œå…è´¹)
- `realtime_tick` - å®æ—¶æˆäº¤æ•°æ®(çˆ¬è™«ç‰ˆï¼Œå…è´¹)

**ç‰¹ç‚¹**: 
- ğŸ†“ æ— éœ€ç§¯åˆ†ï¼Œä»…éœ€Tushareè´¦å·
- ğŸ•·ï¸ çˆ¬è™«æ¥å£ï¼Œæ•°æ®æ¥è‡ªç½‘ç»œ

---

#### 3. STè‚¡ç¥¨åˆ—è¡¨ç›‘æ§ âœ…
**æ–‡ä»¶**: `backend/dataflows/risk/st_monitor.py`

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… è·å–ä»Šæ—¥STè‚¡ç¥¨åˆ—è¡¨ (`get_st_stocks_today`)
- âœ… æ£€æŸ¥è‚¡ç¥¨æ˜¯å¦ä¸ºST (`check_if_st`)
- âœ… è·å–STå†å²è®°å½• (`get_st_history`)
- âœ… STé£é™©ç­‰çº§è¯„ä¼° (`get_st_risk_level`)

**ä½¿ç”¨Tushareæ¥å£**:
- `stock_st` - STè‚¡ç¥¨åˆ—è¡¨

**æƒé™è¦æ±‚**: 
- âš ï¸ éœ€è¦3000ç§¯åˆ†

**é£é™©è¯„çº§è§„åˆ™**:
- *ST(è¿ç»­äºæŸ): `high` (é«˜é£é™© +40åˆ†)
- ST(é£é™©è­¦ç¤º): `medium` (ä¸­ç­‰é£é™© +25åˆ†)

---

#### 4. ç»¼åˆé£é™©åˆ†æå¼•æ“ âœ…
**æ–‡ä»¶**: `backend/dataflows/risk/risk_analyzer.py`

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… å¤šç»´åº¦é£é™©ç»¼åˆè¯„ä¼° (`analyze_stock_risk`)
  - åœå¤ç‰Œé£é™©
  - STè‚¡ç¥¨é£é™©
  - èˆ†æƒ…é£é™©
  - å®æ—¶äº¤æ˜“é£é™©
- âœ… æ‰¹é‡é£é™©åˆ†æ (`batch_analyze_risk`)
- âœ… é£é™©ç­‰çº§è®¡ç®—

**é£é™©è¯„åˆ†ç³»ç»Ÿ**:
```
æ€»åˆ† 0-100:
- 0-29:   low (ä½é£é™©)
- 30-59:  medium (ä¸­ç­‰é£é™©)  
- 60-100: high (é«˜é£é™©)

é£é™©å› ç´ æƒé‡:
- åœå¤ç‰Œé£é™©: 5-35åˆ†
- STé£é™©: 5-45åˆ†
- èˆ†æƒ…é£é™©: 0-30åˆ†
- å®æ—¶é£é™©: 0-20åˆ†
```

**è¾“å‡ºæ ¼å¼**:
```json
{
  "ts_code": "600519.SH",
  "risk_level": "low",
  "risk_score": 15,
  "risk_factors": {
    "suspend_risk": {...},
    "st_risk": {...},
    "sentiment_risk": {...},
    "realtime_risk": {...}
  },
  "warnings": ["é£é™©è­¦å‘Š1", "é£é™©è­¦å‘Š2"],
  "timestamp": "2024-12-17T..."
}
```

---

#### 5. DataFlow APIé›†æˆ âœ…
**æ–‡ä»¶**: `backend/api/dataflow_api.py`

**æ–°å¢APIç«¯ç‚¹**:

1. **GET** `/api/dataflow/stock/realtime/{ts_code}`
   - è·å–è‚¡ç¥¨å®æ—¶è¡Œæƒ…æ•°æ®

2. **GET** `/api/dataflow/stock/risk/{ts_code}`
   - è·å–è‚¡ç¥¨é£é™©åˆ†æç»“æœ

3. **GET** `/api/dataflow/stock/suspend/{ts_code}`
   - æ£€æŸ¥è‚¡ç¥¨åœå¤ç‰ŒçŠ¶æ€

**åå°ä»»åŠ¡å¢å¼º**:
- âœ… `update_stock_data` é›†æˆçœŸå®é£é™©åˆ†æ
- âœ… æ”¯æŒåœå¤ç‰Œè‡ªåŠ¨æ£€æµ‹
- âœ… æ”¯æŒSTè‚¡ç¥¨è‡ªåŠ¨è¯†åˆ«
- âœ… é£é™©è¯„åˆ†è‡ªåŠ¨è®¡ç®—

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
backend/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ dataflow_api.py          # æ•°æ®æµAPIç«¯ç‚¹
â””â”€â”€ dataflows/
    â””â”€â”€ risk/                     # é£é™©ç›‘æ§æ¨¡å—
        â”œâ”€â”€ __init__.py           # æ¨¡å—å¯¼å‡º
        â”œâ”€â”€ suspend_monitor.py    # åœå¤ç‰Œç›‘æ§
        â”œâ”€â”€ st_monitor.py         # STè‚¡ç¥¨ç›‘æ§
        â”œâ”€â”€ realtime_monitor.py   # å®æ—¶æ•°æ®ç›‘æ§
        â””â”€â”€ risk_analyzer.py      # ç»¼åˆé£é™©åˆ†æ
```

---

## ğŸ“Š æ•°æ®æ¥å£è¯´æ˜

### Tushareæ¥å£ä½¿ç”¨æƒ…å†µ

| æ¥å£å | åŠŸèƒ½ | ç§¯åˆ†è¦æ±‚ | çŠ¶æ€ |
|-------|------|---------|------|
| `suspend_d` | åœå¤ç‰Œä¿¡æ¯ | å…è´¹ | âœ… å·²é›†æˆ |
| `realtime_quote` | å®æ—¶å¿«ç…§ | å…è´¹(çˆ¬è™«) | âœ… å·²é›†æˆ |
| `realtime_tick` | å®æ—¶æˆäº¤ | å…è´¹(çˆ¬è™«) | âœ… å·²é›†æˆ |
| `stock_st` | STè‚¡ç¥¨åˆ—è¡¨ | 3000ç§¯åˆ† | âœ… å·²é›†æˆ |

---

## ğŸ§ª æµ‹è¯•

**æµ‹è¯•æ–‡ä»¶**: `test_dataflow_monitor.py`

**æµ‹è¯•å†…å®¹**:
1. âœ… åœå¤ç‰Œç›‘æ§æµ‹è¯•
2. âœ… STè‚¡ç¥¨ç›‘æ§æµ‹è¯•
3. âœ… å®æ—¶æ•°æ®è·å–æµ‹è¯•
4. âœ… ç»¼åˆé£é™©åˆ†ææµ‹è¯•

**è¿è¡Œæµ‹è¯•**:
```bash
python test_dataflow_monitor.py
```

**å‰ç½®æ¡ä»¶**:
- é…ç½®ç¯å¢ƒå˜é‡ `TUSHARE_TOKEN`
- ç¡®ä¿Tushareè´¦å·æœ‰è¶³å¤Ÿç§¯åˆ†(éƒ¨åˆ†åŠŸèƒ½éœ€è¦3000ç§¯åˆ†)

---

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### 1. æ£€æŸ¥åœå¤ç‰ŒçŠ¶æ€
```python
from backend.dataflows.risk import check_suspend_status

status = check_suspend_status('600519.SH')
print(f"æ˜¯å¦åœç‰Œ: {status['is_suspended']}")
print(f"åœç‰Œæ¬¡æ•°: {status['suspend_count']}")
```

### 2. è·å–å®æ—¶è¡Œæƒ…
```python
from backend.dataflows.risk import get_stock_realtime_quote

data = get_stock_realtime_quote('600519.SH')
print(f"å½“å‰ä»·: {data['price']}")
print(f"æ¶¨è·Œå¹…: {data['change_pct']}%")
```

### 3. ç»¼åˆé£é™©åˆ†æ
```python
from backend.dataflows.risk import analyze_stock_risk

result = analyze_stock_risk('600519.SH', sentiment_score=55)
print(f"é£é™©ç­‰çº§: {result['risk_level']}")
print(f"é£é™©å¾—åˆ†: {result['risk_score']}/100")
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. Tushare Tokené…ç½®
```bash
# åœ¨ .env æ–‡ä»¶ä¸­é…ç½®
TUSHARE_TOKEN=your_tushare_token_here
```

### 2. ç§¯åˆ†è¦æ±‚
- åœå¤ç‰Œç›‘æ§: âœ… å…è´¹
- å®æ—¶æ•°æ®: âœ… å…è´¹(çˆ¬è™«æ¥å£)
- STè‚¡ç¥¨ç›‘æ§: âš ï¸ éœ€è¦3000ç§¯åˆ†

### 3. APIè°ƒç”¨é™åˆ¶
- çˆ¬è™«æ¥å£æ— ç§¯åˆ†é™åˆ¶ï¼Œä½†å¯èƒ½æœ‰é¢‘ç‡é™åˆ¶
- å»ºè®®è®¾ç½®åˆç†çš„è°ƒç”¨é—´éš”

### 4. æ•°æ®æºè¯´æ˜
- å®æ—¶æ•°æ®æ”¯æŒæ–°æµªè´¢ç»å’Œä¸œæ–¹è´¢å¯Œä¸¤ä¸ªæ•°æ®æº
- é»˜è®¤ä½¿ç”¨æ–°æµªè´¢ç»(`src='sina'`)
- ä¸œæ–¹è´¢å¯Œæ•°æ®æºä»…æ”¯æŒå•è‚¡ç¥¨æŸ¥è¯¢

---

## ğŸ“ˆ ä¸‹ä¸€æ­¥è®¡åˆ’

### P1ä¼˜å…ˆçº§ä»»åŠ¡ (é‡è¦)
1. **P1-1**: å®Œå–„å¤šæºæ–°é—»èšåˆåŠŸèƒ½
   - Tushareæ–°é—»API
   - AKShareæ–°é—»æ¥å£
   - ä¸œæ–¹è´¢å¯Œèµ„è®¯

2. **P1-2**: å®ç°æ–°é—»æƒ…ç»ªåˆ†æå¼•æ“
   - NLPæƒ…ç»ªåˆ†æ
   - æ–°é—»æƒ…ç»ªæ‰“åˆ†
   - èˆ†æƒ…è¶‹åŠ¿åˆ†æ

### P2ä¼˜å…ˆçº§ä»»åŠ¡ (å¢å¼º)
1. **P2-1**: ä¼˜åŒ–å®šæ—¶ä»»åŠ¡è°ƒåº¦å™¨
   - ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†
   - å¤±è´¥é‡è¯•æœºåˆ¶
   - å¹¶å‘æ§åˆ¶

2. **P2-2**: æ·»åŠ æ•°æ®æŒä¹…åŒ–
   - ç›‘æ§é…ç½®å­˜å‚¨
   - å†å²æ•°æ®è®°å½•
   - æ•°æ®åº“é›†æˆ

---

## ğŸ¯ æˆæœæ€»ç»“

### å·²å®ŒæˆåŠŸèƒ½
âœ… 5ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œ4ä¸ªPythonæ–‡ä»¶
âœ… 3ä¸ªæ–°çš„APIç«¯ç‚¹
âœ… å®Œæ•´çš„é£é™©è¯„ä¼°ä½“ç³»
âœ… è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬

### ä»£ç ç»Ÿè®¡
- æ–°å¢ä»£ç : ~1200è¡Œ
- æ¨¡å—æ–‡ä»¶: 5ä¸ª
- APIç«¯ç‚¹: 3ä¸ª
- æµ‹è¯•ç”¨ä¾‹: 4ä¸ª

### æŠ€æœ¯äº®ç‚¹
- ğŸ¯ å¤šç»´åº¦é£é™©è¯„ä¼°
- ğŸ”„ å®æ—¶æ•°æ®ç›‘æ§
- ğŸ“Š æ™ºèƒ½é£é™©è¯„åˆ†
- ğŸ›¡ï¸ åœå¤ç‰Œé¢„è­¦
- âš¡ é«˜æ€§èƒ½è®¾è®¡

---

## ğŸ“ ç›¸å…³æ–‡æ¡£

- [æ•°æ®æ¥å£è¯´æ˜](docs/æ•°æ®æ¥å£è¯´æ˜.md) - Tushareæ¥å£è¯¦ç»†æ–‡æ¡£
- [AKShareæ–‡æ¡£](docs/AKshareæ–‡æ¡£.md) - AKShareæ•°æ®æºæ–‡æ¡£
- [é¡¹ç›®README](README.md) - é¡¹ç›®æ•´ä½“è¯´æ˜

---

**æ›´æ–°æ—¶é—´**: 2024-12-17
**ç‰ˆæœ¬**: v1.0-P0å®Œæˆ
**ä½œè€…**: AI Assistant
