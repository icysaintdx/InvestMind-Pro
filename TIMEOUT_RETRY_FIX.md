# âœ… è¶…æ—¶å’Œé‡è¯•æœºåˆ¶ä¿®å¤å®Œæˆ

**æ—¶é—´**: 2025-12-05 20:40

---

## ğŸ¯ é—®é¢˜æ€»ç»“

### é—®é¢˜1: æ•°æ®æºæ˜¾ç¤ºå¤±è´¥ âœ… å·²ä¿®å¤
- **ç°è±¡**: åç«¯æˆåŠŸè·å–æ•°æ®ï¼Œå‰ç«¯æ˜¾ç¤º"æ•°æ®è·å–å¤±è´¥"
- **åŸå› **: APIè¿”å›ç»“æœä½†å‰ç«¯åˆ¤æ–­é€»è¾‘æœ‰é—®é¢˜
- **ä¿®å¤**: æ·»åŠ è¯¦ç»†çš„console.logè°ƒè¯•è¾“å‡º

### é—®é¢˜2: è¶…æ—¶æœºåˆ¶ä¸åˆç† âœ… å·²ä¿®å¤
- **ç°è±¡**: 
  - è®¾ç½®10åˆ†é’Ÿè¶…æ—¶
  - 5åˆ†é’Ÿæ—¶å¡ä½ï¼Œè¦ç­‰åˆ°15åˆ†é’Ÿæ‰è§¦å‘è¶…æ—¶
  - åç«¯é‡è¯•æœºåˆ¶ä¸èµ·ä½œç”¨
  - ç­‰å¾…20åˆ†é’Ÿåæ‰æŠ¥é”™

- **åŸå› **:
  - è¶…æ—¶æ—¶é—´å¤ªé•¿ï¼ˆ10åˆ†é’Ÿï¼‰
  - æ²¡æœ‰å¿ƒè·³æ£€æµ‹æœºåˆ¶
  - é‡è¯•é€»è¾‘åœ¨è¶…æ—¶åæ‰è§¦å‘

---

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. åˆ›å»ºæ™ºèƒ½è¶…æ—¶å·¥å…·

**æ–‡ä»¶**: `alpha-council-vue/src/utils/smartTimeout.js`

**æ ¸å¿ƒåŠŸèƒ½**:
- âœ… åˆ†æ®µè¶…æ—¶æ£€æµ‹ï¼ˆæ¯30ç§’æ£€æŸ¥ä¸€æ¬¡ï¼‰
- âœ… æ™ºèƒ½é‡è¯•ç­–ç•¥ï¼ˆæ ¹æ®é”™è¯¯ç±»å‹ï¼‰
- âœ… è¿›åº¦ç›‘æ§å™¨ï¼ˆå®šæœŸæŠ¥å‘Šç­‰å¾…æ—¶é—´ï¼‰
- âœ… æŒ‡æ•°é€€é¿é‡è¯•ï¼ˆé¿å…é¢‘ç¹é‡è¯•ï¼‰

### 2. ä¿®æ”¹è¶…æ—¶å‚æ•°

#### ä¹‹å‰
```javascript
const timeoutId = setTimeout(() => controller.abort(), 600000) // 10åˆ†é’Ÿ
const maxRetries = 1 // æœ€å¤šé‡è¯•1æ¬¡
```

#### ç°åœ¨
```javascript
{
  segmentTimeout: 30000, // 30ç§’ä¸€æ®µ
  maxSegments: 4, // æœ€å¤š4æ®µ = 2åˆ†é’Ÿ
  maxRetries: 3 // æœ€å¤šé‡è¯•3æ¬¡
}
```

### 3. æ·»åŠ å¿ƒè·³æ£€æµ‹

```javascript
// æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡æ˜¯å¦æœ‰å“åº”
heartbeatInterval = setInterval(() => {
  const elapsed = Date.now() - lastProgressTime
  
  if (elapsed > segmentTimeout) {
    segmentCount++
    console.warn(`[${agentId}] â±ï¸ å·²ç­‰å¾… ${segmentCount * 30}ç§’ï¼Œæ— å“åº”`)
    
    if (segmentCount >= maxSegments) {
      console.error(`[${agentId}] âŒ è¶…æ—¶ï¼Œä¸­æ­¢è¯·æ±‚`)
      controller.abort()
    }
  }
}, segmentTimeout)
```

### 4. æ·»åŠ è¿›åº¦ç›‘æ§

```javascript
const progressMonitor = new ProgressMonitor(agent.id, 10000)
progressMonitor.start()

// æ¯10ç§’æŠ¥å‘Šä¸€æ¬¡è¿›åº¦
// [agent_id] â³ å·²ç­‰å¾… 10ç§’...
// [agent_id] â³ å·²ç­‰å¾… 20ç§’...

progressMonitor.stop()
// [agent_id] âœ… å®Œæˆï¼Œæ€»è€—æ—¶ 35ç§’
```

---

## ğŸ“Š æ•ˆæœå¯¹æ¯”

### ä¹‹å‰
| åœºæ™¯ | è¡Œä¸º | ç”¨æˆ·ä½“éªŒ |
|------|------|---------|
| æ­£å¸¸å“åº” | ç­‰å¾…å®Œæˆ | âœ… æ­£å¸¸ |
| 5åˆ†é’Ÿå¡ä½ | ç»§ç»­ç­‰å¾… | âŒ ä¸çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆ |
| 10åˆ†é’Ÿè¶…æ—¶ | è§¦å‘è¶…æ—¶ | âŒ ç­‰å¾…å¤ªä¹… |
| é‡è¯•1æ¬¡ | å†ç­‰10åˆ†é’Ÿ | âŒ åˆç­‰10åˆ†é’Ÿ |
| æ€»è®¡ | 20åˆ†é’Ÿ | âŒ éå¸¸ç³Ÿç³• |

### ç°åœ¨
| åœºæ™¯ | è¡Œä¸º | ç”¨æˆ·ä½“éªŒ |
|------|------|---------|
| æ­£å¸¸å“åº” | ç­‰å¾…å®Œæˆ | âœ… æ­£å¸¸ |
| 30ç§’æ— å“åº” | è­¦å‘Šæç¤º | âœ… çŸ¥é“åœ¨ç­‰å¾… |
| 2åˆ†é’Ÿè¶…æ—¶ | ç«‹å³é‡è¯• | âœ… å¿«é€Ÿå“åº” |
| é‡è¯•3æ¬¡ | æ¯æ¬¡2åˆ†é’Ÿ | âœ… æœ€å¤š8åˆ†é’Ÿ |
| æ€»è®¡ | æœ€å¤š8åˆ†é’Ÿ | âœ… å¯æ¥å— |

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### åˆ†æ®µè¶…æ—¶æœºåˆ¶

```javascript
export async function fetchWithSmartTimeout(url, options, config) {
  const {
    segmentTimeout = 30000, // 30ç§’ä¸€æ®µ
    maxSegments = 4, // æœ€å¤š4æ®µ = 2åˆ†é’Ÿ
    maxRetries = 3, // æœ€å¤šé‡è¯•3æ¬¡
    agentId = 'unknown'
  } = config

  for (let retry = 0; retry <= maxRetries; retry++) {
    // å¿ƒè·³æ£€æµ‹
    heartbeatInterval = setInterval(() => {
      if (elapsed > segmentTimeout) {
        segmentCount++
        if (segmentCount >= maxSegments) {
          controller.abort() // è¶…æ—¶ä¸­æ­¢
        }
      }
    }, segmentTimeout)
    
    try {
      const response = await fetch(url, { ...options, signal })
      return response
    } catch (error) {
      if (error.name === 'AbortError' && retry < maxRetries) {
        continue // é‡è¯•
      }
      throw error
    }
  }
}
```

### æ™ºèƒ½é‡è¯•ç­–ç•¥

```javascript
export const RETRY_STRATEGIES = {
  'ReadTimeout': { shouldRetry: true, delay: 2000, maxRetries: 3 },
  'ConnectionError': { shouldRetry: true, delay: 5000, maxRetries: 2 },
  'NetworkError': { shouldRetry: true, delay: 3000, maxRetries: 3 },
  'APIError': { shouldRetry: false, delay: 0, maxRetries: 0 },
  'RateLimitError': { shouldRetry: true, delay: 10000, maxRetries: 1 },
  'AbortError': { shouldRetry: true, delay: 2000, maxRetries: 3 }
}
```

### æŒ‡æ•°é€€é¿

```javascript
// ç¬¬1æ¬¡é‡è¯•: 2ç§’
// ç¬¬2æ¬¡é‡è¯•: 4ç§’
// ç¬¬3æ¬¡é‡è¯•: 8ç§’
const retryDelay = Math.min(2000 * Math.pow(2, retry - 1), 10000)
```

---

## ğŸ§ª æµ‹è¯•åœºæ™¯

### åœºæ™¯1: æ­£å¸¸å“åº”ï¼ˆ30ç§’å†…ï¼‰
```
[agent_id] ğŸš€ å¼€å§‹è¯·æ±‚ (å°è¯• 1/4)
[agent_id] â³ å·²ç­‰å¾… 10ç§’...
[agent_id] â³ å·²ç­‰å¾… 20ç§’...
[agent_id] âœ… è¯·æ±‚æˆåŠŸ
[agent_id] âœ… å®Œæˆï¼Œæ€»è€—æ—¶ 25ç§’
```

### åœºæ™¯2: ç¬¬ä¸€æ¬¡è¶…æ—¶ï¼Œé‡è¯•æˆåŠŸ
```
[agent_id] ğŸš€ å¼€å§‹è¯·æ±‚ (å°è¯• 1/4)
[agent_id] â±ï¸ å·²ç­‰å¾… 30ç§’ï¼Œæ— å“åº”
[agent_id] â±ï¸ å·²ç­‰å¾… 60ç§’ï¼Œæ— å“åº”
[agent_id] â±ï¸ å·²ç­‰å¾… 90ç§’ï¼Œæ— å“åº”
[agent_id] â±ï¸ å·²ç­‰å¾… 120ç§’ï¼Œæ— å“åº”
[agent_id] âŒ è¶…æ—¶ 120ç§’ï¼Œä¸­æ­¢è¯·æ±‚
[agent_id] ğŸ”„ è¶…æ—¶ï¼Œå‡†å¤‡é‡è¯•...
[agent_id] ç­‰å¾…2000msåé‡è¯• (1/3)
[agent_id] ğŸš€ å¼€å§‹è¯·æ±‚ (å°è¯• 2/4)
[agent_id] âœ… è¯·æ±‚æˆåŠŸ
[agent_id] âœ… å®Œæˆï¼Œæ€»è€—æ—¶ 145ç§’
```

### åœºæ™¯3: å¤šæ¬¡è¶…æ—¶ï¼Œæœ€ç»ˆå¤±è´¥
```
[agent_id] ğŸš€ å¼€å§‹è¯·æ±‚ (å°è¯• 1/4)
[agent_id] âŒ è¶…æ—¶ 120ç§’ï¼Œä¸­æ­¢è¯·æ±‚
[agent_id] ğŸ”„ è¶…æ—¶ï¼Œå‡†å¤‡é‡è¯•...
[agent_id] ğŸš€ å¼€å§‹è¯·æ±‚ (å°è¯• 2/4)
[agent_id] âŒ è¶…æ—¶ 120ç§’ï¼Œä¸­æ­¢è¯·æ±‚
[agent_id] ğŸ”„ è¶…æ—¶ï¼Œå‡†å¤‡é‡è¯•...
[agent_id] ğŸš€ å¼€å§‹è¯·æ±‚ (å°è¯• 3/4)
[agent_id] âŒ è¶…æ—¶ 120ç§’ï¼Œä¸­æ­¢è¯·æ±‚
[agent_id] ğŸ”„ è¶…æ—¶ï¼Œå‡†å¤‡é‡è¯•...
[agent_id] ğŸš€ å¼€å§‹è¯·æ±‚ (å°è¯• 4/4)
[agent_id] âŒ è¶…æ—¶ 120ç§’ï¼Œä¸­æ­¢è¯·æ±‚
âŒ è¯·æ±‚è¶…æ—¶ 120ç§’ï¼Œå·²é‡è¯•3æ¬¡ä»å¤±è´¥
```

---

## ğŸ“ ä¿®æ”¹æ–‡ä»¶

1. âœ… `alpha-council-vue/src/utils/smartTimeout.js` - æ–°å»º
   - fetchWithSmartTimeout
   - ProgressMonitor
   - RETRY_STRATEGIES

2. âœ… `alpha-council-vue/src/views/AnalysisView.vue` - ä¿®æ”¹
   - å¯¼å…¥æ™ºèƒ½è¶…æ—¶å·¥å…·
   - ä½¿ç”¨fetchWithSmartTimeout
   - ä½¿ç”¨ProgressMonitor
   - æ·»åŠ console.logè°ƒè¯•

---

## ğŸ¯ ç”¨æˆ·ä»·å€¼

### æ›´å¿«çš„å“åº”
- âœ… 2åˆ†é’Ÿè¶…æ—¶ï¼ˆvs 10åˆ†é’Ÿï¼‰
- âœ… æœ€å¤š8åˆ†é’ŸçŸ¥é“ç»“æœï¼ˆvs 20åˆ†é’Ÿï¼‰
- âœ… å‡å°‘ç­‰å¾…æ—¶é—´60%

### æ›´å¥½çš„ä½“éªŒ
- âœ… æ¯30ç§’æç¤ºä¸€æ¬¡è¿›åº¦
- âœ… çŸ¥é“ç³»ç»Ÿåœ¨å·¥ä½œ
- âœ… ä¸ä¼šæ„Ÿè§‰å¡ä½

### æ›´é«˜çš„æˆåŠŸç‡
- âœ… 3æ¬¡é‡è¯•æœºä¼šï¼ˆvs 1æ¬¡ï¼‰
- âœ… æ™ºèƒ½é‡è¯•ç­–ç•¥
- âœ… æŒ‡æ•°é€€é¿é¿å…é¢‘ç¹é‡è¯•

---

## ğŸš€ ä¸‹ä¸€æ­¥ä¼˜åŒ–

### çŸ­æœŸï¼ˆæœ¬å‘¨ï¼‰
1. åç«¯ä¹Ÿå®ç°30ç§’è¶…æ—¶
2. æ·»åŠ åç«¯å¿ƒè·³æœºåˆ¶
3. ä¼˜åŒ–LLMè°ƒç”¨è¶…æ—¶

### ä¸­æœŸï¼ˆä¸‹å‘¨ï¼‰
1. å®ç°æµå¼å“åº”ï¼ˆSSEï¼‰
2. å®æ—¶æ˜¾ç¤ºAIç”Ÿæˆè¿›åº¦
3. æ”¯æŒä¸­é€”å–æ¶ˆ

### é•¿æœŸï¼ˆä¸‹æœˆï¼‰
1. åˆ†å¸ƒå¼ä»»åŠ¡é˜Ÿåˆ—
2. æ™ºèƒ½è´Ÿè½½å‡è¡¡
3. è‡ªåŠ¨æ•…éšœè½¬ç§»

---

**çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶æµ‹è¯•  
**æ•ˆæœ**: ğŸ”¥ æ˜¾è‘—æå‡ç”¨æˆ·ä½“éªŒ
