# 风险数据源开发计划

> **创建时间**: 2025-12-05  
> **目标**: 集成所有免费风险数据源  
> **排序依据**: 重要程度 × 难易度

---

## 📋 开发优先级（按重要性和难度排序）

### 🔥 第一优先级：AKShare快速集成（本周完成）

#### 1. AKShare 失信被执行人 ⭐⭐⭐⭐⭐
- **重要性**: 极高（直接反映偿债能力）
- **难度**: 极低（已封装）
- **预计时间**: 2小时
- **状态**: 待开发

**API**:
```python
import akshare as ak
# 失信被执行人
df = ak.stock_zh_a_shixin()
# 被执行人
df = ak.stock_zh_a_zhixing()
```

**任务**:
- [ ] 创建 `backend/dataflows/risk/akshare_risk.py`
- [ ] 封装失信被执行人查询
- [ ] 封装被执行人查询
- [ ] 创建API端点 `/api/risk/dishonest`
- [ ] 测试验证

---

#### 2. AKShare 裁判文书 ⭐⭐⭐⭐
- **重要性**: 高（法律风险）
- **难度**: 极低（已封装）
- **预计时间**: 1小时
- **状态**: 待开发

**API**:
```python
import akshare as ak
df = ak.stock_zh_a_cpws(symbol="股票代码")
```

**任务**:
- [ ] 集成到 `akshare_risk.py`
- [ ] 创建API端点 `/api/risk/lawsuit`
- [ ] 测试验证

---

#### 3. AKShare 股票新闻（补充） ⭐⭐⭐⭐
- **重要性**: 高（舆情监控）
- **难度**: 极低（已有）
- **预计时间**: 0.5小时
- **状态**: 已集成，需优化

**任务**:
- [ ] 优化现有新闻API
- [ ] 添加风险关键词过滤
- [ ] 测试验证

---

### 🔥 第二优先级：官方数据源（2周内完成）

#### 4. 证监会处罚公告 ⭐⭐⭐⭐⭐
- **重要性**: 极高（直接影响股价）
- **难度**: 低（RSS/网页爬取）
- **预计时间**: 3-4小时
- **状态**: 待开发

**数据源**:
- 网址: http://www.csrc.gov.cn/csrc/c100028/common_list.shtml
- 类型: 行政处罚、市场禁入、立案调查

**任务**:
- [ ] 创建 `backend/dataflows/risk/csrc_crawler.py`
- [ ] 实现RSS订阅或网页爬取
- [ ] 解析处罚公告
- [ ] 创建API端点 `/api/risk/csrc`
- [ ] 测试验证

---

#### 5. 中国执行信息公开网 ⭐⭐⭐⭐⭐
- **重要性**: 极高（失信老赖）
- **难度**: 中等（需要处理反爬虫）
- **预计时间**: 4-5小时
- **状态**: 待开发

**数据源**:
- 网址: http://zxgk.court.gov.cn/
- 类型: 失信被执行人、被执行人、执行案件

**任务**:
- [ ] 创建 `backend/dataflows/risk/zhixing_crawler.py`
- [ ] 分析网站结构和API
- [ ] 实现爬虫（处理反爬虫）
- [ ] 创建API端点 `/api/risk/execution`
- [ ] 测试验证

**参考**: 可能需要处理验证码或Cookie

---

#### 6. 国家企业信用信息公示系统 ⭐⭐⭐⭐⭐
- **重要性**: 极高（经营异常、行政处罚）
- **难度**: 中等（需要处理反爬虫）
- **预计时间**: 4-5小时
- **状态**: 待开发

**数据源**:
- 网址: http://www.gsxt.gov.cn/
- 类型: 行政处罚、经营异常、严重违法

**任务**:
- [ ] 创建 `backend/dataflows/risk/gsxt_crawler.py`
- [ ] 分析网站结构和API
- [ ] 实现爬虫（处理反爬虫）
- [ ] 创建API端点 `/api/risk/credit`
- [ ] 测试验证

**参考**: 需要处理验证码

---

### 🔥 第三优先级：补充数据源（1个月内完成）

#### 7. 交易所监管信息 ⭐⭐⭐⭐
- **重要性**: 高（监管函、处分）
- **难度**: 低（网页爬取）
- **预计时间**: 3-4小时
- **状态**: 待开发

**数据源**:
- 上交所: http://www.sse.com.cn/
- 深交所: http://www.szse.cn/

**任务**:
- [ ] 创建 `backend/dataflows/risk/exchange_crawler.py`
- [ ] 实现上交所爬虫
- [ ] 实现深交所爬虫
- [ ] 创建API端点 `/api/risk/exchange`
- [ ] 测试验证

---

#### 8. 中国裁判文书网 ⭐⭐⭐⭐⭐
- **重要性**: 极高（法律诉讼）
- **难度**: 高（复杂加密）
- **预计时间**: 6-8小时
- **状态**: 框架已完成，待实现加密

**任务**:
- [ ] 移植JavaScript加密算法
- [ ] 实现真实API调用
- [ ] 测试验证
- [ ] 创建API端点 `/api/risk/wenshu`

**备注**: 如果AKShare的裁判文书数据足够，可以降低优先级

---

#### 9. 巨潮资讯网公告 ⭐⭐⭐⭐
- **重要性**: 高（公司公告）
- **难度**: 中等（API已变化）
- **预计时间**: 3-4小时
- **状态**: 需要修复

**任务**:
- [ ] 分析API变化
- [ ] 修复请求参数
- [ ] 测试验证
- [ ] 创建API端点 `/api/announcement/cninfo`

---

### 🔥 第四优先级：其他数据源（按需开发）

#### 10. 生态环境部处罚 ⭐⭐⭐
- **重要性**: 中等（环保风险）
- **难度**: 中等
- **预计时间**: 3-4小时
- **状态**: 低优先级

#### 11. 税务总局违法案件 ⭐⭐⭐
- **重要性**: 中等（税务风险）
- **难度**: 低
- **预计时间**: 2-3小时
- **状态**: 低优先级

---

## 📅 时间规划

### 第1周（本周）- AKShare快速集成
**目标**: 快速上线基础风险数据

- **Day 1-2**: AKShare失信被执行人 + 裁判文书（3小时）
- **Day 3**: 证监会处罚公告（4小时）
- **Day 4-5**: 测试、文档、API集成（4小时）

**交付物**:
- ✅ 失信被执行人查询API
- ✅ 裁判文书查询API
- ✅ 证监会处罚查询API
- ✅ 完整测试和文档

---

### 第2周 - 官方数据源
**目标**: 集成权威数据源

- **Day 1-2**: 中国执行信息公开网（5小时）
- **Day 3-4**: 国家企业信用信息公示系统（5小时）
- **Day 5**: 测试、优化（2小时）

**交付物**:
- ✅ 执行信息查询API
- ✅ 企业信用查询API
- ✅ 风险评分模型v1.0

---

### 第3-4周 - 补充和优化
**目标**: 完善数据源和功能

- **Week 3**: 交易所监管 + 巨潮资讯（7小时）
- **Week 4**: 中国裁判文书网（8小时）

**交付物**:
- ✅ 所有主要数据源集成
- ✅ 风险评分模型v2.0
- ✅ 完整的风险分析报告

---

## 🎯 技术实现方案

### 方案1: AKShare（推荐用于快速集成）
```python
# backend/dataflows/risk/akshare_risk.py
import akshare as ak

class AKShareRiskData:
    """AKShare风险数据封装"""
    
    def get_dishonest_persons(self, company_name: str):
        """获取失信被执行人"""
        df = ak.stock_zh_a_shixin()
        return df[df['公司名称'].str.contains(company_name)]
    
    def get_executed_persons(self, company_name: str):
        """获取被执行人"""
        df = ak.stock_zh_a_zhixing()
        return df[df['公司名称'].str.contains(company_name)]
    
    def get_lawsuits(self, stock_code: str):
        """获取裁判文书"""
        df = ak.stock_zh_a_cpws(symbol=stock_code)
        return df
```

### 方案2: 直接爬取（用于官方网站）
```python
# backend/dataflows/risk/csrc_crawler.py
import requests
from bs4 import BeautifulSoup

class CSRCCrawler:
    """证监会处罚爬虫"""
    
    def get_penalties(self, days: int = 30):
        """获取处罚公告"""
        url = "http://www.csrc.gov.cn/csrc/c100028/common_list.shtml"
        # 实现爬取逻辑
        pass
```

### 方案3: API调用（如果有官方API）
```python
# 优先使用官方API
response = requests.get(api_url, params=params)
data = response.json()
```

---

## 📊 风险评分模型

### v1.0 基础模型（第1周）
```python
风险总分 = (
    失信被执行人数量 * 30 +
    被执行人数量 * 20 +
    证监会处罚次数 * 25 +
    裁判文书数量 * 15 +
    其他风险 * 10
)
```

### v2.0 完整模型（第2周）
```python
风险总分 = (
    失信被执行人 * 0.25 +
    证监会处罚 * 0.20 +
    经营异常 * 0.15 +
    被执行人 * 0.15 +
    重大诉讼 * 0.10 +
    交易所处分 * 0.10 +
    其他风险 * 0.05
)

# 加权因子
- 时间衰减: 越近的风险权重越高
- 金额权重: 涉及金额越大权重越高
- 类型权重: 刑事 > 行政 > 民事
```

---

## 🧪 测试计划

### 单元测试
```python
# test_akshare_risk.py
def test_dishonest_persons():
    """测试失信被执行人查询"""
    pass

def test_executed_persons():
    """测试被执行人查询"""
    pass

def test_lawsuits():
    """测试裁判文书查询"""
    pass
```

### 集成测试
```python
# test_risk_api.py
def test_risk_analysis():
    """测试完整风险分析"""
    pass
```

### 测试公司列表
```python
test_companies = [
    ("贵州茅台", "600519.SH"),
    ("中国平安", "601318.SH"),
    ("乐视网", "300104.SZ"),  # 高风险公司
]
```

---

## 📦 API设计

### 统一风险API
```python
# GET /api/risk/analyze
{
    "company_name": "贵州茅台",
    "stock_code": "600519.SH"
}

# Response
{
    "risk_score": 15,  # 0-100
    "risk_level": "low",  # low/medium/high
    "details": {
        "dishonest": 0,
        "executed": 0,
        "csrc_penalty": 0,
        "lawsuits": 2,
        "credit_abnormal": 0
    },
    "summary": "该公司风险较低，无重大风险事项"
}
```

---

## 📚 文档结构

```
docs/
├── 风险数据源汇总.md          ← 已完成
├── 风险数据源开发计划.md      ← 当前文档
├── AKShare风险数据使用指南.md  ← 待创建
├── 风险评分模型说明.md        ← 待创建
└── 风险API文档.md            ← 待创建
```

---

## 🎉 成功标准

### 第1周目标
- ✅ 3个数据源集成（AKShare + 证监会）
- ✅ 基础风险评分模型
- ✅ 完整的API端点
- ✅ 测试覆盖率 > 80%

### 第2周目标
- ✅ 5个数据源集成
- ✅ 完整风险评分模型
- ✅ 风险分析报告生成
- ✅ 性能优化（响应时间 < 3秒）

### 最终目标
- ✅ 8-10个数据源集成
- ✅ 智能风险预警系统
- ✅ 可视化风险仪表盘
- ✅ 完整的文档和测试

---

## 🚀 立即开始

### 第一步：安装AKShare
```bash
pip install akshare
```

### 第二步：创建基础文件
```bash
mkdir -p backend/dataflows/risk
touch backend/dataflows/risk/__init__.py
touch backend/dataflows/risk/akshare_risk.py
touch test_akshare_risk.py
```

### 第三步：开始编码
从最简单的AKShare开始，快速看到成果！

---

现在开始第一个任务：**AKShare失信被执行人查询**！🚀
