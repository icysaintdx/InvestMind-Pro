# 多维度风险分析系统规划

> 规划时间: 2025-12-04 04:30  
> 状态: 📋 规划中

---

## 🎯 系统目标

构建一个全面的多维度风险分析系统，覆盖：
1. **法律风险** - 诉讼、处罚、合规
2. **运营风险** - 财务、经营、产业链
3. **舆情风险** - 新闻、社交媒体、市场情绪
4. **市场风险** - 资金流向、技术面

---

## 📊 数据源规划

### 一、法律层面数据源

#### 1.1 官方权威平台（免费，需爬虫）

| 数据源 | 数据类型 | 获取方式 | 优先级 |
|--------|---------|---------|--------|
| 中国裁判文书网 | 涉诉判决、裁定 | 爬虫 | 高 |
| 中国执行信息公开网 | 被执行信息 | 爬虫 | 高 |
| 证监会/交易所官网 | 监管处罚、立案调查 | 爬虫 | 高 |
| 国家企业信用信息公示系统 | 工商变更、行政处罚 | 爬虫 | 中 |

#### 1.2 商业API接口（付费）

| 服务商 | 数据类型 | 费用 | 优先级 |
|--------|---------|------|--------|
| 企查查 API | 司法涉诉、被执行人、行政处罚 | 付费 | 中 |
| 天眼查 API | 法律风险数据 | 付费 | 中 |
| 启信宝 API | 法律风险评分 | 付费 | 低 |

**建议**: 优先使用官方免费平台 + 自研爬虫

---

### 二、运营层面数据源

#### 2.1 商业金融数据终端（付费，专业级）

| 服务商 | 数据类型 | 费用 | 优先级 |
|--------|---------|------|--------|
| Wind（万得）API | 财报、机构持仓、大宗交易 | 高 | 低 |
| 同花顺 iFinD API | 财务指标、北向资金、融资融券 | 高 | 低 |
| 东方财富 Choice API | 经营数据、产业链数据 | 中 | 中 |

#### 2.2 官方平台（免费）

| 数据源 | 数据类型 | 获取方式 | 优先级 |
|--------|---------|---------|--------|
| 巨潮资讯网 | 财报、公告、并购重组 | 爬虫 | 高 |
| 行业协会官网 | 行业运营数据 | 爬虫 | 中 |
| AKShare | 财务数据、资金流向 | API（免费） | 高 |
| Tushare | 财务指标、机构持仓 | API（需token） | 高 |

**建议**: 优先使用 AKShare + Tushare + 巨潮资讯网爬虫

---

### 三、舆情层面数据源

#### 3.1 专业舆情API（付费）

| 服务商 | 数据类型 | 费用 | 优先级 |
|--------|---------|------|--------|
| 数行者科技 API | 新闻量化舆情、情感评分 | 付费 | 低 |
| 谷谷数据 AI 舆情 API | 文本情感分析 | 付费 | 低 |
| WallstreetBets API | Reddit 散户讨论（美股） | 免费 | 低 |

#### 3.2 免费爬虫渠道（需自研）

| 数据源 | 数据类型 | 获取方式 | 优先级 |
|--------|---------|---------|--------|
| 证券时报网 | 权威财经新闻 | 爬虫 | 高 |
| 中国证券报 | 权威财经新闻 | 爬虫 | 高 |
| 财新网 | 深度财经报道 | 爬虫 | 中 |
| 东方财富股吧 | 散户讨论、情绪 | 爬虫 | 高 |
| 雪球 | 投资者讨论 | 爬虫 | 高 |
| 微博财经 | 社交媒体舆情 | 爬虫 | 中 |
| 新浪财经 | 新闻聚合 | API/爬虫 | 高 |

**建议**: 优先实现东方财富股吧 + 雪球 + 证券时报

---

### 四、市场与资金数据源

#### 4.1 资金流向数据

| 数据源 | 数据类型 | 获取方式 | 优先级 |
|--------|---------|---------|--------|
| AKShare | 北向资金流向 | API（免费） | 高 |
| Tushare | 机构持仓、大宗交易 | API（需token） | 高 |
| 东方财富网 | 融资融券数据 | 爬虫 | 高 |

#### 4.2 技术面数据

| 数据源 | 数据类型 | 获取方式 | 优先级 |
|--------|---------|---------|--------|
| AKShare | K线数据、成交量 | API（免费） | 高 |
| 新浪财经 | 实时行情 | API（免费） | 高 |

---

## 🔧 代理功能设计

### 需求分析
- Google News、Reddit 等海外网站需要代理
- 海外大模型（OpenAI、Claude等）需要代理
- 不影响国内网站访问速度

### 技术方案

```python
# backend/utils/proxy_config.py

class ProxyManager:
    """代理管理器"""
    
    def __init__(self):
        self.proxies = {
            'http': os.getenv('HTTP_PROXY', ''),
            'https': os.getenv('HTTPS_PROXY', '')
        }
        
        # 需要代理的域名列表
        self.proxy_domains = [
            'google.com',
            'reddit.com',
            'openai.com',
            'anthropic.com',
            'api.openai.com',
            'api.anthropic.com'
        ]
    
    def get_proxies(self, url: str) -> dict:
        """根据URL判断是否需要代理"""
        if any(domain in url for domain in self.proxy_domains):
            return self.proxies if self.proxies['http'] else None
        return None
    
    def make_request(self, url: str, **kwargs):
        """带代理的请求"""
        proxies = self.get_proxies(url)
        if proxies:
            kwargs['proxies'] = proxies
        return requests.get(url, **kwargs)
```

### 配置方式

在 `.env` 文件中添加：
```bash
# 代理配置（可选）
HTTP_PROXY=http://127.0.0.1:7890
HTTPS_PROXY=http://127.0.0.1:7890

# 或者使用 socks5 代理
# HTTP_PROXY=socks5://127.0.0.1:1080
# HTTPS_PROXY=socks5://127.0.0.1:1080
```

---

## 📋 实施计划

### 阶段1: 核心数据源集成（1-2周）

#### 优先级1（本周完成）
- [x] 东方财富新闻 - 已完成
- [x] AKShare 股票数据 - 已完成
- [ ] 东方财富股吧爬虫
- [ ] 雪球讨论爬虫
- [ ] 证券时报新闻爬虫

#### 优先级2（下周完成）
- [ ] 巨潮资讯网公告爬虫
- [ ] 中国裁判文书网爬虫
- [ ] 北向资金流向（AKShare）
- [ ] 融资融券数据（东方财富）

### 阶段2: 代理功能实现（3-5天）

- [ ] 创建 ProxyManager 类
- [ ] 集成到 HTTP 请求中
- [ ] 支持 Google News
- [ ] 支持 Reddit
- [ ] 支持海外大模型

### 阶段3: 风险分析模块（2-3周）

#### 法律风险模块
- [ ] 诉讼数据解析
- [ ] 行政处罚分析
- [ ] 风险评分算法

#### 运营风险模块
- [ ] 财务指标分析
- [ ] 产业链风险评估
- [ ] 经营异常检测

#### 舆情风险模块
- [ ] 新闻情感分析（已完成）
- [ ] 社交媒体情绪分析
- [ ] 舆情预警机制

#### 市场风险模块
- [ ] 资金流向分析
- [ ] 技术面风险评估
- [ ] 市场联动分析

### 阶段4: 前端展示（1-2周）

- [ ] 风险仪表盘
- [ ] 多维度风险雷达图
- [ ] 实时预警提示
- [ ] 风险详情页

---

## 🚀 立即开始

### 第一步：实现东方财富股吧爬虫

**目标**: 获取散户讨论、热点题材

**技术方案**:
1. 模拟浏览器请求
2. 解析HTML/JSON数据
3. 提取讨论内容、情绪
4. 存储到数据库

### 第二步：实现雪球爬虫

**目标**: 获取投资者讨论、情绪分析

**技术方案**:
1. 使用 curl_cffi 模拟真实浏览器
2. 处理反爬虫机制
3. 提取讨论内容、点赞数
4. 情感分析

### 第三步：实现代理功能

**目标**: 支持海外数据源

**技术方案**:
1. 创建 ProxyManager
2. 集成到所有 HTTP 请求
3. 配置文件管理
4. 测试 Google News

---

## 💡 技术栈建议

### 爬虫技术
- **requests** + **BeautifulSoup** - 简单网页
- **Selenium** - 需要JS渲染的网页
- **curl_cffi** - 模拟真实浏览器TLS指纹
- **Scrapy** - 大规模爬虫（可选）

### 反爬虫策略
- User-Agent 轮换
- IP 代理池（如需要）
- 请求频率控制
- Cookie 管理
- 验证码识别（如需要）

### 数据存储
- **SQLite** - 本地开发
- **PostgreSQL** - 生产环境
- **Redis** - 缓存层

### 情感分析
- **已实现**: ImprovedSentimentAnalyzer
- **可选**: 百度AI、腾讯AI文本分析API

---

## 📊 数据更新频率

| 数据类型 | 更新频率 | 实现方式 |
|---------|---------|---------|
| 实时行情 | 实时 | API轮询 |
| 新闻数据 | 10分钟 | 定时任务 |
| 股吧讨论 | 10分钟 | 定时任务 |
| 公告数据 | 1小时 | 定时任务 |
| 法律数据 | 1天 | 定时任务 |
| 财务数据 | 季度 | 手动触发 |

---

## 🎯 下一步行动

**你想先实现哪个？**

### 选项A: 东方财富股吧爬虫 🔥（推荐）
- 获取散户讨论
- 分析市场情绪
- 识别热点题材

### 选项B: 代理功能 🌐
- 支持海外数据源
- 集成 Google News
- 支持海外大模型

### 选项C: 巨潮资讯网公告爬虫 📄
- 获取公司公告
- 解析财报数据
- 监控重大事项

---

**请告诉我你想先实现哪个，我立即开始编码！** 🚀
