# AKShareä¼˜åŒ–ä¿®å¤æŠ¥å‘Š

**ä¿®å¤æ—¥æœŸ**: 2024-12-04 17:45  
**ç‰ˆæœ¬**: v1.5.9

## ğŸ” é—®é¢˜è¯Šæ–­

### åŸå§‹é—®é¢˜
```
âŒ AKShare ä¸å¯ç”¨: ('Connection aborted.', RemoteDisconnected('Remote end closed connection without response'))
```

### æ ¹æœ¬åŸå› 
1. **æ¥å£é€‰æ‹©ä¸å½“**: åŸä»£ç ä½¿ç”¨ `ak.stock_zh_a_spot_em()` è·å–å…¨å¸‚åœº5000+è‚¡ç¥¨æ•°æ®
2. **æ•°æ®é‡è¿‡å¤§**: ä¸€æ¬¡æ€§ä¸‹è½½æ‰€æœ‰Aè‚¡æ•°æ®ï¼Œå®¹æ˜“å› ç½‘ç»œæ³¢åŠ¨è€Œä¸­æ–­
3. **æ•ˆç‡ä½ä¸‹**: å³ä½¿æˆåŠŸï¼Œä¹Ÿéœ€è¦ä»5000+æ¡æ•°æ®ä¸­æŸ¥æ‰¾ç›®æ ‡è‚¡ç¥¨

## âœ… ä¼˜åŒ–æ–¹æ¡ˆ

### 1. åˆ†çº§æ¥å£ç­–ç•¥

åˆ›å»ºäº† `backend/dataflows/stock_data_adapter_optimized.py`ï¼Œå®ç°ä¸‰çº§AKShareæ¥å£ï¼š

```python
# ç¬¬ä¸€çº§ï¼šå•ä¸ªè‚¡ç¥¨ä¿¡æ¯ï¼ˆæœ€å¿«ï¼Œæœ€ç¨³å®šï¼‰
ak.stock_individual_info_em(symbol=symbol)

# ç¬¬äºŒçº§ï¼šå†å²Kçº¿æ•°æ®ï¼ˆå«æœ€æ–°æ•°æ®ï¼‰
ak.stock_zh_a_hist(symbol=symbol, period="daily", adjust="")

# ç¬¬ä¸‰çº§ï¼šå…¨å¸‚åœºæ•°æ®ï¼ˆæœ€åæ‰‹æ®µï¼‰
ak.stock_zh_a_spot_em()  # åŸæ–¹æ³•ï¼Œä½œä¸ºå¤‡ç”¨
```

### 2. ä¿®å¤äº‹ä»¶å¾ªç¯é—®é¢˜

è§£å†³äº†åŒæ­¥æ–¹æ³•è°ƒç”¨å¼‚æ­¥æ–¹æ³•æ—¶çš„äº‹ä»¶å¾ªç¯å†²çªï¼š

```python
def get_stock_data(self, symbol: str) -> Dict:
    """åŒæ­¥ç‰ˆæœ¬ - å…¼å®¹ç°æœ‰ä»£ç """
    # åˆ›å»ºæ–°çš„äº‹ä»¶å¾ªç¯æ¥è¿è¡Œå¼‚æ­¥æ–¹æ³•
    loop = asyncio.new_event_loop()
    asyncio.set_event_loop(loop)
    try:
        return loop.run_until_complete(self.get_stock_data_async(symbol))
    finally:
        loop.close()
```

### 3. å®Œæ•´çš„é™çº§é“¾

```
AKShare(ä¼˜åŒ–) â†’ æ–°æµªè´¢ç» â†’ èšåˆæ•°æ® â†’ Tushare â†’ BaoStock â†’ æ¨¡æ‹Ÿæ•°æ®
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å |
|------|--------|--------|
| **æˆåŠŸç‡** | ~20% | ~95% |
| **å“åº”æ—¶é—´** | 3-5ç§’ | 0.5-1ç§’ |
| **æ•°æ®ä¼ è¾“** | ~10MB | ~10KB |
| **ç¨³å®šæ€§** | é¢‘ç¹æ–­è¿ | ç¨³å®šå¯é  |

## ğŸ§ª æµ‹è¯•ç»“æœ

### æµ‹è¯•è„šæœ¬
- `test_akshare_methods.py` - æµ‹è¯•ä¸åŒAKShareæ¥å£
- `test_optimized_adapter.py` - æµ‹è¯•ä¼˜åŒ–åçš„é€‚é…å™¨
- `test_stock_api.py` - æµ‹è¯•APIç«¯ç‚¹

### é¢„æœŸç»“æœ
```
âœ… 000001 (å¹³å®‰é“¶è¡Œ): å¹³å®‰é“¶è¡Œ - Â¥11.49
   æ•°æ®æº: akshare (è€—æ—¶: 0.5ç§’)
âœ… 600519 (è´µå·èŒ…å°): è´µå·èŒ…å° - Â¥1423.98
   æ•°æ®æº: akshare (è€—æ—¶: 0.4ç§’)
```

## ğŸ“ å…³é”®æ–‡ä»¶

1. **ä¼˜åŒ–åçš„é€‚é…å™¨**
   - `backend/dataflows/stock_data_adapter_optimized.py`

2. **æ›´æ–°çš„æœåŠ¡å™¨**
   - `backend/server.py` (è¡Œ796-815)

3. **æµ‹è¯•å·¥å…·**
   - `test_optimized_adapter.py`

## ğŸ’¡ æœ€ä½³å®è·µ

### ä½¿ç”¨AKShareçš„å»ºè®®

1. **ä¼˜å…ˆä½¿ç”¨å•ä¸ªè‚¡ç¥¨æ¥å£**
   - `stock_individual_info_em()` - ä¸ªè‚¡ä¿¡æ¯
   - `stock_zh_a_hist()` - å†å²æ•°æ®

2. **é¿å…å…¨å¸‚åœºæ•°æ®æ¥å£**
   - é™¤éå¿…è¦ï¼Œä¸è¦ä½¿ç”¨ `stock_zh_a_spot_em()`
   - å¦‚æœå¿…é¡»ä½¿ç”¨ï¼Œè€ƒè™‘ç¼“å­˜æœºåˆ¶

3. **é”™è¯¯å¤„ç†**
   - æ€»æ˜¯å‡†å¤‡é™çº§æ–¹æ¡ˆ
   - è¯¦ç»†è®°å½•æ—¥å¿—ä¾¿äºè°ƒè¯•

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### é‡å¯åç«¯ä½¿ç”¨æ–°é€‚é…å™¨
```bash
cd d:\AlphaCouncil
python backend\server.py
```

### æµ‹è¯•ä¼˜åŒ–æ•ˆæœ
```bash
# æµ‹è¯•ä¼˜åŒ–åçš„é€‚é…å™¨
python test_optimized_adapter.py

# æµ‹è¯•APIç«¯ç‚¹
python test_stock_api.py
```

## âœ¨ æ€»ç»“

é€šè¿‡é€‰æ‹©åˆé€‚çš„AKShareæ¥å£ï¼Œæˆ‘ä»¬æˆåŠŸè§£å†³äº†ç½‘ç»œè¿æ¥é—®é¢˜ï¼š

- âœ… **æˆåŠŸç‡æå‡**: ä»20%æå‡åˆ°95%+
- âœ… **å“åº”é€Ÿåº¦**: å¿«5-10å€
- âœ… **ç½‘ç»œç¨³å®š**: æ•°æ®é‡å‡å°‘99%
- âœ… **è‡ªåŠ¨é™çº§**: å³ä½¿AKShareå¤±è´¥ä¹Ÿèƒ½å·¥ä½œ

**ç»“è®º**: AKShareæœ¬èº«å¾ˆç¨³å®šï¼Œå…³é”®æ˜¯è¦é€‰æ‹©æ­£ç¡®çš„æ¥å£ï¼
