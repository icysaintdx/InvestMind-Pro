# InvestMind-Pro 策略回测系统使用指南

**版本**: v2.0.0  
**更新日期**: 2025-12-15  

---

## 📋 系统概述

InvestMind-Pro 策略回测系统提供完整的策略历史数据回测功能，支持10个策略的性能评估和对比分析。

### 核心功能

1. ✅ **单策略回测** - 详细的单个策略回测分析
2. ✅ **多策略对比** - 横向对比多个策略表现
3. ✅ **性能指标** - 6大核心性能指标
4. ✅ **真实数据** - 支持真实历史数据回测
5. ✅ **报告生成** - 自动生成Markdown格式报告

---

## 🚀 快速开始

### 方法1: 使用测试脚本（推荐）

```bash
# 进入项目目录
cd D:\InvestMindPro

# 运行简化测试脚本
python test_simple_backtest.py

# 或使用批处理文件
RUN_BACKTEST.bat
```

### 方法2: 使用Python代码

```python
import asyncio
from backend.backtest.engine import BacktestEngine
from backend.strategies.vegas_adx import VegasADXStrategy
from backend.backtest.data_loader import DataLoader

async def run_backtest():
    # 加载数据
    loader = DataLoader()
    data = await loader.load_stock_data(
        stock_code="600519",
        start_date="2023-01-01",
        end_date="2024-01-01"
    )
    
    # 创建策略
    strategy = VegasADXStrategy()
    
    # 创建回测引擎
    engine = BacktestEngine(
        initial_capital=100000,
        commission_rate=0.0003,
        slippage_rate=0.0001
    )
    
    # 运行回测
    result = await engine.run(
        strategy=strategy,
        data=data,
        stock_code="600519"
    )
    
    # 查看结果
    print(f"总收益率: {result.total_return:.2%}")
    print(f"胜率: {result.win_rate:.2%}")
    print(f"夏普比率: {result.sharpe_ratio:.2f}")

# 运行
asyncio.run(run_backtest())
```

---

## 📊 支持的策略

### 技术分析类（5个）

| # | 策略 | 适用场景 | 预期胜率 |
|---|------|---------|---------|
| 1 | Vegas+ADX | 强趋势市场 | 70-80% |
| 2 | EMA突破 | 波动市场 | 60-70% |
| 3 | 三叉戟 | 综合市场 | 65-75% |
| 4 | MACD交叉 | 趋势市场 | 60-70% |
| 5 | 布林带突破 | 波动市场 | 65-75% |

### AI合成类（2个）

| # | 策略 | 适用场景 | 预期胜率 |
|---|------|---------|---------|
| 6 | 情绪共振 | 热点板块 | 60-70% |
| 7 | 多空辩论 | 全市场 | 65-75% |

### 趋势跟踪类（1个）

| # | 策略 | 适用场景 | 预期胜率 |
|---|------|---------|---------|
| 8 | 海龟交易 | 大趋势 | 40-50% |

### 民间策略类（2个）

| # | 策略 | 适用场景 | 预期胜率 |
|---|------|---------|---------|
| 9 | 涨停板 | 热点追踪 | 50-60% |
| 10 | 量价齐升 | 波段操作 | 60-70% |

---

## 📈 性能指标说明

### 核心指标

| 指标 | 说明 | 计算方法 | 优秀标准 |
|------|------|---------|---------|
| **总收益率** | 总盈亏百分比 | (最终资金-初始资金)/初始资金 | >10% |
| **年化收益率** | 年化收益 | 总收益率 × (365/交易天数) | >15% |
| **胜率** | 盈利交易占比 | 盈利次数/总交易次数 | >60% |
| **最大回撤** | 最大亏损幅度 | (峰值-谷底)/峰值 | <10% |
| **夏普比率** | 风险调整收益 | (收益-无风险利率)/收益标准差 | >1.0 |
| **盈亏比** | 平均盈利/平均亏损 | 平均盈利金额/平均亏损金额 | >2.0 |

---

## 🔧 高级用法

### 1. 参数优化

测试不同参数组合找到最优配置：

```python
async def optimize_parameters():
    # 参数网格
    stop_loss_values = [0.03, 0.04, 0.05]
    take_profit_values = [0.10, 0.12, 0.15]
    
    best_result = None
    best_params = None
    
    for sl in stop_loss_values:
        for tp in take_profit_values:
            # 创建策略并设置参数
            strategy = VegasADXStrategy()
            strategy.risk_params['stop_loss_pct'] = sl
            strategy.risk_params['take_profit_pct'] = tp
            
            # 运行回测
            result = await engine.run(strategy, data, "600519")
            
            # 记录最佳结果
            if best_result is None or result.sharpe_ratio > best_result.sharpe_ratio:
                best_result = result
                best_params = {"stop_loss": sl, "take_profit": tp}
    
    print(f"最佳参数: {best_params}")
    print(f"夏普比率: {best_result.sharpe_ratio:.2f}")
```

### 2. 组合策略

测试多策略组合：

```python
async def test_portfolio():
    strategies = [
        ("三叉戟", TridentStrategy(), 0.50),  # 50%
        ("海龟", TurtleTradingStrategy(), 0.30),  # 30%
        ("MACD", MACDCrossoverStrategy(), 0.20),  # 20%
    ]
    
    # 为每个策略分配资金
    total_capital = 100000
    
    results = []
    for name, strategy, weight in strategies:
        capital = total_capital * weight
        engine = BacktestEngine(initial_capital=capital)
        result = await engine.run(strategy, data, "600519")
        results.append((name, result, weight))
    
    # 计算组合收益
    portfolio_return = sum(r.total_return * w for _, r, w in results)
    print(f"组合收益率: {portfolio_return:.2%}")
```

### 3. 跨市场验证

在不同股票上测试策略：

```python
async def cross_market_test():
    stocks = ["600519", "000858", "600036"]  # 茅台、五粮液、招商银行
    strategy = TridentStrategy()
    
    for stock in stocks:
        data = await loader.load_stock_data(stock, "2023-01-01", "2024-01-01")
        result = await engine.run(strategy, data, stock)
        
        print(f"{stock}: 收益{result.total_return:.2%}, 胜率{result.win_rate:.2%}")
```

---

## 📝 回测报告

### 报告内容

回测完成后会自动生成包含以下内容的报告：

1. **基本信息**
   - 策略名称
   - 回测周期
   - 交易天数

2. **收益表现**
   - 总收益和收益率
   - 初始和最终资金

3. **交易统计**
   - 总交易次数
   - 买入/卖出次数
   - 盈利交易数

4. **盈亏分析**
   - 平均盈亏
   - 最大回撤
   - 夏普比率

5. **交易记录**
   - 详细的交易明细
   - 每笔交易的盈亏

### 报告位置

- 单策略报告: `docs/回测报告-[策略名].md`
- 对比报告: `docs/策略对比回测报告.md`

---

## ⚠️ 注意事项

### 回测局限性

1. **历史不代表未来** - 回测结果不保证未来表现
2. **数据质量** - 回测结果依赖于数据质量
3. **交易成本** - 实际交易可能有更多成本
4. **滑点影响** - 实际成交价可能与预期不同
5. **市场环境** - 市场环境变化会影响策略表现

### 最佳实践

1. ✅ **多周期测试** - 在不同时间段测试
2. ✅ **跨市场验证** - 在不同股票上验证
3. ✅ **参数稳定性** - 测试参数敏感度
4. ✅ **样本外测试** - 保留部分数据用于验证
5. ✅ **风险控制** - 始终设置止损

---

## 🎯 常见问题

### Q1: 为什么我的回测结果和实盘不一样？

**A**: 可能的原因：
- 回测使用的是后复权数据
- 实盘有滑点和冲击成本
- 市场环境发生变化
- 策略参数需要调整

### Q2: 如何选择最适合的策略？

**A**: 考虑以下因素：
- 你的风险承受能力
- 持仓周期偏好
- 市场环境
- 策略的夏普比率和最大回撤

### Q3: 回测需要多长时间的数据？

**A**: 建议：
- 最少: 6个月（120个交易日）
- 推荐: 1-2年（250-500个交易日）
- 理想: 3-5年（750-1250个交易日）

### Q4: 如何判断策略是否过拟合？

**A**: 检查方法：
- 样本外测试表现
- 参数敏感度分析
- 跨市场验证
- 不同周期的稳定性

---

## 📚 相关文档

- [策略库完整实现报告v1.0](策略库完整实现报告v1.0.md)
- [AI策略实现完成报告](AI策略实现完成报告.md)
- [模拟交易与回测系统实现进展](模拟交易与回测系统实现进展.md)

---

## 🆘 技术支持

如遇问题，请查看：
1. 项目文档目录
2. 代码注释
3. 测试脚本示例

---

**文档版本**: v1.0  
**最后更新**: 2025-12-15 23:03  
**维护者**: InvestMind-Pro Team
