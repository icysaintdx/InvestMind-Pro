# æ™ºèƒ½åˆ†æé©±åŠ¨çš„æ¨¡æ‹Ÿäº¤æ˜“é—­ç¯ç³»ç»Ÿ - å€Ÿé‰´ä¸èåˆ

**åˆ›å»ºæ—¥æœŸ**: 2025-12-15  
**ç‰ˆæœ¬**: v1.0.0  

---

## ğŸ“– æ¦‚è¿°

åŸºäº `docs/1InvestMind-Pro é—­ç¯äº¤æ˜“ç³»ç»Ÿæ•´åˆæ–¹æ¡ˆï¼šç­–ç•¥ - å›æµ‹ - æ¨¡æ‹Ÿäº¤æ˜“è”åŠ¨è®¾è®¡.md` çš„æ·±å…¥ç ”ç©¶ï¼Œæˆ‘ä»¬æç‚¼å‡ºä»¥ä¸‹8ä¸ªæ ¸å¿ƒè®¾è®¡ç²¾åï¼Œå¹¶å°†å…¶èåˆåˆ°æˆ‘ä»¬çš„ç³»ç»Ÿä¸­ã€‚

---

## ğŸ¯ æ ¸å¿ƒå€Ÿé‰´ç‚¹

### 1. LLMç­–ç•¥é€‰æ‹©çš„ä¸‰å±‚è§„åˆ™ä½“ç³» â­â­â­â­â­

**å€Ÿé‰´å†…å®¹**ï¼š
- **ç¬¬ä¸€å±‚ï¼šç»“æ„åŒ–è§„åˆ™ï¼ˆç¡¬çº¦æŸï¼‰**
  - å¿…é€‰æ¡ä»¶ï¼šå‘¨æœŸåŒ¹é…ã€ä»“ä½é™åˆ¶ã€æ­¢æŸé˜ˆå€¼ã€å›æµ‹èƒœç‡
  - ç¦æ­¢æ¡ä»¶ï¼šé«˜æ³¢åŠ¨æ— æ­¢æŸã€è´Ÿé¢æƒ…ç»ªé«˜ä»“ä½ã€é«˜å›æ’¤ç­–ç•¥ã€è¿ç»­åŒç­–ç•¥
  - ä¼˜å…ˆçº§è§„åˆ™ï¼šå‘¨æœŸ30% > é£é™©25% > æ”¶ç›Š20% > æ–°é—»15% > å¸‚åœº10%

- **ç¬¬äºŒå±‚ï¼šåœºæ™¯åŒ–è§„åˆ™ï¼ˆè½¯çº¦æŸï¼‰**
  - å¸‚åœºåœºæ™¯ï¼šç‰›å¸‚/ç†Šå¸‚/éœ‡è¡å¸‚
  - è‚¡ç¥¨ç±»å‹ï¼šæˆé•¿è‚¡/ä»·å€¼è‚¡/å‘¨æœŸè‚¡
  - åˆ†æç‰¹å¾ï¼šåŸºæœ¬é¢vsæŠ€æœ¯é¢å¼ºå¼±

- **ç¬¬ä¸‰å±‚ï¼šåé¦ˆæ ¡å‡†è§„åˆ™ï¼ˆè¿­ä»£ä¼˜åŒ–ï¼‰**
  - å†³ç­–åé¦ˆæŒ‡æ ‡æ”¶é›†
  - è§„åˆ™å¼±ç‚¹è¯†åˆ«
  - è§„åˆ™è¿­ä»£æ›´æ–°

**èåˆæ–¹å¼**ï¼š
```json
// backend/agent_configs/strategy_selection_rules.json
{
  "mandatory_conditions": [
    "æ‰€é€‰ç­–ç•¥çš„é€‚ç”¨å‘¨æœŸä¸åˆ†æå»ºè®®å‘¨æœŸåå·®â‰¤3å¤©",
    "æ‰€é€‰ç­–ç•¥çš„æœ€å¤§ä»“ä½â‰¤é£é™©ç­‰çº§å¯¹åº”çš„ä»“ä½ä¸Šé™ï¼ˆé«˜â‰¤50%ï¼Œä¸­â‰¤30%ï¼Œä½â‰¤15%ï¼‰",
    "æ‰€é€‰ç­–ç•¥çš„æ­¢æŸé˜ˆå€¼â‰¥åˆ†æç»“æœä¸­çš„é£é™©é¢„è­¦é˜ˆå€¼",
    "ç­–ç•¥è¿‘3æ¬¡åŒå‘¨æœŸå›æµ‹çš„èƒœç‡â‰¥40%"
  ],
  "forbidden_conditions": [
    "å¸‚åœºæ³¢åŠ¨ç‡>8%æ—¶é€‰æ‹©æ— æ­¢æŸæœºåˆ¶çš„ç­–ç•¥",
    "æ–°é—»æƒ…ç»ªæŒ‡æ•°<-0.7æ—¶é€‰æ‹©é«˜ä»“ä½è¿›æ”»å‹ç­–ç•¥",
    "é€‰æ‹©å›æµ‹æœ€å¤§å›æ’¤>20%çš„ç­–ç•¥ï¼ˆé«˜é£é™©åœºæ™¯é™¤å¤–ï¼‰",
    "åŒä¸€è‚¡ç¥¨è¿ç»­3å¤©é€‰æ‹©åŒä¸€ç­–ç•¥"
  ],
  "priority_rules": [
    "å‘¨æœŸåŒ¹é…åº¦ï¼ˆ30%ï¼‰>é£é™©é€‚é…æ€§ï¼ˆ25%ï¼‰>å†å²æ”¶ç›Šï¼ˆ20%ï¼‰>æ–°é—»æ•æ„Ÿåº¦ï¼ˆ15%ï¼‰>å¸‚åœºé€‚é…æ€§ï¼ˆ10%ï¼‰"
  ]
}
```

**ä»·å€¼ä½“ç°**ï¼š
- âœ… ç¡®ä¿LLMå†³ç­–ç¬¦åˆä¸šåŠ¡é£æ§è¦æ±‚
- âœ… æä¾›æ˜ç¡®çš„å†³ç­–è¾¹ç•Œï¼Œé¿å…éšæ„æ€§
- âœ… æ”¯æŒè§„åˆ™çš„æŒç»­è¿­ä»£ä¼˜åŒ–
- âœ… é€‚é…ä¸åŒå¸‚åœºåœºæ™¯å’Œè‚¡ç¥¨ç±»å‹

---

### 2. æ··åˆå†³ç­–æ¨¡å‹ â­â­â­â­â­

**å€Ÿé‰´å†…å®¹**ï¼š
- **ä¸‰æ­¥éª¤å†³ç­–æµç¨‹**ï¼šè§„åˆ™ç­›é€‰ â†’ LLMä¼˜åŒ– â†’ å›æµ‹éªŒè¯
- **åŠ æƒèåˆæœºåˆ¶**ï¼šLLMè¯„åˆ†70% + å›æµ‹èƒœç‡30%
- **å†³ç­–ä¸€è‡´æ€§æ ¡éªŒ**ï¼šå¤šæ¬¡è°ƒç”¨éªŒè¯ï¼Œä¸ä¸€è‡´æ—¶é™çº§ä¸ºè§„åˆ™å†³ç­–

**èåˆæ–¹å¼**ï¼š
```python
# backend/services/strategy/selector.py
async def hybrid_strategy_selection(validated_inputs: dict):
    """æ··åˆå†³ç­–æ¨¡å‹ï¼šè§„åˆ™+LLM+å›æµ‹"""
    
    # æ­¥éª¤1ï¼šè§„åˆ™ç­›é€‰ï¼ˆå¿«é€Ÿè¿‡æ»¤æ˜æ˜¾ä¸åŒ¹é…çš„ç­–ç•¥ï¼‰
    candidate_strategies = [
        s for s in _extended_strategies()
        if abs(s["parameters"]["suitable_period"] - stock_analysis["period_suggestion"]) <= 3
        and s["parameters"]["max_position"] <= get_max_position(stock_analysis["risk_level"])
        and s["parameters"]["news_sensitivity"] >= abs(news_sentiment) * 0.8
    ]
    
    if not candidate_strategies:
        candidate_strategies = [_extended_strategies()[0]]  # å…œåº•ç­–ç•¥
    
    # æ­¥éª¤2ï¼šLLMåœ¨å€™é€‰æ± ä¸­ä¼˜åŒ–æ’åº
    llm_prompt = build_llm_prompt_with_rules(
        stock_analysis, market_data, news_sentiment, candidate_strategies
    )
    llm_ranking = await llm_client.generate(llm_prompt, format="json")
    
    # æ­¥éª¤3ï¼šå†å²å›æµ‹éªŒè¯ï¼ˆæ’é™¤å›æµ‹è¡¨ç°å·®çš„ç­–ç•¥ï¼‰
    final_candidates = []
    for item in llm_ranking:
        strategy = next(s for s in candidate_strategies if s["strategy_id"] == item["strategy_id"])
        backtest_result = BacktestEngine.run(
            strategy_id=strategy["strategy_id"],
            stock_code=stock_analysis["code"],
            period=stock_analysis["period_suggestion"],
            recent_cycles=3
        )
        if backtest_result["win_rate"] >= 0.45:
            final_candidates.append({
                "strategy_id": strategy["strategy_id"],
                "combined_score": item["score"] * 0.7 + backtest_result["win_rate"] * 0.3
            })
    
    return max(final_candidates, key=lambda x: x["combined_score"])["strategy_id"]
```

**ä»·å€¼ä½“ç°**ï¼š
- âœ… ç»“åˆè§„åˆ™çš„ç¨³å®šæ€§å’ŒLLMçš„çµæ´»æ€§
- âœ… å›æµ‹éªŒè¯ç¡®ä¿ç­–ç•¥å†å²è¡¨ç°
- âœ… å†³ç­–ä¸€è‡´æ€§æ ¡éªŒé™ä½éšæœºæ€§
- âœ… å‡†ç¡®ç‡æå‡è‡³60%+

---

### 3. æ•°æ®è´¨é‡ç®¡æ§ â­â­â­â­

**å€Ÿé‰´å†…å®¹**ï¼š
- **è¾“å…¥æ•°æ®å®Œæ•´æ€§æ ¡éªŒ**ï¼šæ£€æŸ¥å¿…éœ€å­—æ®µ
- **å¼‚å¸¸å€¼è¿‡æ»¤**ï¼š3ÏƒåŸåˆ™ç§»é™¤å¼‚å¸¸æ•°æ®ç‚¹
- **æƒ…ç»ªæŒ‡æ•°æ ‡å‡†åŒ–**ï¼šç»Ÿä¸€æ˜ å°„åˆ°[-1,1]åŒºé—´

**èåˆæ–¹å¼**ï¼š
```python
# backend/services/strategy/data_validator.py
def validate_strategy_inputs(stock_analysis: dict, market_data: dict, news_sentiment: float):
    """æ ¡éªŒå¹¶æ¸…æ´—ç­–ç•¥é€‰æ‹©çš„è¾“å…¥æ•°æ®"""
    # 1. åˆ†æç»“æœå®Œæ•´æ€§æ ¡éªŒ
    required_fields = ["macroeconomic", "technical", "fundamental", "risk_level", "period_suggestion"]
    missing_fields = [f for f in required_fields if f not in stock_analysis]
    if missing_fields:
        raise ValueError(f"åˆ†æç»“æœç¼ºå¤±å…³é”®å­—æ®µï¼š{missing_fields}")
    
    # 2. è¡Œæƒ…æ•°æ®å¼‚å¸¸å€¼è¿‡æ»¤ï¼ˆ3ÏƒåŸåˆ™ï¼‰
    market_data["price"] = filter_outliers(market_data["price"], threshold=3)
    market_data["volume"] = fill_missing_data(market_data["volume"], method="linear")
    
    # 3. æƒ…ç»ªæŒ‡æ•°æ ‡å‡†åŒ–ï¼ˆæ˜ å°„åˆ°[-1,1]ï¼‰
    news_sentiment = max(min(news_sentiment, 1), -1)
    
    return {
        "stock_analysis": stock_analysis,
        "market_data": market_data,
        "news_sentiment": news_sentiment,
        "validated_at": datetime.now()
    }
```

**ä»·å€¼ä½“ç°**ï¼š
- âœ… ç¡®ä¿è¾“å…¥æ•°æ®è´¨é‡
- âœ… å‡å°‘å¼‚å¸¸æ•°æ®å¯¹å†³ç­–çš„å¹²æ‰°
- âœ… æé«˜ç­–ç•¥é€‰æ‹©å‡†ç¡®æ€§
- âœ… é™ä½ç³»ç»Ÿé”™è¯¯ç‡

---

### 4. åˆ†å±‚ç¼“å­˜ä½“ç³» â­â­â­â­

**å€Ÿé‰´å†…å®¹**ï¼š
- **L1å†…å­˜ç¼“å­˜**ï¼š5åˆ†é’Ÿè¿‡æœŸï¼Œçƒ­é—¨è‚¡ç¥¨
- **L2 Redisç¼“å­˜**ï¼š1å°æ—¶è¿‡æœŸï¼Œå…¨é‡è‚¡ç¥¨
- **L3æ–‡ä»¶ç¼“å­˜**ï¼š24å°æ—¶è¿‡æœŸï¼Œå†å²å›æµ‹

**èåˆæ–¹å¼**ï¼š
```python
# backend/services/cache/strategy_cache.py
async def get_cached_strategy(stock_code: str, input_features: dict):
    """è·å–ç¼“å­˜çš„ç­–ç•¥é€‰æ‹©ç»“æœï¼Œæ— åˆ™è®¡ç®—å¹¶ç¼“å­˜"""
    # ç”Ÿæˆç‰¹å¾å“ˆå¸Œé”®
    key_features = {
        "risk_level": input_features["stock_analysis"]["risk_level"],
        "period": input_features["stock_analysis"]["period_suggestion"],
        "market_trend": input_features["market_data"]["trend"]
    }
    cache_key = f"strategy:selection:{stock_code}:{hash(frozenset(key_features.items()))}"
    
    # ä¼˜å…ˆæŸ¥å†…å­˜ç¼“å­˜
    if cache_key in memory_cache:
        return memory_cache[cache_key]
    
    # å†æŸ¥Redisç¼“å­˜
    redis_result = await redis_client.get(cache_key)
    if redis_result:
        memory_cache[cache_key] = redis_result
        return redis_result
    
    # ç¼“å­˜æœªå‘½ä¸­ï¼Œæ‰§è¡Œè®¡ç®—
    validated_inputs = validate_strategy_inputs(**input_features)
    strategy_id = await hybrid_strategy_selection(validated_inputs)
    strategy_id = check_decision_consistency(strategy_id, validated_inputs)
    
    # å†™å…¥ç¼“å­˜
    memory_cache[cache_key] = strategy_id
    await redis_client.setex(cache_key, 3600, strategy_id)  # 1å°æ—¶è¿‡æœŸ
    
    return strategy_id
```

**ä»·å€¼ä½“ç°**ï¼š
- âœ… å•è‚¡ç¥¨é€‰æ‹©å“åº”æ—¶é—´<100ms
- âœ… ç¼“å­˜å‘½ä¸­ç‡>80%
- âœ… å‡å°‘LLMè°ƒç”¨æˆæœ¬
- âœ… æå‡ç³»ç»Ÿååé‡

---

### 5. å¹¶è¡Œè®¡ç®—ä¸èµ„æºè°ƒåº¦ â­â­â­â­

**å€Ÿé‰´å†…å®¹**ï¼š
- **å¹¶å‘æ•°é™åˆ¶**ï¼šSemaphore=10ï¼Œé¿å…èµ„æºè€—å°½
- **æ‰¹é‡å¤„ç†**ï¼šæ”¯æŒ100+è‚¡ç¥¨å¹¶è¡Œé€‰æ‹©
- **å¹¶è¡Œæ ¡éªŒ**ï¼šåŒæ—¶éªŒè¯å¤šä¸ªç»“æœ

**èåˆæ–¹å¼**ï¼š
```python
# backend/services/strategy/parallel_executor.py
async def batch_strategy_selection(stock_codes: list, input_features_list: list):
    """æ‰¹é‡å¹¶è¡Œå¤„ç†å¤šè‚¡ç¥¨ç­–ç•¥é€‰æ‹©"""
    # 1. å¹¶è¡Œæ ¡éªŒè¾“å…¥æ•°æ®
    validate_tasks = [
        asyncio.create_task(validate_strategy_inputs(**features))
        for features in input_features_list
    ]
    validated_inputs_list = await asyncio.gather(*validate_tasks)
    
    # 2. å¹¶è¡Œæ‰§è¡Œæ··åˆå†³ç­–ï¼ˆé™åˆ¶å¹¶å‘æ•°ï¼‰
    semaphore = asyncio.Semaphore(10)  # æœ€å¤š10ä¸ªå¹¶å‘
    
    async def bounded_selection(inputs):
        async with semaphore:
            return await hybrid_strategy_selection(inputs)
    
    selection_tasks = [
        asyncio.create_task(bounded_selection(inputs))
        for inputs in validated_inputs_list
    ]
    strategy_ids = await asyncio.gather(*selection_tasks)
    
    # 3. å¹¶è¡Œæ ¡éªŒä¸€è‡´æ€§
    consistency_tasks = [
        asyncio.create_task(check_decision_consistency(sid, inputs))
        for sid, inputs in zip(strategy_ids, validated_inputs_list)
    ]
    final_strategies = await asyncio.gather(*consistency_tasks)
    
    return dict(zip(stock_codes, final_strategies))
```

**ä»·å€¼ä½“ç°**ï¼š
- âœ… æ‰¹é‡å¤„ç†100è‚¡ç¥¨<5ç§’
- âœ… é¿å…èµ„æºè€—å°½
- âœ… æé«˜ç³»ç»Ÿååé‡
- âœ… æ”¯æŒé«˜å¹¶å‘åœºæ™¯

---

### 6. å®æ—¶æ•°æ®æ›´æ–°ç®¡é“ â­â­â­

**å€Ÿé‰´å†…å®¹**ï¼š
- **å¤šä¼˜å…ˆçº§æ›´æ–°**ï¼šè¡Œæƒ…ï¼ˆæ¯«ç§’çº§ï¼‰ã€èµ„é‡‘ï¼ˆç§’çº§ï¼‰ã€èˆ†æƒ…ï¼ˆåˆ†é’Ÿçº§ï¼‰
- **å¢é‡æ›´æ–°æœºåˆ¶**ï¼šä»…ä¼ è¾“å˜åŒ–æ•°æ®
- **æ•°æ®ç‰ˆæœ¬æ§åˆ¶**ï¼šé¿å…æ•°æ®å†²çª

**èåˆæ–¹å¼**ï¼š
```python
# backend/services/data/realtime_pipeline.py
async def realtime_data_update_pipeline(market_code):
    """å¤šä¼˜å…ˆçº§å®æ—¶æ•°æ®æ›´æ–°ç®¡é“"""
    # é«˜ä¼˜å…ˆçº§ï¼šè¡Œæƒ…æ•°æ®ï¼ˆæ¯«ç§’çº§ï¼‰
    tick_task = asyncio.create_task(fetch_tick_data(market_code))
    
    # ä¸­ä¼˜å…ˆçº§ï¼šèµ„é‡‘æµå‘ï¼ˆç§’çº§ï¼‰
    fund_task = asyncio.create_task(fetch_fund_flow(market_code))
    
    # ä½ä¼˜å…ˆçº§ï¼šèˆ†æƒ…æ•°æ®ï¼ˆåˆ†é’Ÿçº§ï¼‰
    sentiment_task = asyncio.create_task(fetch_sentiment_data(market_code))
    
    # æŒ‰ä¼˜å…ˆçº§å¤„ç†æ›´æ–°
    results = await asyncio.gather(tick_task, fund_task, sentiment_task)
    
    # åº”ç”¨æ•°æ®æ›´æ–°ï¼ˆå¸¦ç‰ˆæœ¬æ§åˆ¶ï¼‰
    update_strategy_engine(
        tick_data=results[0],
        fund_data=results[1],
        sentiment_data=results[2],
        data_version=generate_version()
    )
```

**å¼‚å¸¸å¤„ç†ç­–ç•¥**ï¼š
- æ•°æ®å»¶è¿Ÿæ—¶å¯åŠ¨é™çº§æ¨¡å¼ï¼šä½¿ç”¨æœ€è¿‘å¯ç”¨æ•°æ®+æ—¶é—´è¡°å‡å› å­
- æ•°æ®æºæ•…éšœæ—¶è‡ªåŠ¨åˆ‡æ¢å¤‡ç”¨é€šé“ï¼ˆå¦‚Tushareâ†’AkShareï¼‰
- æ•°æ®è´¨é‡æ ¡éªŒå¤±è´¥æ—¶è§¦å‘å‘Šè­¦å¹¶ä½¿ç”¨ç¼“å­˜æ•°æ®

**ä»·å€¼ä½“ç°**ï¼š
- âœ… å®æ—¶æ€§ä¸ç¨³å®šæ€§å¹³è¡¡
- âœ… å‡å°‘ç½‘ç»œå¸¦å®½æ¶ˆè€—
- âœ… æ”¯æŒæ•°æ®æºæ•…éšœåˆ‡æ¢
- âœ… æ•°æ®æ›´æ–°å†·å´æœŸï¼ˆ1åˆ†é’Ÿï¼‰

---

### 7. ç›‘æ§ä¸å‘Šè­¦æœºåˆ¶ â­â­â­

**å€Ÿé‰´å†…å®¹**ï¼š
- **å“åº”æ—¶é—´ç›‘æ§**ï¼šç›®æ ‡<100msï¼Œå‘Šè­¦>200ms
- **å‡†ç¡®ç‡ç›‘æ§**ï¼šç›®æ ‡â‰¥55%ï¼Œå‘Šè­¦<45%
- **ä¸€è‡´ç‡ç›‘æ§**ï¼šç›®æ ‡â‰¥70%ï¼Œå‘Šè­¦<60%
- **ç¼“å­˜å‘½ä¸­ç‡ç›‘æ§**ï¼šç›®æ ‡â‰¥80%ï¼Œå‘Šè­¦<70%

**èåˆæ–¹å¼**ï¼š
```python
# backend/services/monitoring/strategy_alerts.py
def check_strategy_engine_health(metrics: dict):
    """æ£€æŸ¥ç­–ç•¥å¼•æ“å¥åº·çŠ¶æ€ï¼Œè§¦å‘å‘Šè­¦"""
    alerts = []
    
    if metrics["response_time"] > 200:
        alerts.append({
            "level": "WARNING",
            "message": "ç­–ç•¥é€‰æ‹©å“åº”è¶…æ—¶",
            "suggestion": "æ¸…ç†ç¼“å­˜/é™ä½å¹¶å‘æ•°"
        })
    
    if metrics["selection_accuracy"] < 0.45:
        alerts.append({
            "level": "CRITICAL",
            "message": "ç­–ç•¥é€‰æ‹©å‡†ç¡®ç‡è¿‡ä½",
            "suggestion": "æš‚åœæ¨¡æ‹Ÿäº¤æ˜“ï¼Œæ ¡å‡†å†³ç­–æ¨¡å‹"
        })
    
    if metrics["cache_hit_rate"] < 0.70:
        alerts.append({
            "level": "INFO",
            "message": "ç¼“å­˜å‘½ä¸­ç‡åä½",
            "suggestion": "ä¼˜åŒ–ç¼“å­˜ç­–ç•¥/å¢åŠ ç¼“å­˜å®¹é‡"
        })
    
    # å‘é€å‘Šè­¦ï¼ˆé‚®ä»¶/é’‰é’‰/æ—¥å¿—ï¼‰
    if alerts:
        send_alert(alerts, "strategy_engine")
    
    return alerts
```

**ä»·å€¼ä½“ç°**ï¼š
- âœ… å®æ—¶å‘ç°ç³»ç»Ÿé—®é¢˜
- âœ… è‡ªåŠ¨è§¦å‘é™çº§æœºåˆ¶
- âœ… ä¿éšœç³»ç»Ÿç¨³å®šè¿è¡Œ
- âœ… æä¾›ä¼˜åŒ–å»ºè®®

---

### 8. è½»é‡çº§é™çº§æœºåˆ¶ â­â­â­

**å€Ÿé‰´å†…å®¹**ï¼š
- **è¶…æ—¶æ§åˆ¶**ï¼š5ç§’è¶…æ—¶è‡ªåŠ¨é™çº§
- **é™çº§ç­–ç•¥**ï¼šLLMå¤±è´¥â†’è§„åˆ™å†³ç­–
- **å¼‚å¸¸å¤„ç†**ï¼šç¡®ä¿æœåŠ¡ä¸ä¸­æ–­

**èåˆæ–¹å¼**ï¼š
```python
# backend/services/strategy/fallback.py
async def strategy_selection_with_fallback(input_features: dict, timeout=5):
    """å¸¦è¶…æ—¶å’Œé™çº§çš„ç­–ç•¥é€‰æ‹©"""
    try:
        # è®¾ç½®è¶…æ—¶é™åˆ¶ï¼ˆ5ç§’ï¼‰
        return await asyncio.wait_for(
            get_cached_strategy(input_features["stock_code"], input_features),
            timeout=timeout
        )
    except asyncio.TimeoutError:
        # è¶…æ—¶é™çº§ä¸ºè§„åˆ™å†³ç­–
        return rule_based_strategy_selection(input_features)
    except Exception as e:
        # å…¶ä»–å¼‚å¸¸é™çº§
        logger.error(f"ç­–ç•¥é€‰æ‹©å¼‚å¸¸ï¼š{e}")
        return rule_based_strategy_selection(input_features)
```

**ä»·å€¼ä½“ç°**ï¼š
- âœ… é™çº§æˆåŠŸç‡100%
- âœ… æ— æœåŠ¡ä¸­æ–­é£é™©
- âœ… ä¿è¯ç³»ç»Ÿé«˜å¯ç”¨æ€§
- âœ… ç”¨æˆ·ä½“éªŒä¸å—å½±å“

---

## ğŸ“Š èåˆæ•ˆæœé¢„æœŸ

### å‡†ç¡®æ€§æå‡
- ç­–ç•¥é€‰æ‹©å‡†ç¡®ç‡ï¼š50% â†’ 60%+
- å†³ç­–ä¸€è‡´ç‡ï¼š60% â†’ 70%+
- è§„åˆ™éµå®ˆç‡ï¼š70% â†’ 95%+

### æ€§èƒ½æå‡
- å•è‚¡ç¥¨é€‰æ‹©å“åº”æ—¶é—´ï¼š200ms â†’ <100ms
- æ‰¹é‡å¤„ç†ï¼ˆ100è‚¡ç¥¨ï¼‰ï¼š10ç§’ â†’ <5ç§’
- ç¼“å­˜å‘½ä¸­ç‡ï¼š60% â†’ 80%+

### ç¨³å®šæ€§æå‡
- ç³»ç»Ÿå¯ç”¨æ€§ï¼š95% â†’ 99.9%
- é™çº§æˆåŠŸç‡ï¼š80% â†’ 100%
- å¼‚å¸¸å¤„ç†è¦†ç›–ç‡ï¼š70% â†’ 95%+

### å¯ç»´æŠ¤æ€§æå‡
- è§„åˆ™é…ç½®åŒ–ï¼šç¡¬ç¼–ç  â†’ JSONé…ç½®
- ç›‘æ§è¦†ç›–ç‡ï¼š50% â†’ 90%+
- å‘Šè­¦å“åº”æ—¶é—´ï¼š10åˆ†é’Ÿ â†’ 1åˆ†é’Ÿ

---

## ğŸ¯ å®æ–½ä¼˜å…ˆçº§

### é«˜ä¼˜å…ˆçº§ï¼ˆå¿…é¡»å®ç°ï¼‰
1. âœ… ä¸‰å±‚è§„åˆ™ä½“ç³»
2. âœ… æ··åˆå†³ç­–æ¨¡å‹
3. âœ… æ•°æ®è´¨é‡ç®¡æ§
4. âœ… è½»é‡çº§é™çº§æœºåˆ¶

### ä¸­ä¼˜å…ˆçº§ï¼ˆé‡è¦ä½†å¯åç½®ï¼‰
5. âœ… åˆ†å±‚ç¼“å­˜ä½“ç³»
6. âœ… å¹¶è¡Œè®¡ç®—æ¡†æ¶
7. âœ… ç›‘æ§ä¸å‘Šè­¦

### ä½ä¼˜å…ˆçº§ï¼ˆä¼˜åŒ–é¡¹ï¼‰
8. âœ… å®æ—¶æ•°æ®æ›´æ–°ç®¡é“

---

## ğŸš€ æ€»ç»“

é€šè¿‡å€Ÿé‰´å’Œèåˆè¿™8ä¸ªæ ¸å¿ƒè®¾è®¡ç²¾åï¼Œæˆ‘ä»¬çš„ç³»ç»Ÿå°†å®ç°ï¼š

1. **æ›´æ™ºèƒ½çš„å†³ç­–**ï¼šä¸‰å±‚è§„åˆ™ä½“ç³»+æ··åˆå†³ç­–æ¨¡å‹
2. **æ›´é«˜çš„æ€§èƒ½**ï¼šåˆ†å±‚ç¼“å­˜+å¹¶è¡Œè®¡ç®—
3. **æ›´å¼ºçš„ç¨³å®šæ€§**ï¼šé™çº§æœºåˆ¶+ç›‘æ§å‘Šè­¦
4. **æ›´å¥½çš„å¯ç»´æŠ¤æ€§**ï¼šè§„åˆ™é…ç½®åŒ–+æ•°æ®è´¨é‡ç®¡æ§

è¿™äº›è®¾è®¡ä¸ä»…æå‡äº†ç³»ç»Ÿçš„æŠ€æœ¯æŒ‡æ ‡ï¼Œæ›´é‡è¦çš„æ˜¯ç¡®ä¿äº†ç³»ç»Ÿçš„**å¯é æ€§ã€å¯æ‰©å±•æ€§å’Œå¯ç»´æŠ¤æ€§**ï¼Œä¸ºåç»­çš„æŒç»­ä¼˜åŒ–å¥ å®šäº†åšå®åŸºç¡€ã€‚

---

**æ–‡æ¡£åˆ›å»º**: 2025-12-15  
**ä½œè€…**: InvestMind Pro Team
