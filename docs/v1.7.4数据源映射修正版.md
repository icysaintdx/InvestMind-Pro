# v1.7.4 数据源映射修正版

**发布日期**: 2024-12-04 21:35  
**版本**: v1.7.4

## 🎯 核心修复

### 问题描述

**前端配置的数据源映射与后端实际返回的不一致**

**错误的映射**（不存在的数据源）:
```javascript
❌ 'stock_info_cjzc_em'
❌ 'stock_info_global_em'
❌ 'stock_info_global_sina'
❌ 'stock_info_global_futu'
❌ 'stock_info_global_ths'
❌ 'stock_news_em'
❌ 'stock_info_broker_sina'
```

**正确的映射**（后端实际返回）:
```javascript
✅ 'realtime_news'
✅ 'akshare_stock_news'
✅ 'cls_telegraph'
✅ 'weibo_hot'
✅ 'morning_news'
✅ 'global_news_em'
✅ 'global_news_sina'
✅ 'futu_news'
✅ 'ths_news'
```

## 📊 真实的数据源映射表

| 序号 | 后端键名 | 后端source字段 | 前端显示名称 |
|------|---------|---------------|-------------|
| 1 | `realtime_news` | 实时新闻聚合器（东方财富） | 实时新闻聚合器（东方财富） |
| 2 | `akshare_stock_news` | AKShare（东方财富） | AKShare个股新闻 |
| 3 | `cls_telegraph` | 财联社 | 财联社快讯 |
| 4 | `weibo_hot` | 微博热议 | 微博热议 |
| 5 | `morning_news` | 东方财富财经早餐 | 财经早餐（东方财富） |
| 6 | `global_news_em` | 东方财富全球新闻 | 东方财富全球财经 |
| 7 | `global_news_sina` | 新浪财经 | 新浪全球财经 |
| 8 | `futu_news` | 富途牛牛 | 富途财经新闻 |
| 9 | `ths_news` | 同花顺 | 同花顺财经新闻 |

## 💻 修正后的配置

```javascript
// 数据源名称映射（与后端 unified_news_api.py 一致）
const SOURCE_NAME_MAP = {
  // 9个真实的数据源
  'realtime_news': '实时新闻聚合器（东方财富）',
  'akshare_stock_news': 'AKShare个股新闻',
  'cls_telegraph': '财联社快讯',
  'weibo_hot': '微博热议',
  'morning_news': '财经早餐（东方财富）',
  'global_news_em': '东方财富全球财经',
  'global_news_sina': '新浪全球财经',
  'futu_news': '富途财经新闻',
  'ths_news': '同花顺财经新闻'
}
```

## 🔍 数据源验证

### 后端代码位置

**文件**: `backend/dataflows/news/unified_news_api.py`

```python
# 数据源1 (行69)
result['sources']['realtime_news'] = {
    'source': '实时新闻聚合器（东方财富）'
}

# 数据源2 (行96)
result['sources']['akshare_stock_news'] = {
    'source': 'AKShare（东方财富）'
}

# 数据源3 (行123)
result['sources']['cls_telegraph'] = {
    'source': '财联社'
}

# 数据源4 (行150)
result['sources']['weibo_hot'] = {
    'source': '微博热议'
}

# 数据源5 (行177)
result['sources']['morning_news'] = {
    'source': '东方财富财经早餐'
}

# 数据源6 (行200)
result['sources']['global_news_em'] = {
    'source': '东方财富全球新闻'
}

# 数据源7 (行219)
result['sources']['global_news_sina'] = {
    'source': '新浪财经'
}

# 数据源8 (行238)
result['sources']['futu_news'] = {
    'source': '富途牛牛'
}

# 数据源9 (行257)
result['sources']['ths_news'] = {
    'source': '同花顺'
}
```

## 📋 修改的文件

| 文件 | 修改内容 |
|------|---------|
| `AnalysisView.vue` | 删除7个不存在的映射 |
| `AnalysisView.vue` | 保留9个真实的数据源映射 |
| `AnalysisView.vue` | 添加注释说明与后端一致 |

## ✅ 修复效果

### 修复前

**新闻面板显示**:
```
❌ stock_info_cjzc_em     (原始键名，无映射)
❌ stock_info_global_em   (原始键名，无映射)
✅ cls_telegraph          (有映射)
✅ weibo_hot              (有映射)
```

### 修复后

**新闻面板显示**:
```
✅ 实时新闻聚合器（东方财富）
✅ AKShare个股新闻
✅ 财联社快讯
✅ 微博热议
✅ 财经早餐（东方财富）
✅ 东方财富全球财经
✅ 新浪全球财经
✅ 富途财经新闻
✅ 同花顺财经新闻
```

## 🎨 显示示例

### 智能体卡片

```
📊 参考数据  12个来源 | 123条数据
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
东方财富 (贵州茅台：最新市场动态分析)
新浪财经 (贵州茅台所属行业板块走势分析)
雪球社区 (贵州茅台投资者情绪报告)
实时新闻聚合器（东方财富） (3条数据)
AKShare个股新闻 (10条数据)
财联社快讯 (10条数据)
微博热议 (50条数据)
财经早餐（东方财富） (10条数据)
东方财富全球财经 (10条数据)
新浪全球财经 (10条数据)
富途财经新闻 (10条数据)
同花顺财经新闻 (10条数据)
```

### 新闻面板

```
📰 新闻舆情透明面板
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 实时新闻聚合器（东方财富）
✅ AKShare个股新闻
✅ 财联社快讯
✅ 微博热议
✅ 财经早餐（东方财富）
✅ 东方财富全球财经
✅ 新浪全球财经
✅ 富途财经新闻
✅ 同花顺财经新闻
```

## 🚀 验证清单

- [x] 删除不存在的数据源映射
- [x] 保留9个真实的数据源映射
- [x] 键名与后端完全一致
- [x] 显示名称友好易懂
- [x] 添加注释说明来源

## 💡 技术说明

### 为什么之前的映射是错误的？

1. **历史遗留**: 之前可能使用了不同的数据源
2. **举例说明**: 用户提供的是示例，不是实际的键名
3. **后端变更**: 后端统一使用了新的数据源

### 如何验证映射是否正确？

1. 查看后端代码 `unified_news_api.py`
2. 查看后端日志中的数据源键名
3. 查看前端控制台的 `newsData.sources` 输出

### 映射的作用

```javascript
// 后端返回
{
  sources: {
    'ths_news': { 
      status: 'success', 
      source: '同花顺',  // 后端的source字段
      count: 10 
    }
  }
}

// 前端映射
const friendlyName = SOURCE_NAME_MAP['ths_news']
// 结果: '同花顺财经新闻'

// 最终显示
显示: 同花顺财经新闻 ✅
```

## 🎉 总结

本次修复：
1. ✅ 删除7个不存在的数据源映射
2. ✅ 确认9个真实的数据源映射
3. ✅ 与后端代码完全一致
4. ✅ 所有数据源都能正确显示

**现在前端映射与后端完全一致！**🎉
