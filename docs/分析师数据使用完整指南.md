# åˆ†æå¸ˆæ•°æ®ä½¿ç”¨å®Œæ•´æŒ‡å—

**åˆ›å»ºæ—¶é—´**: 2025-12-05 06:50  
**çŠ¶æ€**: âœ… æ‰€æœ‰æ•°æ®å·²å°±ç»ª

---

## ğŸ¯ æ¦‚è§ˆ

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•è®©æ¯ä¸ªåˆ†æå¸ˆçœŸæ­£ä½¿ç”¨å·²é›†æˆçš„æ•°æ®ã€‚

---

## âœ… å·²å®Œæˆçš„åˆ†æå¸ˆ

### 1. ç¤¾äº¤åª’ä½“åˆ†æå¸ˆ (social_analyst) âœ…

**æ–‡ä»¶**: `backend/agents/analysts/social_media_analyst.py`

**å·²æ·»åŠ çš„APIè¯´æ˜**:
```python
ğŸ“Š æ•°æ®è·å–æ–¹å¼ï¼š
æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹ API ç«¯ç‚¹è·å–å®æ—¶ç¤¾äº¤åª’ä½“æ•°æ®ï¼š
- GET http://localhost:8000/api/akshare/social-media/weibo/stock-hot  # å¾®åšè‚¡ç¥¨çƒ­è®®
- GET http://localhost:8000/api/akshare/social-media/weibo/hot-search  # å¾®åšçƒ­æœ
- GET http://localhost:8000/api/akshare/social-media/all  # ç»¼åˆç¤¾äº¤åª’ä½“æ•°æ®
```

**å¯ç”¨æ•°æ®**:
- å¾®åšè‚¡ç¥¨çƒ­è®® (50æ¡)
- å¾®åšçƒ­æœ (50æ¡)
- ç™¾åº¦çƒ­æœè‚¡ç¥¨ (12æ¡)

**æµ‹è¯•å‘½ä»¤**:
```bash
curl http://localhost:8000/api/akshare/social-media/all
```

---

### 2. åŸºæœ¬é¢ä¼°å€¼åˆ†æå¸ˆ (fundamental) âœ…

**æ–‡ä»¶**: `backend/agents/analysts/fundamentals_analyst.py`

**å·²æ·»åŠ çš„APIè¯´æ˜**:
```python
ğŸ“Š æ•°æ®è·å–æ–¹å¼ï¼š
æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹ API ç«¯ç‚¹è·å–å®æ—¶è´¢åŠ¡æ•°æ®ï¼š
- GET http://localhost:8000/api/akshare/financial/{ticker}  # ä¸‰å¤§è´¢åŠ¡æŠ¥è¡¨
- GET http://localhost:8000/api/akshare/financial/{ticker}/summary  # æœ€æ–°è´¢åŠ¡æ‘˜è¦
```

**å¯ç”¨æ•°æ®**:
- èµ„äº§è´Ÿå€ºè¡¨ (100æœŸ/25å¹´)
- åˆ©æ¶¦è¡¨ (100æœŸ/25å¹´/87å­£)
- ç°é‡‘æµé‡è¡¨ (96æœŸ/20å¹´/83å­£)
- æœ€æ–°è´¢åŠ¡æ‘˜è¦ (776ä¸ªå­—æ®µ)

**æµ‹è¯•å‘½ä»¤**:
```bash
curl http://localhost:8000/api/akshare/financial/600519/summary
```

---

### 3. èµ„é‡‘æµå‘åˆ†æå¸ˆ (funds) âœ…

**æ¨¡å¼**: Legacyæ¨¡å¼

**å¯ç”¨æ•°æ®**:
- åŒ—å‘èµ„é‡‘å®æ—¶ (241æ¡)
- åŒ—å‘èµ„é‡‘å†å² (2569æ¡)
- æŒè‚¡æ’å (2767æ¡)
- ä¸ªè‚¡èµ„é‡‘æµ (5155æ¡)
- è¡Œä¸šèµ„é‡‘æµ (90æ¡)
- æ¦‚å¿µèµ„é‡‘æµ (386æ¡)
- èèµ„èåˆ¸ (21æ¡)

**APIç«¯ç‚¹**:
```
GET /api/akshare/fund-flow/{symbol}
GET /api/akshare/fund-flow/north-bound/realtime
GET /api/akshare/fund-flow/industry/realtime
GET /api/akshare/fund-flow/concept/realtime
```

**æµ‹è¯•å‘½ä»¤**:
```bash
curl http://localhost:8000/api/akshare/fund-flow/600519
```

**è¯´æ˜**: Legacyæ¨¡å¼çš„åˆ†æå¸ˆé€šè¿‡å·¥å…·è‡ªåŠ¨è·å–æ•°æ®ï¼Œæ— éœ€ä¿®æ”¹æç¤ºè¯ã€‚

---

## â³ éœ€è¦æ·»åŠ çš„åˆ†æå¸ˆ

### 4. è¡Œä¸šè½®åŠ¨åˆ†æå¸ˆ (industry) â³

**çŠ¶æ€**: æ•°æ®å·²å°±ç»ªï¼Œéœ€æ·»åŠ æç¤ºè¯è¯´æ˜

**å¯ç”¨æ•°æ®**:
- è¡Œä¸šèµ„é‡‘æµå‘ (90æ¡)
- æ¦‚å¿µèµ„é‡‘æµå‘ (386æ¡)

**APIç«¯ç‚¹**:
```
GET /api/akshare/fund-flow/industry/realtime
GET /api/akshare/fund-flow/concept/realtime
```

**å»ºè®®æ·»åŠ çš„æç¤ºè¯**:
```python
ğŸ“Š æ•°æ®è·å–æ–¹å¼ï¼š
æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹ API ç«¯ç‚¹è·å–å®æ—¶è¡Œä¸šæ•°æ®ï¼š
- GET http://localhost:8000/api/akshare/fund-flow/industry/realtime  # è¡Œä¸šèµ„é‡‘æµå‘
- GET http://localhost:8000/api/akshare/fund-flow/concept/realtime  # æ¦‚å¿µèµ„é‡‘æµå‘

æ‚¨çš„ä¸»è¦èŒè´£åŒ…æ‹¬ï¼š
1. åˆ†æè¡Œä¸šèµ„é‡‘æµå‘å˜åŒ–
2. è¯†åˆ«çƒ­é—¨æ¿å—å’Œæ¦‚å¿µ
3. åˆ¤æ–­è¡Œä¸šè½®åŠ¨è¶‹åŠ¿
4. æä¾›æ¿å—é…ç½®å»ºè®®
```

**ä¿®æ”¹ä½ç½®**: 
- å¦‚æœæ˜¯ç‹¬ç«‹æ–‡ä»¶: `backend/agents/analysts/industry_analyst.py`
- å¦‚æœæ˜¯legacy: é€šè¿‡agent_registryé…ç½®

---

## ğŸ“Š æ•°æ®ä½¿ç”¨æ–¹å¼å¯¹æ¯”

### æ–¹å¼1: æç¤ºè¯ä¸­è¯´æ˜APIï¼ˆæ¨èï¼‰

**ä¼˜ç‚¹**:
- LLMå¯ä»¥ç›´æ¥ç†è§£å¦‚ä½•è·å–æ•°æ®
- çµæ´»ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è°ƒç”¨
- é€‚åˆç°ä»£LLMï¼ˆå¦‚GPT-4ã€Claudeï¼‰

**ç¤ºä¾‹**:
```python
system_message = """
æ‚¨æ˜¯ä¸€ä½ä¸“ä¸šçš„åˆ†æå¸ˆ...

ğŸ“Š æ•°æ®è·å–æ–¹å¼ï¼š
æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹ API ç«¯ç‚¹è·å–æ•°æ®ï¼š
- GET http://localhost:8000/api/akshare/xxx

æ‚¨çš„ä¸»è¦èŒè´£åŒ…æ‹¬...
"""
```

**å·²ä½¿ç”¨**: ç¤¾äº¤åª’ä½“åˆ†æå¸ˆã€åŸºæœ¬é¢ä¼°å€¼åˆ†æå¸ˆ

---

### æ–¹å¼2: å·¥å…·è‡ªåŠ¨è°ƒç”¨ï¼ˆLegacyï¼‰

**ä¼˜ç‚¹**:
- è‡ªåŠ¨åŒ–ï¼Œæ— éœ€LLMç†è§£API
- ç¨³å®šï¼Œä¸ä¾èµ–LLMèƒ½åŠ›
- é€‚åˆå¤æ‚çš„æ•°æ®å¤„ç†

**ç¤ºä¾‹**:
```python
tools = [
    toolkit.get_fund_flow_data,
    toolkit.get_industry_data
]
```

**å·²ä½¿ç”¨**: èµ„é‡‘æµå‘åˆ†æå¸ˆï¼ˆfundsï¼‰

---

### æ–¹å¼3: åœ¨åˆ†ææµç¨‹ä¸­æ³¨å…¥æ•°æ®

**ä¼˜ç‚¹**:
- æœ€ç›´æ¥ï¼Œæ•°æ®è‡ªåŠ¨å¯ç”¨
- ä¸éœ€è¦LLMè°ƒç”¨å·¥å…·
- é€‚åˆå¿…éœ€çš„æ•°æ®

**ç¤ºä¾‹**:
```python
@app.post("/api/analyze")
async def analyze_stock(request: AnalyzeRequest):
    # 1. è·å–æ•°æ®
    fund_flow_data = get_fund_flow_data(symbol)
    social_data = get_social_media_data()
    
    # 2. æ³¨å…¥åˆ°state
    state = {
        "company_of_interest": symbol,
        "fund_flow_data": fund_flow_data,
        "social_media_data": social_data
    }
    
    # 3. è¿è¡Œåˆ†æ
    result = await run_analysis(state)
    return result
```

**å·²ä½¿ç”¨**: æš‚æ— ï¼ˆå¯ä»¥ä½œä¸ºä¼˜åŒ–æ–¹å‘ï¼‰

---

## ğŸ¯ ç¡®ä¿æ•°æ®çœŸå®ä½¿ç”¨çš„æ£€æŸ¥æ¸…å•

### å¯¹äºæ¯ä¸ªåˆ†æå¸ˆï¼Œç¡®è®¤ï¼š

- [ ] **æ•°æ®æ¨¡å—å·²åˆ›å»º** - æ•°æ®è·å–å‡½æ•°å·²å®ç°
- [ ] **APIç«¯ç‚¹å·²æ³¨å†Œ** - å¯ä»¥é€šè¿‡HTTPè®¿é—®
- [ ] **APIæµ‹è¯•é€šè¿‡** - è¿”å›æ­£ç¡®çš„æ•°æ®
- [ ] **æç¤ºè¯å·²æ›´æ–°** - å‘Šè¯‰LLMå¦‚ä½•è·å–æ•°æ®
- [ ] **å®é™…æµ‹è¯•** - è¿è¡Œå®Œæ•´åˆ†ææµç¨‹éªŒè¯

### å½“å‰çŠ¶æ€ï¼š

| åˆ†æå¸ˆ | æ•°æ®æ¨¡å— | APIç«¯ç‚¹ | APIæµ‹è¯• | æç¤ºè¯ | å®é™…æµ‹è¯• |
|--------|---------|---------|---------|--------|---------|
| social_analyst | âœ… | âœ… | âœ… | âœ… | â³ |
| fundamental | âœ… | âœ… | âœ… | âœ… | â³ |
| funds | âœ… | âœ… | âœ… | âœ… (legacy) | â³ |
| industry | âœ… | âœ… | âœ… | â³ | â³ |

---

## ğŸš€ å¿«é€Ÿæ·»åŠ æç¤ºè¯æ¨¡æ¿

### æ¨¡æ¿1: æ•°æ®APIè¯´æ˜

```python
system_message = (
    f"æ‚¨æ˜¯ä¸€ä½ä¸“ä¸šçš„XXXåˆ†æå¸ˆã€‚"
    f"ä»»åŠ¡ï¼šåˆ†æ{company_name}ï¼ˆ{ticker}ï¼‰\n"
    "\nğŸ“Š æ•°æ®è·å–æ–¹å¼ï¼š"
    "æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹ API ç«¯ç‚¹è·å–å®æ—¶æ•°æ®ï¼š"
    f"- GET http://localhost:8000/api/akshare/XXX/{ticker}  # æ•°æ®è¯´æ˜\n"
    "\næ‚¨çš„ä¸»è¦èŒè´£åŒ…æ‹¬ï¼š"
    "1. ..."
    "2. ..."
)
```

### æ¨¡æ¿2: å¤šä¸ªAPIç«¯ç‚¹

```python
system_message = (
    "ğŸ“Š æ•°æ®è·å–æ–¹å¼ï¼š"
    "æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹ API ç«¯ç‚¹è·å–æ•°æ®ï¼š"
    "- GET http://localhost:8000/api/akshare/xxx/aaa  # æ•°æ®A"
    "- GET http://localhost:8000/api/akshare/xxx/bbb  # æ•°æ®B"
    "- GET http://localhost:8000/api/akshare/xxx/ccc  # æ•°æ®C\n"
)
```

---

## ğŸ“ å®é™…æµ‹è¯•æ–¹æ³•

### 1. å•å…ƒæµ‹è¯•ï¼ˆæ•°æ®æ¨¡å—ï¼‰

```bash
python test_akshare_fund_flow.py
python test_akshare_financial.py
python test_social_media_fixed.py
```

### 2. APIæµ‹è¯•ï¼ˆç«¯ç‚¹ï¼‰

```bash
curl http://localhost:8000/api/akshare/social-media/all
curl http://localhost:8000/api/akshare/fund-flow/600519
curl http://localhost:8000/api/akshare/financial/600519/summary
```

### 3. é›†æˆæµ‹è¯•ï¼ˆå®Œæ•´åˆ†æï¼‰

```python
# test_full_analysis.py
import requests

response = requests.post("http://localhost:8000/api/analyze", json={
    "symbol": "600519",
    "date": "2025-12-05"
})

result = response.json()
print("ç¤¾äº¤åª’ä½“æŠ¥å‘Š:", result.get("sentiment_report"))
print("åŸºæœ¬é¢æŠ¥å‘Š:", result.get("fundamentals_report"))
print("èµ„é‡‘æµå‘æŠ¥å‘Š:", result.get("funds_report"))
```

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. æ•°æ®æ ¼å¼åŒ–

ä¸ºLLMæä¾›æ¸…æ™°çš„æ•°æ®æ ¼å¼ï¼š
```python
def format_data_for_llm(data: dict) -> str:
    """æ ¼å¼åŒ–æ•°æ®ä¸ºLLMå‹å¥½çš„æ–‡æœ¬"""
    output = []
    output.append("=" * 60)
    output.append("ğŸ“Š æ•°æ®æ ‡é¢˜")
    output.append("=" * 60)
    output.append(f"å…³é”®æŒ‡æ ‡1: {data.get('key1')}")
    output.append(f"å…³é”®æŒ‡æ ‡2: {data.get('key2')}")
    return "\n".join(output)
```

### 2. é”™è¯¯å¤„ç†

APIè°ƒç”¨å¯èƒ½å¤±è´¥ï¼Œéœ€è¦ä¼˜é›…å¤„ç†ï¼š
```python
try:
    response = requests.get(api_url, timeout=10)
    if response.status_code == 200:
        return response.json()["data"]
    else:
        return f"âŒ APIé”™è¯¯: {response.status_code}"
except Exception as e:
    return f"âŒ è·å–æ•°æ®å¤±è´¥: {str(e)}"
```

### 3. ç¼“å­˜æœºåˆ¶

é¿å…é‡å¤è°ƒç”¨APIï¼š
```python
from functools import lru_cache
from datetime import datetime

@lru_cache(maxsize=100)
def get_data_cached(cache_key: str):
    """ç¼“å­˜çš„æ•°æ®è·å–"""
    return requests.get(api_url).json()

# ä½¿ç”¨æ—¶é—´æˆ³ä½œä¸ºç¼“å­˜é”®
cache_key = datetime.now().strftime("%Y%m%d%H%M")[:11]
data = get_data_cached(cache_key)
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³å¯åšï¼ˆ15åˆ†é’Ÿï¼‰

1. **æ·»åŠ è¡Œä¸šè½®åŠ¨åˆ†æå¸ˆæç¤ºè¯**
   - æ‰¾åˆ°æ–‡ä»¶ä½ç½®
   - æ·»åŠ APIè¯´æ˜
   - æµ‹è¯•éªŒè¯

### æœ¬å‘¨è®¡åˆ’ï¼ˆ2-4å°æ—¶ï¼‰

2. **å®Œæ•´åˆ†ææµç¨‹æµ‹è¯•**
   - åˆ›å»ºé›†æˆæµ‹è¯•è„šæœ¬
   - æµ‹è¯•æ‰€æœ‰åˆ†æå¸ˆ
   - éªŒè¯æ•°æ®çœŸå®ä½¿ç”¨

3. **å‰ç«¯é›†æˆ**
   - ç¤¾äº¤åª’ä½“ä¸“åŒº
   - æ•°æ®å¯è§†åŒ–

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `docs/æ•°æ®é›†æˆä½¿ç”¨æŒ‡å—.md` - å¦‚ä½•ä½¿ç”¨API
- `docs/è®©æ™ºèƒ½ä½“çœŸæ­£ç”¨ä¸Šæ•°æ®-å®æ–½æŒ‡å—.md` - è¯¦ç»†å®æ–½æ­¥éª¤
- `docs/ç¬¬2å‘¨æ•°æ®é›†æˆå®ŒæˆæŠ¥å‘Š.md` - Week 2 æ€»ç»“

---

**æ–‡æ¡£å®Œæˆæ—¶é—´**: 2025-12-05 06:55  
**ä¸‹ä¸€æ­¥**: æ·»åŠ è¡Œä¸šè½®åŠ¨åˆ†æå¸ˆæç¤ºè¯ï¼Œå®Œæˆ100%æ•°æ®ä½¿ç”¨
