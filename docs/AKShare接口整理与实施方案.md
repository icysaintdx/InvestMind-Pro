# AKShareæ¥å£æ•´ç†ä¸å®æ–½æ–¹æ¡ˆ

> åˆ›å»ºæ—¶é—´: 2025-12-04 05:04  
> çŠ¶æ€: ğŸ¯ æ˜ç¡®æ–¹å‘

---

## ğŸ¯ æ ¸å¿ƒç­–ç•¥

### å†³ç­–
1. âœ… **ä¿ç•™**: AKShareçš„ç¨³å®šæ¥å£
2. âŒ **åˆ é™¤**: è‡ªåˆ¶çš„ä¸ç¨³å®šçˆ¬è™«
3. âœ… **æ–°å¢**: çƒ­æœAPIæ¥å£ï¼ˆå…è´¹ç¬¬ä¸‰æ–¹ï¼‰
4. âœ… **ä¸“æ³¨**: æ³•å¾‹åˆè§„ + å…¬å¸å…¬å‘Š

---

## ğŸ“Š AKShareå¯ç”¨æ¥å£åˆ†ç±»

### ä¸€ã€ç»¼åˆè´¢ç»æ–°é—» â­â­â­â­

| æ¥å£åç§° | æ•°æ®æº | åŠŸèƒ½ | ä¼˜å…ˆçº§ |
|---------|-------|------|--------|
| `stock_info_cjzc_em` | ä¸œæ–¹è´¢å¯Œ | è´¢ç»æ—©é¤èµ„è®¯ | é«˜ |
| `stock_info_global_em` | ä¸œæ–¹è´¢å¯Œ | å…¨çƒç»¼åˆè´¢ç»æ–°é—» | é«˜ |
| `stock_info_global_sina` | æ–°æµªè´¢ç» | å…¬å¼€è´¢ç»æ–°é—» | é«˜ |
| `stock_info_global_futu` | å¯Œé€”ç‰›ç‰› | å…¨çƒè´¢ç»æ–°é—»ï¼ˆå«æ¸¯ç¾è‚¡ï¼‰ | ä¸­ |
| `stock_info_global_ths` | åŒèŠ±é¡º | å…¨çƒè´¢ç»æ–°é—» | ä¸­ |

### äºŒã€è¯åˆ¸ä¸“é¡¹æ–°é—» â­â­â­â­â­ï¼ˆæ ¸å¿ƒï¼‰

| æ¥å£åç§° | æ•°æ®æº | åŠŸèƒ½ | æ•°æ®é‡ | ä¼˜å…ˆçº§ |
|---------|-------|------|--------|--------|
| `stock_news_em` | ä¸œæ–¹è´¢å¯Œ | **ä¸ªè‚¡æ–°é—»**ï¼ˆæŒ‡å®šè‚¡ç¥¨ä»£ç ï¼‰ | 100æ¡/æ¬¡ | **æœ€é«˜** |
| `stock_info_broker_sina` | æ–°æµªè´¢ç» | è¯åˆ¸åŸåˆ›æ–°é—»ã€åˆ¸å•†è§£è¯» | - | é«˜ |

**é‡ç‚¹**: `stock_news_em` æ˜¯ä¸ªè‚¡èˆ†æƒ…åˆ†æçš„æ ¸å¿ƒæ¥å£ï¼

### ä¸‰ã€å¿«è®¯ç±»æ–°é—» â­â­â­â­

| æ¥å£åç§° | æ•°æ®æº | åŠŸèƒ½ | æ•°æ®é‡ | ä¼˜å…ˆçº§ |
|---------|-------|------|--------|--------|
| `stock_info_global_cls` | è´¢è”ç¤¾ | ç”µæŠ¥å¿«è®¯ï¼ˆçªå‘æ¶ˆæ¯ï¼‰ | 20æ¡/æ¬¡ | é«˜ |

**ç‰¹ç‚¹**: æ—¶æ•ˆæ€§å¼ºï¼Œé€‚åˆæ•æ‰çªå‘æ¶ˆæ¯

### å››ã€å¾®åšçƒ­æœæ•°æ® â­â­â­

| æ¥å£åç§° | æ•°æ®æº | åŠŸèƒ½ | ä¼˜å…ˆçº§ |
|---------|-------|------|--------|
| `stock_js_weibo_report` | å¾®åš | è‚¡ç¥¨çƒ­è®®æ’è¡Œ | ä¸­ |

---

## ğŸ”¥ çƒ­æœAPIæ¥å£ï¼ˆç¬¬ä¸‰æ–¹å…è´¹ï¼‰

### æ¨èä½¿ç”¨çš„çƒ­æœAPI

| API | æ•°æ®æº | è´¹ç”¨ | ä¼˜å…ˆçº§ |
|-----|-------|------|--------|
| å¾®åšçƒ­æœ | https://api.aa1.cn/api/weibo-rs | å…è´¹ | é«˜ |
| ç™¾åº¦çƒ­æœ | https://api.aa1.cn/api/baidu-rs | å…è´¹ | é«˜ |
| çŸ¥ä¹çƒ­æœ | https://api.aa1.cn/api/zhihu-rs | å…è´¹ | ä¸­ |

**ç”¨é€”**: è¾…åŠ©åˆ¤æ–­å¸‚åœºå…³æ³¨åº¦å’Œçƒ­ç‚¹é¢˜æ

---

## ğŸš€ å®æ–½æ–¹æ¡ˆ

### é˜¶æ®µ1: æ¸…ç†ä¸é‡æ„ï¼ˆä»Šå¤©ï¼Œ2å°æ—¶ï¼‰

#### ä»»åŠ¡1: åˆ é™¤ä¸ç¨³å®šçš„çˆ¬è™«
```bash
# åˆ é™¤æˆ–æ ‡è®°ä¸ºåºŸå¼ƒ
backend/dataflows/news/china_market_crawler.py  # åˆ é™¤
backend/dataflows/news/social_media_crawler.py  # åˆ é™¤
backend/dataflows/news/weibo_hot_search.py      # ä¿ç•™ï¼ˆä½¿ç”¨ç¬¬ä¸‰æ–¹APIï¼‰
```

#### ä»»åŠ¡2: åˆ›å»ºæ–°çš„AKShareæ¥å£å°è£…
**æ–‡ä»¶**: `backend/dataflows/news/akshare_news_api.py`

```python
#!/usr/bin/env python3
"""
AKShareæ–°é—»æ¥å£å°è£…
ä½¿ç”¨ç¨³å®šçš„AKShareæ¥å£
"""

import akshare as ak
from typing import List, Dict, Any
from backend.utils.logging_config import get_logger

logger = get_logger("akshare_news")


class AKShareNewsAPI:
    """AKShareæ–°é—»APIå°è£…"""
    
    def __init__(self):
        logger.info(f"åˆå§‹åŒ–AKShareæ–°é—»APIï¼Œç‰ˆæœ¬: {ak.__version__}")
    
    # ========== æ ¸å¿ƒæ¥å£ ==========
    
    def get_stock_news(self, symbol: str) -> List[Dict[str, Any]]:
        """
        è·å–ä¸ªè‚¡æ–°é—»ï¼ˆæœ€é‡è¦ï¼‰
        æ¥å£: stock_news_em
        æ•°æ®é‡: 100æ¡/æ¬¡
        """
        try:
            logger.info(f"è·å–{symbol}çš„ä¸ªè‚¡æ–°é—»...")
            clean_symbol = symbol.replace('.SH', '').replace('.SZ', '')
            
            df = ak.stock_news_em(symbol=clean_symbol)
            
            if df is None or len(df) == 0:
                return []
            
            # è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼
            news_list = []
            for _, row in df.iterrows():
                news_list.append({
                    'title': str(row.get('æ–°é—»æ ‡é¢˜', '')),
                    'content': str(row.get('æ–°é—»å†…å®¹', '')),
                    'publish_time': str(row.get('å‘å¸ƒæ—¶é—´', '')),
                    'source': str(row.get('æ–‡ç« æ¥æº', 'ä¸œæ–¹è´¢å¯Œ')),
                    'url': str(row.get('æ–°é—»é“¾æ¥', ''))
                })
            
            logger.info(f"âœ… è·å–{symbol}æ–°é—» {len(news_list)} æ¡")
            return news_list
            
        except Exception as e:
            logger.error(f"âŒ è·å–ä¸ªè‚¡æ–°é—»å¤±è´¥: {e}")
            return []
    
    # ========== ç»¼åˆæ–°é—» ==========
    
    def get_morning_news(self) -> List[Dict[str, Any]]:
        """
        è·å–è´¢ç»æ—©é¤
        æ¥å£: stock_info_cjzc_em
        """
        try:
            logger.info("è·å–è´¢ç»æ—©é¤...")
            df = ak.stock_info_cjzc_em()
            
            if df is None or len(df) == 0:
                return []
            
            news_list = []
            for _, row in df.iterrows():
                news_list.append({
                    'title': str(row.get('æ ‡é¢˜', '')),
                    'content': str(row.get('å†…å®¹', '')),
                    'publish_time': str(row.get('å‘å¸ƒæ—¶é—´', '')),
                    'source': 'ä¸œæ–¹è´¢å¯Œ',
                    'url': ''
                })
            
            logger.info(f"âœ… è·å–è´¢ç»æ—©é¤ {len(news_list)} æ¡")
            return news_list
            
        except Exception as e:
            logger.error(f"âŒ è·å–è´¢ç»æ—©é¤å¤±è´¥: {e}")
            return []
    
    def get_global_news_em(self) -> List[Dict[str, Any]]:
        """
        è·å–å…¨çƒè´¢ç»æ–°é—»ï¼ˆä¸œæ–¹è´¢å¯Œï¼‰
        æ¥å£: stock_info_global_em
        """
        try:
            logger.info("è·å–å…¨çƒè´¢ç»æ–°é—»ï¼ˆä¸œæ–¹è´¢å¯Œï¼‰...")
            df = ak.stock_info_global_em()
            
            if df is None or len(df) == 0:
                return []
            
            news_list = []
            for _, row in df.iterrows():
                news_list.append({
                    'title': str(row.get('æ ‡é¢˜', '')),
                    'content': str(row.get('å†…å®¹', '')),
                    'publish_time': str(row.get('å‘å¸ƒæ—¶é—´', '')),
                    'source': 'ä¸œæ–¹è´¢å¯Œ',
                    'url': str(row.get('é“¾æ¥', ''))
                })
            
            logger.info(f"âœ… è·å–å…¨çƒè´¢ç»æ–°é—» {len(news_list)} æ¡")
            return news_list
            
        except Exception as e:
            logger.error(f"âŒ è·å–å…¨çƒè´¢ç»æ–°é—»å¤±è´¥: {e}")
            return []
    
    def get_global_news_sina(self) -> List[Dict[str, Any]]:
        """
        è·å–å…¨çƒè´¢ç»æ–°é—»ï¼ˆæ–°æµªï¼‰
        æ¥å£: stock_info_global_sina
        """
        try:
            logger.info("è·å–å…¨çƒè´¢ç»æ–°é—»ï¼ˆæ–°æµªï¼‰...")
            df = ak.stock_info_global_sina()
            
            if df is None or len(df) == 0:
                return []
            
            news_list = []
            for _, row in df.iterrows():
                news_list.append({
                    'title': str(row.get('æ ‡é¢˜', '')),
                    'content': str(row.get('å†…å®¹', '')),
                    'publish_time': str(row.get('å‘å¸ƒæ—¶é—´', '')),
                    'source': 'æ–°æµªè´¢ç»',
                    'url': str(row.get('é“¾æ¥', ''))
                })
            
            logger.info(f"âœ… è·å–å…¨çƒè´¢ç»æ–°é—»ï¼ˆæ–°æµªï¼‰ {len(news_list)} æ¡")
            return news_list
            
        except Exception as e:
            logger.error(f"âŒ è·å–å…¨çƒè´¢ç»æ–°é—»ï¼ˆæ–°æµªï¼‰å¤±è´¥: {e}")
            return []
    
    # ========== å¿«è®¯ ==========
    
    def get_cls_telegraph(self) -> List[Dict[str, Any]]:
        """
        è·å–è´¢è”ç¤¾ç”µæŠ¥å¿«è®¯
        æ¥å£: stock_info_global_cls
        æ•°æ®é‡: 20æ¡/æ¬¡
        """
        try:
            logger.info("è·å–è´¢è”ç¤¾ç”µæŠ¥å¿«è®¯...")
            df = ak.stock_info_global_cls()
            
            if df is None or len(df) == 0:
                return []
            
            news_list = []
            for _, row in df.iterrows():
                news_list.append({
                    'title': str(row.get('æ ‡é¢˜', '')),
                    'content': str(row.get('å†…å®¹', '')),
                    'publish_time': str(row.get('å‘å¸ƒæ—¶é—´', '')),
                    'source': 'è´¢è”ç¤¾',
                    'url': ''
                })
            
            logger.info(f"âœ… è·å–è´¢è”ç¤¾å¿«è®¯ {len(news_list)} æ¡")
            return news_list
            
        except Exception as e:
            logger.error(f"âŒ è·å–è´¢è”ç¤¾å¿«è®¯å¤±è´¥: {e}")
            return []
    
    # ========== å¾®åšçƒ­è®® ==========
    
    def get_weibo_stock_hot(self) -> List[Dict[str, Any]]:
        """
        è·å–å¾®åšè‚¡ç¥¨çƒ­è®®
        æ¥å£: stock_js_weibo_report
        """
        try:
            logger.info("è·å–å¾®åšè‚¡ç¥¨çƒ­è®®...")
            df = ak.stock_js_weibo_report()
            
            if df is None or len(df) == 0:
                return []
            
            # æ‰“å°åˆ—åç”¨äºè°ƒè¯•
            logger.info(f"å¾®åšçƒ­è®®æ•°æ®åˆ—: {list(df.columns)}")
            
            hot_list = df.to_dict('records')
            
            logger.info(f"âœ… è·å–å¾®åšçƒ­è®® {len(hot_list)} æ¡")
            return hot_list
            
        except Exception as e:
            logger.error(f"âŒ è·å–å¾®åšçƒ­è®®å¤±è´¥: {e}")
            return []


# å…¨å±€å®ä¾‹
_akshare_news_api = None

def get_akshare_news_api():
    """è·å–AKShareæ–°é—»APIå®ä¾‹ï¼ˆå•ä¾‹ï¼‰"""
    global _akshare_news_api
    if _akshare_news_api is None:
        _akshare_news_api = AKShareNewsAPI()
    return _akshare_news_api
```

#### ä»»åŠ¡3: åˆ›å»ºçƒ­æœAPIæ¥å£
**æ–‡ä»¶**: `backend/dataflows/news/hot_search_api.py`

```python
#!/usr/bin/env python3
"""
çƒ­æœAPIæ¥å£
ä½¿ç”¨ç¬¬ä¸‰æ–¹å…è´¹API
"""

import requests
from typing import List, Dict, Any
from backend.utils.logging_config import get_logger

logger = get_logger("hot_search")


class HotSearchAPI:
    """çƒ­æœAPI"""
    
    def __init__(self):
        self.session = requests.Session()
        self.session.headers.update({
            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36'
        })
        
        # è‚¡ç¥¨å…³é”®è¯
        self.stock_keywords = [
            'è‚¡ç¥¨', 'è‚¡å¸‚', 'Aè‚¡', 'æ¸¯è‚¡', 'ç¾è‚¡',
            'èŒ…å°', 'æ¯”äºšè¿ª', 'å®å¾·æ—¶ä»£', 'è…¾è®¯', 'é˜¿é‡Œ',
            'æ¶¨åœ', 'è·Œåœ', 'ç‰›å¸‚', 'ç†Šå¸‚',
            'æ–°èƒ½æº', 'èŠ¯ç‰‡', 'åŠå¯¼ä½“', 'åŒ»è¯', 'ç™½é…’'
        ]
    
    def get_weibo_hot(self) -> List[Dict[str, Any]]:
        """è·å–å¾®åšçƒ­æœ"""
        try:
            url = "https://api.aa1.cn/api/weibo-rs"
            response = self.session.get(url, timeout=10)
            
            if response.status_code == 200:
                data = response.json()
                logger.info(f"âœ… è·å–å¾®åšçƒ­æœæˆåŠŸ")
                return data if isinstance(data, list) else data.get('data', [])
            else:
                logger.error(f"âŒ è·å–å¾®åšçƒ­æœå¤±è´¥: {response.status_code}")
                return []
                
        except Exception as e:
            logger.error(f"âŒ è·å–å¾®åšçƒ­æœå¤±è´¥: {e}")
            return []
    
    def get_baidu_hot(self) -> List[Dict[str, Any]]:
        """è·å–ç™¾åº¦çƒ­æœ"""
        try:
            url = "https://api.aa1.cn/api/baidu-rs"
            response = self.session.get(url, timeout=10)
            
            if response.status_code == 200:
                data = response.json()
                logger.info(f"âœ… è·å–ç™¾åº¦çƒ­æœæˆåŠŸ")
                return data if isinstance(data, list) else data.get('data', [])
            else:
                logger.error(f"âŒ è·å–ç™¾åº¦çƒ­æœå¤±è´¥: {response.status_code}")
                return []
                
        except Exception as e:
            logger.error(f"âŒ è·å–ç™¾åº¦çƒ­æœå¤±è´¥: {e}")
            return []
    
    def filter_stock_topics(self, hot_list: List[Dict]) -> List[Dict]:
        """è¿‡æ»¤è‚¡ç¥¨ç›¸å…³è¯é¢˜"""
        filtered = []
        for item in hot_list:
            title = str(item.get('title', '') or item.get('word', '') or item.get('query', ''))
            if any(kw in title for kw in self.stock_keywords):
                filtered.append(item)
        return filtered


# å…¨å±€å®ä¾‹
_hot_search_api = None

def get_hot_search_api():
    """è·å–çƒ­æœAPIå®ä¾‹ï¼ˆå•ä¾‹ï¼‰"""
    global _hot_search_api
    if _hot_search_api is None:
        _hot_search_api = HotSearchAPI()
    return _hot_search_api
```

---

### é˜¶æ®µ2: æµ‹è¯•éªŒè¯ï¼ˆä»Šå¤©ï¼Œ1å°æ—¶ï¼‰

åˆ›å»ºæµ‹è¯•è„šæœ¬ `test_final_news_api.py`:

```python
#!/usr/bin/env python3
"""
æµ‹è¯•æœ€ç»ˆçš„æ–°é—»API
"""

from backend.dataflows.news.akshare_news_api import get_akshare_news_api
from backend.dataflows.news.hot_search_api import get_hot_search_api

print("=" * 80)
print("ğŸ§ª æµ‹è¯•AKShareæ–°é—»API")
print("=" * 80)

api = get_akshare_news_api()

# æµ‹è¯•1: ä¸ªè‚¡æ–°é—»ï¼ˆæ ¸å¿ƒï¼‰
print("\nğŸ“° æµ‹è¯•1: ä¸ªè‚¡æ–°é—»")
news = api.get_stock_news("600519")
print(f"ç»“æœ: {len(news)} æ¡")

# æµ‹è¯•2: è´¢ç»æ—©é¤
print("\nâ˜• æµ‹è¯•2: è´¢ç»æ—©é¤")
morning = api.get_morning_news()
print(f"ç»“æœ: {len(morning)} æ¡")

# æµ‹è¯•3: è´¢è”ç¤¾å¿«è®¯
print("\nâš¡ æµ‹è¯•3: è´¢è”ç¤¾å¿«è®¯")
cls = api.get_cls_telegraph()
print(f"ç»“æœ: {len(cls)} æ¡")

# æµ‹è¯•4: å¾®åšçƒ­è®®
print("\nğŸ”¥ æµ‹è¯•4: å¾®åšçƒ­è®®")
weibo = api.get_weibo_stock_hot()
print(f"ç»“æœ: {len(weibo)} æ¡")

print("\n" + "=" * 80)
print("ğŸ§ª æµ‹è¯•çƒ­æœAPI")
print("=" * 80)

hot_api = get_hot_search_api()

# æµ‹è¯•5: å¾®åšçƒ­æœ
print("\nğŸ“± æµ‹è¯•5: å¾®åšçƒ­æœ")
weibo_hot = hot_api.get_weibo_hot()
print(f"ç»“æœ: {len(weibo_hot)} æ¡")
stock_topics = hot_api.filter_stock_topics(weibo_hot)
print(f"è‚¡ç¥¨ç›¸å…³: {len(stock_topics)} æ¡")

# æµ‹è¯•6: ç™¾åº¦çƒ­æœ
print("\nğŸ” æµ‹è¯•6: ç™¾åº¦çƒ­æœ")
baidu_hot = hot_api.get_baidu_hot()
print(f"ç»“æœ: {len(baidu_hot)} æ¡")
```

---

### é˜¶æ®µ3: é›†æˆåˆ°ç»Ÿä¸€APIï¼ˆæ˜å¤©ï¼Œ2å°æ—¶ï¼‰

åˆ›å»ºç»Ÿä¸€çš„æ–°é—»æ•°æ®æ¥å£ï¼Œä¾›å‰ç«¯è°ƒç”¨ã€‚

---

## ğŸ“‹ å¾…åˆ é™¤çš„æ–‡ä»¶

```bash
# ä¸ç¨³å®šçš„çˆ¬è™«ï¼ˆåˆ é™¤ï¼‰
backend/dataflows/news/china_market_crawler.py
backend/dataflows/news/social_media_crawler.py

# æµ‹è¯•å¤±è´¥çš„æ–‡ä»¶ï¼ˆåˆ é™¤ï¼‰
backend/dataflows/news/akshare_provider.py
test_akshare.py
test_akshare_simple.py
check_akshare_api.py
diagnose_api.py
simple_test.py
fix_crawlers.py
```

---

## ğŸ“‹ ä¿ç•™çš„æ–‡ä»¶

```bash
# å·²éªŒè¯å¯ç”¨ï¼ˆä¿ç•™ï¼‰
backend/dataflows/news/realtime_news.py
backend/dataflows/news/improved_sentiment_analysis.py

# æ–°åˆ›å»ºï¼ˆä¿ç•™ï¼‰
backend/dataflows/news/akshare_news_api.py
backend/dataflows/news/hot_search_api.py
backend/dataflows/news/weibo_hot_search.py  # ä½¿ç”¨ç¬¬ä¸‰æ–¹API
```

---

## ğŸ¯ æœ€ç»ˆç›®æ ‡

### æ•°æ®æºæ¶æ„
```
æ ¸å¿ƒæ•°æ®ï¼ˆAKShareï¼‰
â”œâ”€â”€ ä¸ªè‚¡æ–°é—»ï¼ˆstock_news_emï¼‰â­â­â­â­â­
â”œâ”€â”€ è´¢ç»æ—©é¤ï¼ˆstock_info_cjzc_emï¼‰
â”œâ”€â”€ å…¨çƒæ–°é—»ï¼ˆstock_info_global_em/sinaï¼‰
â”œâ”€â”€ è´¢è”ç¤¾å¿«è®¯ï¼ˆstock_info_global_clsï¼‰
â””â”€â”€ å¾®åšçƒ­è®®ï¼ˆstock_js_weibo_reportï¼‰

è¾…åŠ©æ•°æ®ï¼ˆç¬¬ä¸‰æ–¹APIï¼‰
â”œâ”€â”€ å¾®åšçƒ­æœï¼ˆapi.aa1.cnï¼‰
â”œâ”€â”€ ç™¾åº¦çƒ­æœï¼ˆapi.aa1.cnï¼‰
â””â”€â”€ çŸ¥ä¹çƒ­æœï¼ˆapi.aa1.cnï¼‰

æœªæ¥æ‰©å±•ï¼ˆæ ¸å¿ƒï¼‰
â”œâ”€â”€ ä¸­å›½è£åˆ¤æ–‡ä¹¦ç½‘ï¼ˆæ³•å¾‹é£é™©ï¼‰
â”œâ”€â”€ å·¨æ½®èµ„è®¯ç½‘ï¼ˆå…¬å¸å…¬å‘Šï¼‰
â””â”€â”€ è¯åˆ¸æ—¶æŠ¥ï¼ˆæƒå¨æ–°é—»ï¼‰
```

---

**ç°åœ¨å¼€å§‹å®æ–½ï¼šåˆ›å»ºæ–°çš„AKShareæ¥å£å°è£…ï¼** ğŸš€
