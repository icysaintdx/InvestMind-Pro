# 新闻数据源扩展方案评估报告

## 一、项目现状分析

### 1.1 当前新闻数据源

| 页面 | 数据源数量 | 数据源列表 |
|------|-----------|-----------|
| 智能分析页面 | 9个 | 实时新闻聚合器、AKShare个股新闻、财联社快讯、微博热议、财经早餐、全球财经新闻、新浪财经、富途牛牛、同花顺 |
| 新闻中心 | 7个 | 东方财富、富途、新浪财经、同花顺、财联社、微博热议、财经早餐 |

### 1.2 现有接口技术栈

- **AKShare**: 主要数据源，免费、稳定
- **问财(pywencai)**: 已集成但未在新闻中心使用
- **Tushare**: 已集成，有新闻接口但需要付费权限

---

## 二、新增数据源评估

### 2.1 问财新闻接口

#### 现状
项目已有 `WencaiNewsProvider` 实现（`backend/dataflows/unified_news/providers/wencai_provider.py`）

#### 优势
- ✅ 支持自然语言查询（如"今日涨停股新闻"）
- ✅ 智能关联股票代码
- ✅ 免费使用
- ✅ 支持个股新闻和公告查询

#### 劣势
- ⚠️ 有较严格的频率限制（20次/分钟）
- ⚠️ 依赖 pywencai 库
- ⚠️ 返回数据格式不稳定

#### 接入建议
**推荐接入**，可直接复用现有 `WencaiNewsProvider`

---

### 2.2 Tushare资讯接口

#### 现状
项目已有 `TushareProvider` 实现（`backend/dataflows/providers/china/tushare.py`），包含 `get_stock_news` 方法

#### 优势
- ✅ 多数据源聚合（新浪、东方财富、同花顺、财联社等9个源）
- ✅ 数据质量高、格式规范
- ✅ 支持时间范围查询
- ✅ 已有完整的情绪分析和分类逻辑

#### 劣势
- ❌ **需要付费权限**（新闻接口需要单独开通）
- ❌ 需要积分消耗
- ⚠️ API限流（每分钟有调用次数限制）

#### 接入建议
**条件性接入**：如果用户已配置Tushare Token且有新闻权限，则启用

---

### 2.3 金十数据接口

#### 现状
AKShare **不直接提供金十数据接口**。经查询，AKShare中没有 `jin10` 相关的API。

#### 替代方案
AKShare提供的相关接口：
- `news_cctv`: 新闻联播文字稿
- `news_economic_baidu`: 百度经济新闻
- `stock_notice_report`: 东方财富公告

#### 接入建议
**不推荐直接接入金十**，原因：
1. 金十数据无官方API，需要爬虫
2. 反爬机制较强
3. 可用AKShare的其他接口替代

---

### 2.4 巨潮资讯公告接口

#### 现状
AKShare提供 `stock_zh_a_disclosure_report_cninfo` 接口

#### 优势
- ✅ **官方权威数据源**（证监会指定信息披露平台）
- ✅ 支持按股票代码、类别、时间范围查询
- ✅ 公告类型丰富（年报、季报、业绩预告、权益变动等）
- ✅ 免费使用

#### 劣势
- ⚠️ 仅限公告类信息，不含新闻

#### 接入建议
**强烈推荐接入**，可显著提升公告数据的权威性和完整性

---

## 三、RSS方案评估

### 3.1 方案概述

用户提供的RSS方案包含：
1. 纯Python原生生成RSS XML
2. 本地爬虫采集（新浪、巨潮、同花顺）
3. 定时任务（30秒/60秒间隔）
4. SQLite本地存储

### 3.2 优势分析

| 优势 | 说明 |
|------|------|
| 完全本地独立 | 无Docker、无云服务依赖 |
| 无续费风险 | 不依赖付费API |
| 实时性高 | 支持30秒级更新 |
| 标准化输出 | 生成标准RSS 2.0格式 |

### 3.3 劣势分析

| 劣势 | 说明 |
|------|------|
| 维护成本高 | XPath需要随网站结构变化更新 |
| 反爬风险 | 高频爬取可能被封IP |
| 数据质量不稳定 | 爬虫解析可能出错 |
| 重复造轮子 | AKShare已封装大部分接口 |

### 3.4 评估结论

**不推荐采用纯爬虫RSS方案**，原因：
1. AKShare已提供稳定的封装接口，无需自行爬取
2. 爬虫维护成本高，网站结构变化需要频繁更新
3. 项目已有完善的新闻聚合架构，直接扩展更高效

---

## 四、推荐方案

### 4.1 数据源扩展优先级

| 优先级 | 数据源 | 接口 | 说明 |
|--------|--------|------|------|
| P0 | 巨潮资讯公告 | `stock_zh_a_disclosure_report_cninfo` | 权威公告源，必须接入 |
| P0 | 东方财富公告 | `stock_notice_report` | 补充公告源 |
| P1 | 问财新闻 | 现有 `WencaiNewsProvider` | 智能查询，已有实现 |
| P2 | Tushare新闻 | 现有 `TushareProvider.get_stock_news` | 条件性启用 |
| P3 | 新闻联播 | `news_cctv` | 政策面参考 |

### 4.2 架构设计

```
新闻中心数据源（扩展后）
├── 实时新闻类（7个）
│   ├── 东方财富全球资讯
│   ├── 富途全球资讯
│   ├── 新浪财经快讯
│   ├── 同花顺全球资讯
│   ├── 财联社快讯
│   ├── 微博热议
│   └── 财经早餐
├── 公告类（2个）【新增】
│   ├── 巨潮资讯公告（权威）
│   └── 东方财富公告
├── 智能查询类（1个）【新增】
│   └── 问财新闻
└── 可选付费类（1个）【条件启用】
    └── Tushare新闻（需权限）
```

### 4.3 实现步骤

#### 步骤1：新增巨潮资讯公告接口
```python
def _fetch_cninfo_announcement() -> List[Dict[str, Any]]:
    """获取巨潮资讯公告"""
    import akshare as ak
    from datetime import datetime, timedelta

    news_list = []
    end_date = datetime.now().strftime("%Y%m%d")
    start_date = (datetime.now() - timedelta(days=7)).strftime("%Y%m%d")

    # 获取重大事项公告
    df = ak.stock_notice_report(symbol="重大事项", date=end_date)
    # 处理数据...
    return news_list
```

#### 步骤2：新增问财新闻接口
```python
def _fetch_wencai_news() -> List[Dict[str, Any]]:
    """获取问财热点新闻"""
    import pywencai

    queries = ["今日重大新闻", "今日涨停股新闻"]
    # 处理数据...
    return news_list
```

#### 步骤3：条件启用Tushare新闻
```python
def _fetch_tushare_news() -> List[Dict[str, Any]]:
    """获取Tushare新闻（需要权限）"""
    from backend.dataflows.providers.china.tushare import get_tushare_provider

    provider = get_tushare_provider()
    if not provider.is_available():
        return []

    # 尝试获取新闻，捕获权限错误
    try:
        news = await provider.get_stock_news(limit=20)
        return news or []
    except Exception as e:
        if "权限" in str(e) or "积分" in str(e):
            return []  # 无权限，静默失败
        raise
```

---

## 五、时效性与权威性保障

### 5.1 时效性保障

| 措施 | 说明 |
|------|------|
| 多源并行获取 | 使用 `ThreadPoolExecutor` 并行请求 |
| 缓存策略 | 5分钟缓存，支持强制刷新 |
| 增量更新 | 基于时间戳去重，只保留最新 |

### 5.2 权威性保障

| 措施 | 说明 |
|------|------|
| 官方源优先 | 巨潮资讯（证监会指定）优先级最高 |
| 多源交叉验证 | 同一新闻多源出现则提升权重 |
| 来源标注 | 每条新闻标注数据来源 |

### 5.3 完整性保障

| 措施 | 说明 |
|------|------|
| 多源聚合 | 11个数据源覆盖新闻+公告 |
| 故障降级 | 单源失败不影响整体 |
| 去重机制 | 基于标题+时间去重 |

---

## 六、实施计划

### 阶段1：核心扩展（立即实施）
- [ ] 新增巨潮资讯公告接口
- [ ] 新增东方财富公告接口
- [ ] 更新数据源状态接口

### 阶段2：智能增强（短期）
- [ ] 集成问财新闻到新闻中心
- [ ] 添加新闻分类标签

### 阶段3：可选扩展（中期）
- [ ] 条件启用Tushare新闻
- [ ] 添加新闻联播接口

---

## 七、总结

### 推荐方案
1. **不采用纯爬虫RSS方案**，利用现有AKShare封装
2. **优先接入巨潮资讯公告**，提升权威性
3. **复用现有问财实现**，增加智能查询能力
4. **条件启用Tushare**，为付费用户提供更多数据源

### 预期效果
- 数据源从7个扩展到11个
- 新增官方权威公告源
- 保持系统稳定性和可维护性
- 无额外付费成本（Tushare为可选）
