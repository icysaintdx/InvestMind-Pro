# è´¢åŠ¡æ•°æ®ä¿®å¤æŠ¥å‘Š

**ä¿®å¤æ—¶é—´**: 2025-12-05 06:35  
**çŠ¶æ€**: âœ… å·²ä¿®å¤

---

## ğŸ› é—®é¢˜æè¿°

### é”™è¯¯ä¿¡æ¯
```
âŒ stock_balance_sheet_by_report_em è°ƒç”¨å¤±è´¥: 'NoneType' object is not subscriptable
âŒ stock_profit_sheet_by_report_em è°ƒç”¨å¤±è´¥: 'NoneType' object is not subscriptable
âŒ stock_cash_flow_sheet_by_report_em è°ƒç”¨å¤±è´¥: 'NoneType' object is not subscriptable
```

### APIè¿”å›
```json
{"success":true,"data":{}}  // ç©ºæ•°æ®
```

### æ ¹æœ¬åŸå› 
AKShareè´¢åŠ¡æ¥å£éœ€è¦**å¸¦å¸‚åœºå‰ç¼€çš„è‚¡ç¥¨ä»£ç **ï¼š
- âœ… æ­£ç¡®: `SH600519` (ä¸Šäº¤æ‰€)
- âœ… æ­£ç¡®: `SZ000001` (æ·±äº¤æ‰€)
- âŒ é”™è¯¯: `600519` (æ— å‰ç¼€)

---

## âœ… ä¿®å¤æ–¹æ¡ˆ

### è‚¡ç¥¨ä»£ç è½¬æ¢è§„åˆ™

```python
# ä¿®å¤å‰ï¼ˆé”™è¯¯ï¼‰
clean_symbol = symbol.replace('.SH', '').replace('.SZ', '')
df = self.safe_call(ak.stock_balance_sheet_by_report_em, symbol=clean_symbol)
# ä¼ å…¥: 600519 âŒ

# ä¿®å¤åï¼ˆæ­£ç¡®ï¼‰
clean_symbol = symbol.replace('.SH', '').replace('.SZ', '')
if clean_symbol.startswith('6'):
    akshare_symbol = f"SH{clean_symbol}"  # ä¸Šäº¤æ‰€
elif clean_symbol.startswith(('0', '3')):
    akshare_symbol = f"SZ{clean_symbol}"  # æ·±äº¤æ‰€
else:
    akshare_symbol = f"SH{clean_symbol}"  # é»˜è®¤ä¸Šäº¤æ‰€

df = self.safe_call(ak.stock_balance_sheet_by_report_em, symbol=akshare_symbol)
# ä¼ å…¥: SH600519 âœ…
```

### ä»£ç è¯†åˆ«è§„åˆ™

| é¦–ä½æ•°å­— | å¸‚åœº | å‰ç¼€ | ç¤ºä¾‹ |
|---------|------|------|------|
| 6 | ä¸Šæµ·è¯åˆ¸äº¤æ˜“æ‰€ | SH | SH600519 (è´µå·èŒ…å°) |
| 0 | æ·±åœ³è¯åˆ¸äº¤æ˜“æ‰€ | SZ | SZ000001 (å¹³å®‰é“¶è¡Œ) |
| 3 | æ·±åœ³è¯åˆ¸äº¤æ˜“æ‰€ï¼ˆåˆ›ä¸šæ¿ï¼‰ | SZ | SZ300750 (å®å¾·æ—¶ä»£) |
| å…¶ä»– | é»˜è®¤ä¸Šäº¤æ‰€ | SH | - |

---

## ğŸ“ ä¿®æ”¹çš„å‡½æ•°

### æ–‡ä»¶: `backend/dataflows/akshare/financial_data.py`

ä¿®æ”¹äº†æ‰€æœ‰è´¢åŠ¡æ•°æ®è·å–å‡½æ•°ï¼ˆå…±8ä¸ªï¼‰ï¼š

1. âœ… `get_balance_sheet_by_report()` - èµ„äº§è´Ÿå€ºè¡¨ï¼ˆæŒ‰æŠ¥å‘ŠæœŸï¼‰
2. âœ… `get_balance_sheet_by_yearly()` - èµ„äº§è´Ÿå€ºè¡¨ï¼ˆæŒ‰å¹´åº¦ï¼‰
3. âœ… `get_profit_sheet_by_report()` - åˆ©æ¶¦è¡¨ï¼ˆæŒ‰æŠ¥å‘ŠæœŸï¼‰
4. âœ… `get_profit_sheet_by_yearly()` - åˆ©æ¶¦è¡¨ï¼ˆæŒ‰å¹´åº¦ï¼‰
5. âœ… `get_profit_sheet_by_quarterly()` - åˆ©æ¶¦è¡¨ï¼ˆæŒ‰å•å­£åº¦ï¼‰
6. âœ… `get_cash_flow_sheet_by_report()` - ç°é‡‘æµé‡è¡¨ï¼ˆæŒ‰æŠ¥å‘ŠæœŸï¼‰
7. âœ… `get_cash_flow_sheet_by_yearly()` - ç°é‡‘æµé‡è¡¨ï¼ˆæŒ‰å¹´åº¦ï¼‰
8. âœ… `get_cash_flow_sheet_by_quarterly()` - ç°é‡‘æµé‡è¡¨ï¼ˆæŒ‰å•å­£åº¦ï¼‰

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### æµ‹è¯•è„šæœ¬

**æ–‡ä»¶**: `TEST_FINANCIAL_FIX.bat`

```bash
# æµ‹è¯•æ•°æ®æ¨¡å—
python -c "from backend.dataflows.akshare.financial_data import get_financial_data; ..."

# æµ‹è¯•APIç«¯ç‚¹
curl http://localhost:8000/api/akshare/financial/600519/summary
```

### é¢„æœŸç»“æœ

```json
{
  "success": true,
  "data": {
    "æŠ¥å‘ŠæœŸ": "2024-09-30",
    "æ€»èµ„äº§": 1234567890,
    "æ€»è´Ÿå€º": 234567890,
    "å‡€èµ„äº§": 1000000000,
    "èµ„äº§è´Ÿå€ºç‡": 0.19,
    "è¥ä¸šæ”¶å…¥": 123456789,
    "å‡€åˆ©æ¶¦": 56789012,
    "æ¯›åˆ©ç‡": 0.91,
    "å‡€åˆ©ç‡": 0.46,
    "ç»è¥æ´»åŠ¨ç°é‡‘æµ": 78901234,
    "æŠ•èµ„æ´»åŠ¨ç°é‡‘æµ": -12345678,
    "ç­¹èµ„æ´»åŠ¨ç°é‡‘æµ": -23456789
  }
}
```

---

## ğŸ“Š æ”¯æŒçš„è‚¡ç¥¨

### ä¸Šæµ·è¯åˆ¸äº¤æ˜“æ‰€ï¼ˆSHï¼‰
- 600000-603999: ä¸»æ¿
- ç¤ºä¾‹: 600519 (è´µå·èŒ…å°), 600036 (æ‹›å•†é“¶è¡Œ)

### æ·±åœ³è¯åˆ¸äº¤æ˜“æ‰€ï¼ˆSZï¼‰
- 000001-002999: ä¸»æ¿
- 300001-301999: åˆ›ä¸šæ¿
- ç¤ºä¾‹: 000001 (å¹³å®‰é“¶è¡Œ), 300750 (å®å¾·æ—¶ä»£)

---

## ğŸ” AKShareæ¥å£è¯´æ˜

### èµ„äº§è´Ÿå€ºè¡¨

```python
import akshare as ak

# æŒ‰æŠ¥å‘ŠæœŸ
df = ak.stock_balance_sheet_by_report_em(symbol="SH600519")
# è¿”å›: 92è¡Œ x 319åˆ—

# æŒ‰å¹´åº¦
df = ak.stock_balance_sheet_by_yearly_em(symbol="SH600519")
# è¿”å›: 25è¡Œ x 319åˆ—
```

### åˆ©æ¶¦è¡¨

```python
# æŒ‰æŠ¥å‘ŠæœŸ
df = ak.stock_profit_sheet_by_report_em(symbol="SH600519")
# è¿”å›: 92è¡Œ x 203åˆ—

# æŒ‰å¹´åº¦
df = ak.stock_profit_sheet_by_yearly_em(symbol="SH600519")
# è¿”å›: 25è¡Œ x 203åˆ—

# æŒ‰å•å­£åº¦
df = ak.stock_profit_sheet_by_quarterly_em(symbol="SH600519")
# è¿”å›: 87è¡Œ x 204åˆ—
```

### ç°é‡‘æµé‡è¡¨

```python
# æŒ‰æŠ¥å‘ŠæœŸ
df = ak.stock_cash_flow_sheet_by_report_em(symbol="SH600519")
# è¿”å›: 88è¡Œ x 252åˆ—

# æŒ‰å¹´åº¦
df = ak.stock_cash_flow_sheet_by_yearly_em(symbol="SH600519")
# è¿”å›: 20è¡Œ x 314åˆ—

# æŒ‰å•å­£åº¦
df = ak.stock_cash_flow_sheet_by_quarterly_em(symbol="SH600519")
# è¿”å›: 83è¡Œ x 252åˆ—
```

---

## ğŸ’¡ ç»éªŒæ€»ç»“

### 1. å…ˆæŸ¥çœ‹å®˜æ–¹æ–‡æ¡£
AKShareæ–‡æ¡£æ˜ç¡®è¯´æ˜éœ€è¦ `SH600519` æ ¼å¼ï¼š
```python
stock_balance_sheet_by_report_em_df = ak.stock_balance_sheet_by_report_em(symbol="SH600519")
```

### 2. æµ‹è¯•æ—¶ä½¿ç”¨æ­£ç¡®æ ¼å¼
```python
# é”™è¯¯
df = ak.stock_balance_sheet_by_report_em(symbol="600519")  # âŒ

# æ­£ç¡®
df = ak.stock_balance_sheet_by_report_em(symbol="SH600519")  # âœ…
```

### 3. ç»Ÿä¸€çš„ä»£ç è½¬æ¢å‡½æ•°
å¯ä»¥åˆ›å»ºä¸€ä¸ªè¾…åŠ©å‡½æ•°ï¼š
```python
def convert_to_akshare_symbol(symbol: str) -> str:
    """è½¬æ¢ä¸ºAKShareè´¢åŠ¡æ¥å£éœ€è¦çš„æ ¼å¼"""
    clean = symbol.replace('.SH', '').replace('.SZ', '')
    if clean.startswith('6'):
        return f"SH{clean}"
    elif clean.startswith(('0', '3')):
        return f"SZ{clean}"
    else:
        return f"SH{clean}"
```

---

## ğŸš€ ä¸‹ä¸€æ­¥

### ç«‹å³æµ‹è¯•
```bash
# 1. é‡å¯æœåŠ¡å™¨ï¼ˆå¦‚æœæ­£åœ¨è¿è¡Œï¼‰
KILL_PORT_8000.bat
python backend/server.py

# 2. æµ‹è¯•ä¿®å¤
TEST_FINANCIAL_FIX.bat

# 3. æˆ–ç›´æ¥æµ‹è¯•API
curl http://localhost:8000/api/akshare/financial/600519/summary
```

### éªŒè¯ç»“æœ
- âœ… APIè¿”å›å®Œæ•´æ•°æ®ï¼ˆéç©ºï¼‰
- âœ… åŒ…å«æŠ¥å‘ŠæœŸã€æ€»èµ„äº§ã€å‡€åˆ©æ¶¦ç­‰å­—æ®µ
- âœ… æ— é”™è¯¯æ—¥å¿—

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `docs/AKshareæ–‡æ¡£.md` - AKShareå®˜æ–¹æ–‡æ¡£
- `docs/æ•°æ®é›†æˆä½¿ç”¨æŒ‡å—.md` - æ•°æ®ä½¿ç”¨æŒ‡å—
- `docs/AKShareæ•°æ®é›†æˆæ€»ç»“æŠ¥å‘Š.md` - æ•°æ®æ¨¡å—æ€»ç»“

---

**ä¿®å¤å®Œæˆæ—¶é—´**: 2025-12-05 06:40  
**çŠ¶æ€**: âœ… æ‰€æœ‰è´¢åŠ¡æ¥å£å·²ä¿®å¤ï¼Œç­‰å¾…æµ‹è¯•éªŒè¯
