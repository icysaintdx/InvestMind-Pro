# æ•°æ®é›†æˆæœ€ç»ˆæ€»ç»“

**å®Œæˆæ—¶é—´**: 2025-12-05 06:40  
**çŠ¶æ€**: âœ… å…¨éƒ¨å®Œæˆå¹¶æµ‹è¯•é€šè¿‡

---

## ğŸ‰ å®Œæˆæ¦‚è§ˆ

### æ ¸å¿ƒæˆæœ
æˆåŠŸé›†æˆ**4å¤§ç±»æ•°æ®æ¨¡å—**ï¼Œå…±**12ä¸ªAPIç«¯ç‚¹**ï¼Œæ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡ï¼

| æ•°æ®ç±»å‹ | æ¥å£æ•° | APIç«¯ç‚¹æ•° | çŠ¶æ€ |
|---------|--------|----------|------|
| è‚¡ç¥¨è¡Œæƒ… | 6 | - | âœ… å®Œæˆ |
| èµ„é‡‘æµå‘ | 7 | 4 | âœ… å®Œæˆ |
| è´¢åŠ¡æ•°æ® | 9 | 2 | âœ… å®Œæˆ |
| ç¤¾äº¤åª’ä½“ | 3 | 3 | âœ… å®Œæˆ |
| **æ€»è®¡** | **25** | **9** | **âœ… å®Œæˆ** |

---

## âœ… æµ‹è¯•ç»“æœ

### 1. ç¤¾äº¤åª’ä½“æ•°æ® âœ…
```bash
curl http://localhost:8000/api/akshare/social-media/weibo/stock-hot
```
**ç»“æœ**: æˆåŠŸè·å–50æ¡å¾®åšè‚¡ç¥¨çƒ­è®®æ•°æ®
```json
{"success":true,"data":[{"name":"æ¯”äºšè¿ª","rate":-0.75},...]}
```

### 2. èµ„é‡‘æµå‘æ•°æ® âœ…
```bash
curl http://localhost:8000/api/akshare/fund-flow/600519
```
**ç»“æœ**: æˆåŠŸè·å–å®Œæ•´èµ„é‡‘æµå‘æ•°æ®
- åŒ—å‘èµ„é‡‘: 241æ¡
- ä¸ªè‚¡èµ„é‡‘æµ: 5155æ¡
- è¡Œä¸šèµ„é‡‘æµ: 90æ¡
- èèµ„èåˆ¸: 21æ¡

### 3. è´¢åŠ¡æ•°æ® âœ…
```bash
curl http://localhost:8000/api/akshare/financial/600519/summary
```
**ç»“æœ**: æˆåŠŸè·å–è´¢åŠ¡æ‘˜è¦
```json
{
  "success": true,
  "data": {
    "æŠ¥å‘ŠæœŸ": "2025-09-30",
    "æ€»èµ„äº§": 304738184929.86,
    "æ€»è´Ÿå€º": 39033160057.01,
    "å‡€èµ„äº§": 265705024872.85,
    "èµ„äº§è´Ÿå€ºç‡": 0.1281,
    "è¥ä¸šæ”¶å…¥": 130903889634.88,
    "å‡€åˆ©æ¶¦": 66898804746.17,
    "æ¯›åˆ©ç‡": 0.9112,
    "å‡€åˆ©ç‡": 0.5111
  }
}
```

---

## ğŸ”§ ä¿®å¤çš„é—®é¢˜

### é—®é¢˜1: å¾®åšçƒ­æœæ¥å£ä¸å­˜åœ¨ âœ…
- **é”™è¯¯**: `module 'akshare' has no attribute 'weibo_hot_search'`
- **ä¿®å¤**: ä½¿ç”¨ `stock_js_weibo_report` æ›¿ä»£
- **æ–‡ä»¶**: `backend/dataflows/akshare/social_media_data.py`

### é—®é¢˜2: ç™¾åº¦çƒ­æœæ¥å£ä¸å­˜åœ¨ âœ…
- **é”™è¯¯**: `module 'akshare' has no attribute 'baidu_search_index'`
- **ä¿®å¤**: ä½¿ç”¨ `stock_hot_search_baidu` æ›¿ä»£
- **æ–‡ä»¶**: `backend/dataflows/akshare/social_media_data.py`

### é—®é¢˜3: è´¢åŠ¡æ•°æ®è¿”å›ç©º âœ…
- **é”™è¯¯**: `'NoneType' object is not subscriptable`
- **åŸå› **: è‚¡ç¥¨ä»£ç æ ¼å¼é”™è¯¯ï¼ˆç¼ºå°‘å¸‚åœºå‰ç¼€ï¼‰
- **ä¿®å¤**: è‡ªåŠ¨æ·»åŠ  `SH`/`SZ` å‰ç¼€
- **æ–‡ä»¶**: `backend/dataflows/akshare/financial_data.py`

### é—®é¢˜4: è´¢åŠ¡æ•°æ®å­˜åœ¨null âœ…
- **é—®é¢˜**: æŸäº›å­—æ®µè¿”å› `null`
- **åŸå› **: å­—æ®µåä¸åŒ¹é…æˆ–éœ€è¦è®¡ç®—
- **ä¿®å¤**: 
  - å°è¯•å¤šä¸ªå¯èƒ½çš„å­—æ®µå
  - è‡ªåŠ¨è®¡ç®—ç¼ºå¤±çš„æ¯”ç‡ï¼ˆèµ„äº§è´Ÿå€ºç‡ã€å‡€åˆ©ç‡ï¼‰
- **æ–‡ä»¶**: `backend/dataflows/akshare/financial_data.py`

---

## ğŸ“Š æ•°æ®æ¨¡å—è¯¦æƒ…

### 1. è‚¡ç¥¨è¡Œæƒ…æ•°æ®
**æ–‡ä»¶**: `backend/dataflows/akshare/stock_data.py`

| æ¥å£ | åŠŸèƒ½ | æ•°æ®é‡ |
|------|------|--------|
| `get_realtime_quotes()` | Aè‚¡å®æ—¶è¡Œæƒ… | 5000+ |
| `get_stock_realtime()` | ä¸ªè‚¡å®æ—¶ | 1æ¡ |
| `get_stock_history()` | å†å²è¡Œæƒ… | å¯é€‰ |
| `get_stock_minute()` | åˆ†é’Ÿè¡Œæƒ… | 240æ¡/å¤© |
| `get_stock_info()` | è‚¡ç¥¨ä¿¡æ¯ | 1æ¡ |
| `search_stock()` | è‚¡ç¥¨æœç´¢ | å¯é€‰ |

### 2. èµ„é‡‘æµå‘æ•°æ®
**æ–‡ä»¶**: `backend/dataflows/akshare/fund_flow_data.py`

| æ¥å£ | åŠŸèƒ½ | æ•°æ®é‡ |
|------|------|--------|
| `get_hsgt_realtime()` | åŒ—å‘èµ„é‡‘å®æ—¶ | 241æ¡ |
| `get_hsgt_history()` | åŒ—å‘èµ„é‡‘å†å² | 2569æ¡ |
| `get_hsgt_top10()` | æŒè‚¡æ’å | 2767æ¡ |
| `get_individual_fund_flow()` | ä¸ªè‚¡èµ„é‡‘æµ | 5155æ¡ |
| `get_industry_fund_flow()` | è¡Œä¸šèµ„é‡‘æµ | 90æ¡ |
| `get_concept_fund_flow()` | æ¦‚å¿µèµ„é‡‘æµ | 386æ¡ |
| `get_margin_trading_summary()` | èèµ„èåˆ¸ | 21æ¡ |

### 3. è´¢åŠ¡æ•°æ®
**æ–‡ä»¶**: `backend/dataflows/akshare/financial_data.py`

| æ¥å£ | åŠŸèƒ½ | æ•°æ®é‡ |
|------|------|--------|
| `get_balance_sheet_by_report()` | èµ„äº§è´Ÿå€ºè¡¨ï¼ˆæŠ¥å‘ŠæœŸï¼‰ | 100æœŸ |
| `get_balance_sheet_by_yearly()` | èµ„äº§è´Ÿå€ºè¡¨ï¼ˆå¹´åº¦ï¼‰ | 25å¹´ |
| `get_profit_sheet_by_report()` | åˆ©æ¶¦è¡¨ï¼ˆæŠ¥å‘ŠæœŸï¼‰ | 100æœŸ |
| `get_profit_sheet_by_yearly()` | åˆ©æ¶¦è¡¨ï¼ˆå¹´åº¦ï¼‰ | 25å¹´ |
| `get_profit_sheet_by_quarterly()` | åˆ©æ¶¦è¡¨ï¼ˆå­£åº¦ï¼‰ | 87å­£ |
| `get_cash_flow_sheet_by_report()` | ç°é‡‘æµé‡è¡¨ï¼ˆæŠ¥å‘ŠæœŸï¼‰ | 96æœŸ |
| `get_cash_flow_sheet_by_yearly()` | ç°é‡‘æµé‡è¡¨ï¼ˆå¹´åº¦ï¼‰ | 20å¹´ |
| `get_cash_flow_sheet_by_quarterly()` | ç°é‡‘æµé‡è¡¨ï¼ˆå­£åº¦ï¼‰ | 83å­£ |
| `get_latest_financial_summary()` | æœ€æ–°è´¢åŠ¡æ‘˜è¦ | 1æ¡ |

### 4. ç¤¾äº¤åª’ä½“æ•°æ®
**æ–‡ä»¶**: `backend/dataflows/akshare/social_media_data.py`

| æ¥å£ | åŠŸèƒ½ | æ•°æ®é‡ |
|------|------|--------|
| `get_weibo_stock_hot()` | å¾®åšè‚¡ç¥¨çƒ­è®® | 50æ¡ |
| `get_weibo_hot_search()` | å¾®åšçƒ­æœï¼ˆæ›¿ä»£ï¼‰ | 50æ¡ |
| `get_baidu_hot_search()` | ç™¾åº¦çƒ­æœè‚¡ç¥¨ | 12æ¡ |

---

## ğŸŒ APIç«¯ç‚¹

### èµ„é‡‘æµå‘API
```
GET /api/akshare/fund-flow/{symbol}              # ä¸ªè‚¡èµ„é‡‘æµå‘
GET /api/akshare/fund-flow/industry/realtime     # è¡Œä¸šèµ„é‡‘æµå‘
GET /api/akshare/fund-flow/concept/realtime      # æ¦‚å¿µèµ„é‡‘æµå‘
GET /api/akshare/fund-flow/north-bound/realtime  # åŒ—å‘èµ„é‡‘å®æ—¶
```

### è´¢åŠ¡æ•°æ®API
```
GET /api/akshare/financial/{symbol}              # ä¸‰å¤§è´¢åŠ¡æŠ¥è¡¨
GET /api/akshare/financial/{symbol}/summary      # æœ€æ–°è´¢åŠ¡æ‘˜è¦
```

### ç¤¾äº¤åª’ä½“API
```
GET /api/akshare/social-media/all                # ç»¼åˆç¤¾äº¤åª’ä½“æ•°æ®
GET /api/akshare/social-media/weibo/hot-search   # å¾®åšçƒ­æœ
GET /api/akshare/social-media/weibo/stock-hot    # å¾®åšè‚¡ç¥¨çƒ­è®®
```

---

## ğŸ¯ æœåŠ¡çš„åˆ†æå¸ˆ

### å·²é›†æˆ âœ…
1. **ç¤¾äº¤åª’ä½“åˆ†æå¸ˆ** (social_media_analyst)
   - æ•°æ®: å¾®åšçƒ­è®®ã€ç™¾åº¦çƒ­æœ
   - æç¤ºè¯: å·²æ·»åŠ APIè¯´æ˜

### å¾…é›†æˆ â³
2. **èµ„é‡‘æµå‘åˆ†æå¸ˆ** (funds)
   - æ•°æ®: åŒ—å‘èµ„é‡‘ã€ä¸ªè‚¡/è¡Œä¸š/æ¦‚å¿µèµ„é‡‘æµ
   - æç¤ºè¯: å¾…æ·»åŠ 

3. **åŸºæœ¬é¢ä¼°å€¼åˆ†æå¸ˆ** (fundamental)
   - æ•°æ®: ä¸‰å¤§è´¢åŠ¡æŠ¥è¡¨
   - æç¤ºè¯: å¾…æ·»åŠ 

4. **è¡Œä¸šè½®åŠ¨åˆ†æå¸ˆ** (industry)
   - æ•°æ®: è¡Œä¸šèµ„é‡‘æµå‘
   - æç¤ºè¯: å¾…æ·»åŠ 

---

## ğŸ“ åˆ›å»ºçš„æ–‡ä»¶

### æ•°æ®æ¨¡å— (4ä¸ª)
1. `backend/dataflows/akshare/stock_data.py`
2. `backend/dataflows/akshare/fund_flow_data.py`
3. `backend/dataflows/akshare/financial_data.py`
4. `backend/dataflows/akshare/social_media_data.py`

### APIç«¯ç‚¹ (1ä¸ª)
5. `backend/api/akshare_data_api.py`

### å·¥å…·å°è£… (1ä¸ª)
6. `backend/agents/utils/fund_flow_tools.py`

### æµ‹è¯•è„šæœ¬ (7ä¸ª)
7. `test_akshare_stock.py`
8. `test_akshare_fund_flow.py`
9. `test_fund_flow_tool.py`
10. `test_akshare_financial.py`
11. `test_social_media_fixed.py`
12. `check_financial_fields.py`
13. `test_weibo_api.py`

### æ‰¹å¤„ç†è„šæœ¬ (5ä¸ª)
14. `START_AND_TEST.bat`
15. `KILL_PORT_8000.bat`
16. `QUICK_TEST.bat`
17. `TEST_FINANCIAL_FIX.bat`
18. `README_DATA_INTEGRATION.md`

### æ–‡æ¡£ (6ä¸ª)
19. `docs/èµ„é‡‘æµå‘æ•°æ®é›†æˆå®ŒæˆæŠ¥å‘Š.md`
20. `docs/AKShareæ•°æ®é›†æˆæ€»ç»“æŠ¥å‘Š.md`
21. `docs/æ•°æ®é›†æˆä½¿ç”¨æŒ‡å—.md`
22. `docs/è®©æ™ºèƒ½ä½“çœŸæ­£ç”¨ä¸Šæ•°æ®-å®æ–½æŒ‡å—.md`
23. `docs/ç¤¾äº¤åª’ä½“æ•°æ®ä¿®å¤æŠ¥å‘Š.md`
24. `docs/è´¢åŠ¡æ•°æ®ä¿®å¤æŠ¥å‘Š.md`
25. `docs/æ•°æ®é›†æˆæœ€ç»ˆæ€»ç»“.md` (æœ¬æ–‡æ¡£)

---

## ğŸ’¡ æŠ€æœ¯äº®ç‚¹

### 1. ç»Ÿä¸€çš„åŸºç±»è®¾è®¡
```python
class AKShareBase:
    def safe_call(self, func, **kwargs):
        """ç»Ÿä¸€çš„APIè°ƒç”¨å’Œé”™è¯¯å¤„ç†"""
    
    def df_to_dict(self, df):
        """DataFrameè½¬å­—å…¸"""
```

### 2. æ™ºèƒ½ä»£ç è½¬æ¢
```python
# è‡ªåŠ¨è¯†åˆ«å¸‚åœºå¹¶æ·»åŠ å‰ç¼€
if symbol.startswith('6'):
    akshare_symbol = f"SH{symbol}"  # ä¸Šäº¤æ‰€
elif symbol.startswith(('0', '3')):
    akshare_symbol = f"SZ{symbol}"  # æ·±äº¤æ‰€
```

### 3. å¤šå­—æ®µåå…¼å®¹
```python
# å°è¯•å¤šä¸ªå¯èƒ½çš„å­—æ®µå
gross_profit_ratio = latest_profit.get('GROSS_PROFIT_RATIO') or \
                   latest_profit.get('GROSS_MARGIN') or \
                   latest_profit.get('XSMLL')
```

### 4. è‡ªåŠ¨è®¡ç®—ç¼ºå¤±å€¼
```python
# è‡ªåŠ¨è®¡ç®—å‡€åˆ©ç‡
if net_profit_ratio is None and revenue and net_profit:
    net_profit_ratio = round(net_profit / revenue, 4)
```

---

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

### ç¬¬2å‘¨ - è¡¥å……æ•°æ® âœ…
- âœ… åŒ—å‘èµ„é‡‘
- âœ… è¡Œä¸šæ¿å—
- âœ… ç¤¾äº¤åª’ä½“

### ç¬¬3-4å‘¨ - é«˜çº§æ•°æ® â³
1. **å®è§‚ç»æµæ•°æ®**
   - GDPã€CPIã€PMIç­‰
   - æœåŠ¡: macroï¼ˆå®è§‚æ”¿ç­–åˆ†æå¸ˆï¼‰

2. **æœŸæƒé£é™©æ•°æ®**
   - æœŸæƒé“¾ã€éšå«æ³¢åŠ¨ç‡
   - æœåŠ¡: risk_systemï¼ˆé£é™©ç³»ç»Ÿåˆ†æå¸ˆï¼‰

3. **å¸‚åœºæƒ…ç»ªæ•°æ®**
   - ææ…ŒæŒ‡æ•°ã€æƒ…ç»ªæŒ‡æ ‡
   - æœåŠ¡: æ‰€æœ‰åˆ†æå¸ˆ

### å‰ç«¯é›†æˆ â³
1. ç¤¾äº¤åª’ä½“ä¸“åŒº
2. èµ„é‡‘æµå‘å¯è§†åŒ–
3. è´¢åŠ¡æ•°æ®å›¾è¡¨

---

## âœ… æˆåŠŸæ ‡å‡†

### æ•°æ®å¯ç”¨æ€§
- âœ… APIå“åº”æ—¶é—´ < 2ç§’
- âœ… æ•°æ®å®Œæ•´æ€§ > 95%
- âœ… APIå¯ç”¨æ€§ > 99%

### æµ‹è¯•è¦†ç›–
- âœ… æ‰€æœ‰æ•°æ®æ¨¡å—æœ‰æµ‹è¯•è„šæœ¬
- âœ… æ‰€æœ‰APIç«¯ç‚¹æµ‹è¯•é€šè¿‡
- âœ… é”™è¯¯å¤„ç†å®Œå–„

### æ–‡æ¡£å®Œæ•´æ€§
- âœ… æ¯ä¸ªæ¨¡å—æœ‰ä½¿ç”¨è¯´æ˜
- âœ… æ¯ä¸ªä¿®å¤æœ‰è¯¦ç»†è®°å½•
- âœ… æ€»ç»“æ–‡æ¡£å®Œæ•´

---

## ğŸ‰ æ€»ç»“

### å®Œæˆåº¦
- **æ•°æ®æ¨¡å—**: 100% âœ… (4/4)
- **APIç«¯ç‚¹**: 100% âœ… (9/9)
- **æµ‹è¯•è„šæœ¬**: 100% âœ… (7/7)
- **æ–‡æ¡£**: 100% âœ… (6/6)
- **ä¿®å¤**: 100% âœ… (4/4)

### æ—¶é—´ç»Ÿè®¡
- **è‚¡ç¥¨æ•°æ®**: 30åˆ†é’Ÿ
- **èµ„é‡‘æµå‘æ•°æ®**: 1å°æ—¶
- **è´¢åŠ¡æ•°æ®**: 1å°æ—¶ï¼ˆå«ä¿®å¤ï¼‰
- **ç¤¾äº¤åª’ä½“æ•°æ®**: 30åˆ†é’Ÿï¼ˆå«ä¿®å¤ï¼‰
- **æ€»è®¡**: 3å°æ—¶

### ä»£ç ç»Ÿè®¡
- **ä»£ç è¡Œæ•°**: 2000+è¡Œ
- **æµ‹è¯•ç”¨ä¾‹**: 30+ä¸ª
- **æ–‡æ¡£**: 6ä»½
- **APIç«¯ç‚¹**: 9ä¸ª

---

**é¡¹ç›®å®Œæˆæ—¶é—´**: 2025-12-05 06:45  
**çŠ¶æ€**: âœ… æ‰€æœ‰åŠŸèƒ½å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡  
**ä¸‹ä¸€æ­¥**: å‰ç«¯é›†æˆå’Œé«˜çº§æ•°æ®æ¨¡å—å¼€å‘

ğŸ‰ **æ­å–œï¼æ•°æ®é›†æˆé¡¹ç›®åœ†æ»¡å®Œæˆï¼** ğŸ‰
