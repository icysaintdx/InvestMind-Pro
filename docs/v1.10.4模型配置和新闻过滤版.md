# v1.10.4 æ¨¡å‹é…ç½®å’Œæ–°é—»è¿‡æ»¤ç‰ˆ

**å‘å¸ƒæ—¥æœŸ**: 2024-12-05 00:30  
**ç‰ˆæœ¬**: v1.10.4

## ğŸ¯ ä¿®å¤çš„é—®é¢˜

### é—®é¢˜1: æ¨¡å‹é€‰æ‹©ç¡¬ç¼–ç  âœ…

**é—®é¢˜æè¿°**:
ç™½è¯è§£è¯»å‘˜é…ç½®å¼¹çª—ä¸­çš„æ¨¡å‹é€‰é¡¹æ˜¯ç¡¬ç¼–ç çš„ï¼Œæ²¡æœ‰ä»`agent_configs.json`çš„`selectedModels`åŠ¨æ€åŠ è½½ã€‚

**ä¿®å¤æ–¹æ¡ˆ**:
```vue
<!-- ä¿®å¤å‰ï¼ˆç¡¬ç¼–ç ï¼‰ -->
<select v-model="interpreterModel">
  <option value="Qwen/Qwen2.5-7B-Instruct">Qwen 2.5 7B (æ¨è)</option>
  <option value="Qwen/Qwen2.5-14B-Instruct">Qwen 2.5 14B</option>
  <option value="deepseek-chat">DeepSeek Chat</option>
</select>

<!-- ä¿®å¤åï¼ˆåŠ¨æ€åŠ è½½ï¼‰ -->
<select v-model="interpreterModel">
  <option v-for="model in availableModels" :key="model" :value="model">
    {{ model }}
  </option>
</select>
```

**å®ç°ç»†èŠ‚**:
```javascript
// åŠ è½½å¯ç”¨æ¨¡å‹åˆ—è¡¨
const loadAvailableModels = async () => {
  try {
    const response = await fetch('http://localhost:8000/api/agents/config')
    const config = await response.json()
    availableModels.value = config.selectedModels || []
    console.log('åŠ è½½å¯ç”¨æ¨¡å‹:', availableModels.value)
  } catch (error) {
    console.error('åŠ è½½æ¨¡å‹åˆ—è¡¨å¤±è´¥:', error)
    // é»˜è®¤æ¨¡å‹
    availableModels.value = [
      'Qwen/Qwen2.5-7B-Instruct',
      'Qwen/Qwen3-8B',
      'deepseek-chat'
    ]
  }
}

// æ‰“å¼€é…ç½®å¼¹çª—æ—¶åŠ è½½
<button @click="showInterpreterConfig = true; loadAvailableModels()">
  âš™ï¸
</button>
```

### é—®é¢˜2: æ–°é—»æ˜¾ç¤ºé€»è¾‘ä¼˜åŒ– âœ…

**é—®é¢˜æè¿°**:
- ç»Ÿè®¡æ€»æ•°360æ¡
- å®é™…åªæ˜¾ç¤º20-30æ¡
- ç”¨æˆ·å¸Œæœ›çœ‹åˆ°æ›´å¤šéä¸­æ€§æ–°é—»

**ä¼˜åŒ–æ–¹æ¡ˆ**:
æ™ºèƒ½è¿‡æ»¤é€»è¾‘ - ä¼˜å…ˆæ˜¾ç¤ºéä¸­æ€§æ–°é—»ï¼Œä½†ä¸å°‘äº30ç¯‡

**è¿‡æ»¤è§„åˆ™**:
```
1. å¦‚æœéä¸­æ€§æ–°é—» >= 30ç¯‡
   â†’ åªæ˜¾ç¤ºéä¸­æ€§æ–°é—»

2. å¦‚æœéä¸­æ€§æ–°é—» < 30ç¯‡
   â†’ æ˜¾ç¤ºæ‰€æœ‰éä¸­æ€§ + éƒ¨åˆ†ä¸­æ€§
   â†’ æ€»æ•°è¾¾åˆ°30ç¯‡

3. å¦‚æœæ€»æ•° < 30ç¯‡
   â†’ æ˜¾ç¤ºå…¨éƒ¨æ–°é—»
```

**å®ç°ä»£ç **:
```python
def _filter_news_by_sentiment(self, news_list: List[Dict]) -> Dict:
    """æ™ºèƒ½è¿‡æ»¤æ–°é—»"""
    # åˆ†ç±»æ–°é—»
    positive_news = []
    negative_news = []
    neutral_news = []
    
    for news in news_list:
        score = self.sentiment_analyzer.analyze_text_sentiment(text)
        if score > 0.2:
            positive_news.append(news)
        elif score < -0.2:
            negative_news.append(news)
        else:
            neutral_news.append(news)
    
    non_neutral_count = len(positive_news) + len(negative_news)
    min_count = 30
    
    # å†³ç­–é€»è¾‘
    if non_neutral_count >= min_count:
        # æƒ…å†µ1ï¼šéä¸­æ€§è¶³å¤Ÿ
        filtered = positive_news + negative_news
        strategy = f'åªæ˜¾ç¤ºéä¸­æ€§æ–°é—» ({non_neutral_count}ç¯‡)'
    elif total_count <= min_count:
        # æƒ…å†µ2ï¼šæ€»æ•°ä¸è¶³
        filtered = news_list
        strategy = f'æ€»æ•°ä¸è¶³ï¼Œæ˜¾ç¤ºå…¨éƒ¨ ({total_count}ç¯‡)'
    else:
        # æƒ…å†µ3ï¼šè¡¥å……ä¸­æ€§
        need_neutral = min_count - non_neutral_count
        filtered = positive_news + negative_news + neutral_news[:need_neutral]
        strategy = f'éä¸­æ€§{non_neutral_count}ç¯‡ + ä¸­æ€§{need_neutral}ç¯‡'
    
    return {
        'news': filtered,
        'positive_count': len(positive_news),
        'negative_count': len(negative_news),
        'neutral_count': len(neutral_news),
        'strategy': strategy
    }
```

## ğŸ“Š è¿‡æ»¤æ•ˆæœç¤ºä¾‹

### ç¤ºä¾‹1: éä¸­æ€§æ–°é—»å……è¶³
```
æ€»æ•°: 360æ¡
æ­£é¢: 45æ¡
è´Ÿé¢: 38æ¡
ä¸­æ€§: 277æ¡

è¿‡æ»¤ç»“æœ: 83æ¡ï¼ˆ45æ­£é¢ + 38è´Ÿé¢ï¼‰
ç­–ç•¥: åªæ˜¾ç¤ºéä¸­æ€§æ–°é—» (83ç¯‡)
```

### ç¤ºä¾‹2: éä¸­æ€§æ–°é—»ä¸è¶³
```
æ€»æ•°: 360æ¡
æ­£é¢: 12æ¡
è´Ÿé¢: 8æ¡
ä¸­æ€§: 340æ¡

è¿‡æ»¤ç»“æœ: 30æ¡ï¼ˆ12æ­£é¢ + 8è´Ÿé¢ + 10ä¸­æ€§ï¼‰
ç­–ç•¥: éä¸­æ€§20ç¯‡ + ä¸­æ€§10ç¯‡ = 30ç¯‡
```

### ç¤ºä¾‹3: æ€»æ•°ä¸è¶³
```
æ€»æ•°: 25æ¡
æ­£é¢: 5æ¡
è´Ÿé¢: 3æ¡
ä¸­æ€§: 17æ¡

è¿‡æ»¤ç»“æœ: 25æ¡ï¼ˆå…¨éƒ¨ï¼‰
ç­–ç•¥: æ€»æ•°ä¸è¶³ï¼Œæ˜¾ç¤ºå…¨éƒ¨ (25ç¯‡)
```

## ğŸ“‹ ä¿®æ”¹çš„æ–‡ä»¶

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|---------|
| `AnalysisView.vue` | æ·»åŠ availableModelsçŠ¶æ€ |
| `AnalysisView.vue` | æ·»åŠ loadAvailableModelsæ–¹æ³• |
| `AnalysisView.vue` | æ¨¡å‹é€‰æ‹©æ”¹ä¸ºåŠ¨æ€åŠ è½½ |
| `unified_news_api.py` | æ·»åŠ _filter_news_by_sentimentæ–¹æ³• |
| `unified_news_api.py` | åœ¨æƒ…ç»ªåˆ†æåè°ƒç”¨è¿‡æ»¤ |

## ğŸ¯ è¿”å›æ•°æ®ç»“æ„

### æ–°å¢å­—æ®µ

```json
{
  "summary": {
    "sentiment": {
      "sentiment_score": 0.15,
      "sentiment_label": "åç§¯æ",
      "positive_count": 45,
      "negative_count": 38,
      "neutral_count": 277
    },
    "filtered_news": {
      "news": [...],  // è¿‡æ»¤åçš„æ–°é—»åˆ—è¡¨
      "positive_count": 45,
      "negative_count": 38,
      "neutral_count": 0,
      "strategy": "åªæ˜¾ç¤ºéä¸­æ€§æ–°é—» (83ç¯‡)"
    },
    "filter_info": {
      "total_count": 360,
      "filtered_count": 83,
      "positive_count": 45,
      "negative_count": 38,
      "neutral_count": 0,
      "filter_strategy": "åªæ˜¾ç¤ºéä¸­æ€§æ–°é—» (83ç¯‡)"
    }
  }
}
```

## âœ… ä¼˜åŠ¿

### æ¨¡å‹é…ç½®
1. **åŠ¨æ€åŠ è½½** - ä»é…ç½®æ–‡ä»¶è¯»å–
2. **è‡ªåŠ¨åŒæ­¥** - ä¸ModelManagerä¸€è‡´
3. **æ˜“äºæ‰©å±•** - æ·»åŠ æ–°æ¨¡å‹è‡ªåŠ¨æ˜¾ç¤º

### æ–°é—»è¿‡æ»¤
1. **æ™ºèƒ½è¿‡æ»¤** - ä¼˜å…ˆæ˜¾ç¤ºæœ‰ä»·å€¼çš„æ–°é—»
2. **ä¿è¯æ•°é‡** - è‡³å°‘30ç¯‡
3. **çµæ´»ç­–ç•¥** - æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´
4. **é€æ˜å¯è§** - æ˜¾ç¤ºè¿‡æ»¤ç­–ç•¥

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æµ‹è¯•æ¨¡å‹é…ç½®
1. åˆ·æ–°å‰ç«¯
2. å¼€å§‹åˆ†æ
3. åˆ‡æ¢åˆ°ç™½è¯ç‰ˆ
4. ç‚¹å‡»âš™ï¸é…ç½®
5. æŸ¥çœ‹æ¨¡å‹åˆ—è¡¨ï¼ˆåº”è¯¥æ˜¾ç¤ºæ‰€æœ‰selectedModelsï¼‰

### æµ‹è¯•æ–°é—»è¿‡æ»¤
1. é‡å¯åç«¯
2. å¼€å§‹åˆ†æ
3. æŸ¥çœ‹æ–°é—»åˆ†æå¸ˆçš„æ•°æ®æº
4. æ£€æŸ¥åç«¯æ—¥å¿—ï¼š
   ```
   âœ… æ–°é—»è¿‡æ»¤å®Œæˆ: 360æ¡ -> 83æ¡ (åªæ˜¾ç¤ºéä¸­æ€§æ–°é—»)
   ```

## ğŸ“ é…ç½®æ–‡ä»¶æ ¼å¼

`backend/agent_configs.json`:
```json
{
  "agents": [
    {
      "id": "interpreter",
      "modelName": "Qwen/Qwen2.5-7B-Instruct",
      "modelProvider": "SILICONFLOW",
      "temperature": 0.7
    }
  ],
  "selectedModels": [
    "gemini-2.0-flash-exp",
    "deepseek-chat",
    "qwen-plus",
    "Qwen/Qwen2.5-7B-Instruct",
    "Qwen/Qwen3-8B",
    "deepseek-ai/DeepSeek-V3.2-Exp"
  ]
}
```

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡æ›´æ–°ï¼š
1. âœ… ä¿®å¤æ¨¡å‹é€‰æ‹©ç¡¬ç¼–ç é—®é¢˜
2. âœ… åŠ¨æ€åŠ è½½selectedModels
3. âœ… ä¼˜åŒ–æ–°é—»æ˜¾ç¤ºé€»è¾‘
4. âœ… æ™ºèƒ½è¿‡æ»¤éä¸­æ€§æ–°é—»
5. âœ… ä¿è¯è‡³å°‘30ç¯‡æ˜¾ç¤º

**ç°åœ¨æ¨¡å‹é…ç½®æ›´çµæ´»ï¼Œæ–°é—»æ˜¾ç¤ºæ›´æ™ºèƒ½ï¼**ğŸ‰

## ğŸ“ ç›¸å…³ç‰ˆæœ¬

- v1.10.0 - GMå¡ç‰‡æ ‡ç­¾ç‰ˆ
- v1.10.1 - ç½‘ç»œé”™è¯¯ä¿®å¤ç‰ˆ
- v1.10.2 - é»˜è®¤æ¨¡å‹ä¿®å¤ç‰ˆ
- v1.10.3 - ç™½è¯è§£è¯»å‘˜é…ç½®ç‰ˆ
- v1.10.4 - æ¨¡å‹é…ç½®å’Œæ–°é—»è¿‡æ»¤ç‰ˆ â† å½“å‰ç‰ˆæœ¬
