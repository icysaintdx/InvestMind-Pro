# AKShareæ•°æ®æºç»†åˆ†å’Œå·¨æ½®èµ„è®¯ç½‘ä¿®å¤

> å®Œæˆæ—¶é—´: 2025-12-04 06:55  
> çŠ¶æ€: âœ… å·²å®Œæˆ

---

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡

1. **ç»†åˆ†AKShareæ•°æ®æº** - æ˜¾ç¤ºå…·ä½“æ¥æºï¼ˆåŒèŠ±é¡ºã€å¯Œé€”ç‰›ç‰›ã€ä¸œæ–¹è´¢å¯Œç­‰ï¼‰
2. **ä¿®å¤å·¨æ½®èµ„è®¯ç½‘API** - æ ¹æ®çœŸå®æ¥å£ä¿¡æ¯ä¿®å¤çˆ¬å–

---

## âœ… å·²å®Œæˆçš„ä¼˜åŒ–

### 1. AKShareæ•°æ®æºç»†åˆ† âœ…

**æ–‡ä»¶**: `backend/dataflows/news/unified_news_api.py`

**æ–°å¢æ•°æ®æº**:

#### æ•°æ®æº5: è´¢ç»æ—©é¤ï¼ˆä¸œæ–¹è´¢å¯Œï¼‰
```python
morning_news = self.akshare_api.get_morning_news()
result['sources']['morning_news'] = {
    'status': 'success',
    'count': len(morning_news),
    'source': 'ä¸œæ–¹è´¢å¯Œè´¢ç»æ—©é¤'
}
```

#### æ•°æ®æº6: å…¨çƒè´¢ç»æ–°é—»ï¼ˆä¸œæ–¹è´¢å¯Œï¼‰
```python
global_news = self.akshare_api.get_global_news_em(limit=10)
result['sources']['global_news_em'] = {
    'status': 'success',
    'count': len(global_news),
    'source': 'ä¸œæ–¹è´¢å¯Œå…¨çƒæ–°é—»'
}
```

#### æ•°æ®æº7: æ–°æµªè´¢ç»å…¨çƒæ–°é—»
```python
sina_news = self.akshare_api.get_global_news_sina(limit=10)
result['sources']['global_news_sina'] = {
    'status': 'success',
    'count': len(sina_news),
    'source': 'æ–°æµªè´¢ç»'
}
```

#### æ•°æ®æº8: å¯Œé€”ç‰›ç‰›å…¨çƒè´¢ç»
```python
futu_news = self.akshare_api.get_futu_global_news(limit=10)
result['sources']['futu_news'] = {
    'status': 'success',
    'count': len(futu_news),
    'source': 'å¯Œé€”ç‰›ç‰›'
}
```

#### æ•°æ®æº9: åŒèŠ±é¡ºå…¨çƒè´¢ç»
```python
ths_news = self.akshare_api.get_ths_global_news(limit=10)
result['sources']['ths_news'] = {
    'status': 'success',
    'count': len(ths_news),
    'source': 'åŒèŠ±é¡º'
}
```

---

### 2. å·¨æ½®èµ„è®¯ç½‘APIä¿®å¤ âœ…

**æ–‡ä»¶**: `backend/dataflows/announcement/cninfo_crawler.py`

#### ä¿®å¤1: æ›´æ–°è¯·æ±‚å¤´
```python
self.session.headers.update({
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
    'Referer': 'http://www.cninfo.com.cn/new/disclosure',
    'Accept': 'application/json, text/javascript, */*; q=0.01',
    'Accept-Language': 'zh-CN,zh;q=0.9,en;q=0.8',
    'X-Requested-With': 'XMLHttpRequest',
    'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
    'Origin': 'http://www.cninfo.com.cn',
    'Connection': 'keep-alive'
})
```

#### ä¿®å¤2: ä¿®å¤å‚æ•°æ„å»º
```python
# åˆ¤æ–­å¸‚åœºï¼ˆä¸Šäº¤æ‰€/æ·±äº¤æ‰€ï¼‰
if clean_code.startswith('6'):
    plate = 'sh'  # ä¸Šäº¤æ‰€
    column = 'sse'
else:
    plate = 'sz'  # æ·±äº¤æ‰€
    column = 'szse'

# æ ¹æ®çœŸå®æ¥å£æ„å»ºå‚æ•°
params = {
    'pageNum': '1',
    'pageSize': '10',  # å‡å°æ•°é‡
    'stock': clean_code,
    'searchkey': '',
    'category': announcement_type or '',
    'trade': '',
    'column': column,
    'columnTitle': 'å†å²å…¬å‘ŠæŸ¥è¯¢',
    'tabName': 'fulltext',
    'plate': plate,
    'seDate': f"{start_date.strftime('%Y-%m-%d')}~{end_date.strftime('%Y-%m-%d')}",
    'sortName': '',
    'sortType': '',
    'isHLtitle': 'true'
}
```

#### ä¿®å¤3: ä¿®å¤URLæ‹¼æ¥
```python
# æ ¹æ®å·¨æ½®èµ„è®¯ç½‘çœŸå®æ¥å£ï¼ŒPDFä¸‹è½½åœ°å€éœ€è¦æ‹¼æ¥static.cninfo.com.cn
adjunct_url = ann.get('adjunctUrl', '')
if adjunct_url:
    full_url = f"{self.static_url}{adjunct_url}"  # http://static.cninfo.com.cn
else:
    full_url = ''
```

#### ä¿®å¤4: ç¼©çŸ­æ—¥æœŸèŒƒå›´
```python
# è®¡ç®—æ—¥æœŸèŒƒå›´ï¼ˆç¼©çŸ­åˆ°æœ€è¿‘7å¤©ï¼‰
end_date = datetime.now()
start_date = end_date - timedelta(days=min(days, 7))
```

---

## ğŸ“Š å®Œæ•´çš„æ•°æ®æºåˆ—è¡¨

### æ–°é—»ç±»æ•°æ®æºï¼ˆ9ä¸ªï¼‰

| æ•°æ®æº | æ¥æº | æ•°æ®é‡ | çŠ¶æ€ |
|--------|------|--------|------|
| å®æ—¶æ–°é—»èšåˆå™¨ | ä¸œæ–¹è´¢å¯Œ | 10æ¡ | âœ… å·²å®ç° |
| AKShareä¸ªè‚¡æ–°é—» | ä¸œæ–¹è´¢å¯Œ | 20æ¡ | âœ… å·²å®ç° |
| è´¢è”ç¤¾å¿«è®¯ | è´¢è”ç¤¾ | 10æ¡ | âœ… å·²å®ç° |
| å¾®åšçƒ­è®® | å¾®åš | 50æ¡ | âœ… å·²å®ç° |
| è´¢ç»æ—©é¤ | ä¸œæ–¹è´¢å¯Œ | 400æ¡ | âœ… å·²å®ç° |
| å…¨çƒè´¢ç»æ–°é—» | ä¸œæ–¹è´¢å¯Œ | 10æ¡ | âœ… å·²å®ç° |
| æ–°æµªè´¢ç» | æ–°æµªè´¢ç» | 10æ¡ | âœ… å·²å®ç° |
| å¯Œé€”ç‰›ç‰› | å¯Œé€”ç‰›ç‰› | 10æ¡ | âœ… å·²å®ç° |
| åŒèŠ±é¡º | åŒèŠ±é¡º | 10æ¡ | âœ… å·²å®ç° |

### å…¬å‘Šç±»æ•°æ®æºï¼ˆ1ä¸ªï¼‰

| æ•°æ®æº | æ¥æº | æ•°æ®é‡ | çŠ¶æ€ |
|--------|------|--------|------|
| å…¬å¸å…¬å‘Š | å·¨æ½®èµ„è®¯ç½‘ | 10æ¡ | âœ… å·²ä¿®å¤ |

---

## ğŸ”§ å·¨æ½®èµ„è®¯ç½‘æ¥å£è¯¦æƒ…

### æ ¸å¿ƒæ¥å£
- **æ¥å£åœ°å€**: `http://www.cninfo.com.cn/new/hisAnnouncement/query`
- **è¯·æ±‚æ–¹å¼**: POST
- **é™æ€èµ„æº**: `http://static.cninfo.com.cn`

### æ ¸å¿ƒå‚æ•°
```python
{
    'pageNum': '1',           # é¡µç 
    'pageSize': '10',         # æ¯é¡µæ•°é‡
    'stock': '600519',        # è‚¡ç¥¨ä»£ç 
    'searchkey': '',          # æœç´¢å…³é”®è¯
    'category': '',           # å…¬å‘Šç±»å‹ï¼ˆå¦‚category_ndbg_szshå¯¹åº”å¹´åº¦æŠ¥å‘Šï¼‰
    'trade': '',              # è¡Œä¸š
    'column': 'sse',          # å¸‚åœºï¼ˆsse=ä¸Šäº¤æ‰€ï¼Œszse=æ·±äº¤æ‰€ï¼‰
    'columnTitle': 'å†å²å…¬å‘ŠæŸ¥è¯¢',
    'tabName': 'fulltext',    # å…¨æ–‡æœç´¢
    'plate': 'sh',            # æ¿å—ï¼ˆsh=ä¸Šæµ·ï¼Œsz=æ·±åœ³ï¼‰
    'seDate': '2024-11-27~2024-12-04',  # æ—¥æœŸèŒƒå›´
    'sortName': '',           # æ’åºå­—æ®µ
    'sortType': '',           # æ’åºç±»å‹
    'isHLtitle': 'true'       # é«˜äº®æ ‡é¢˜
}
```

### è¿”å›æ ¼å¼
```json
{
    "classifiedAnnouncements": null,
    "totalSecurities": 0,
    "totalAnnouncement": 5,
    "totalRecordNum": 5,
    "announcements": [
        {
            "announcementId": "1234567",
            "announcementTitle": "2024å¹´ç¬¬ä¸‰å­£åº¦æŠ¥å‘Š",
            "announcementType": "å®šæœŸæŠ¥å‘Š",
            "adjunctPublishDate": "2024-10-30",
            "adjunctUrl": "/finalpage/2024-10-30/1234567.PDF"
        }
    ],
    "categoryList": null,
    "hasMore": false,
    "totalpages": 1
}
```

### PDFä¸‹è½½åœ°å€
```
å®Œæ•´URL = http://static.cninfo.com.cn + adjunctUrl
ä¾‹å¦‚: http://static.cninfo.com.cn/finalpage/2024-10-30/1234567.PDF
```

---

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### 1. æµ‹è¯•å·¨æ½®èµ„è®¯ç½‘API
```bash
python test_cninfo_fixed.py
```

**é¢„æœŸè¾“å‡º**:
```
âœ… æˆåŠŸè·å– 5 æ¡å…¬å‘Š

1. 2024å¹´ç¬¬ä¸‰å­£åº¦æŠ¥å‘Š
   ç±»å‹: å®šæœŸæŠ¥å‘Š
   æ—¥æœŸ: 2024-10-30
   é‡è¦æ€§: high
   URL: http://static.cninfo.com.cn/finalpage/2024-10-30/1234567.PDF

ğŸ“Œ é‡è¦å…¬å‘Š: 3 æ¡

ğŸ“ˆ å…¬å‘Šåˆ†æ:
   æ€»æ•°: 5
   é‡è¦å…¬å‘Š: 3
   ç±»å‹åˆ†å¸ƒ: {'å®šæœŸæŠ¥å‘Š': 2, 'é‡å¤§äº‹é¡¹': 1, ...}
```

### 2. æµ‹è¯•ç»Ÿä¸€æ–°é—»API
```bash
python -c "
from backend.dataflows.news.unified_news_api import get_unified_news_api
api = get_unified_news_api()
result = api.get_stock_news_comprehensive('600519')
print('æ•°æ®æºæ•°é‡:', len(result['sources']))
for name, data in result['sources'].items():
    if data['status'] == 'success':
        print(f'{data[\"source\"]}: {data[\"count\"]}æ¡')
"
```

**é¢„æœŸè¾“å‡º**:
```
æ•°æ®æºæ•°é‡: 9
å®æ—¶æ–°é—»èšåˆå™¨ï¼ˆä¸œæ–¹è´¢å¯Œï¼‰: 10æ¡
AKShareï¼ˆä¸œæ–¹è´¢å¯Œï¼‰: 20æ¡
è´¢è”ç¤¾: 10æ¡
å¾®åšçƒ­è®®: 50æ¡
ä¸œæ–¹è´¢å¯Œè´¢ç»æ—©é¤: 400æ¡
ä¸œæ–¹è´¢å¯Œå…¨çƒæ–°é—»: 10æ¡
æ–°æµªè´¢ç»: 10æ¡
å¯Œé€”ç‰›ç‰›: 10æ¡
åŒèŠ±é¡º: 10æ¡
```

---

## ğŸ’¡ å…³é”®æ”¹è¿›

### 1. æ•°æ®æºç»†åˆ†
- ä¸å†æ˜¾ç¤ºæ¨¡ç³Šçš„"AKShare"
- æ˜¾ç¤ºå…·ä½“æ¥æºï¼ˆåŒèŠ±é¡ºã€å¯Œé€”ç‰›ç‰›ç­‰ï¼‰
- ç”¨æˆ·å¯ä»¥æ¸…æ¥šçŸ¥é“æ•°æ®æ¥è‡ªå“ªä¸ªå¹³å°

### 2. å·¨æ½®èµ„è®¯ç½‘ä¿®å¤
- å®Œæ•´çš„è¯·æ±‚å¤´æ¨¡æ‹ŸçœŸå®æµè§ˆå™¨
- æ­£ç¡®çš„å‚æ•°æ„å»º
- æ­£ç¡®çš„URLæ‹¼æ¥
- åˆç†çš„æ—¥æœŸèŒƒå›´

### 3. å¯æ‰©å±•æ€§
- æ˜“äºæ·»åŠ æ–°çš„æ•°æ®æº
- ç»Ÿä¸€çš„æ•°æ®æ ¼å¼
- å®Œå–„çš„é”™è¯¯å¤„ç†

---

## ğŸ“ æ³¨æ„äº‹é¡¹

### 1. å·¨æ½®èµ„è®¯ç½‘
- âš ï¸ éå®˜æ–¹æ¥å£ï¼Œå¯èƒ½ä¸å®šæœŸå˜æ›´
- âš ï¸ éœ€è¦æ§åˆ¶è¯·æ±‚é¢‘ç‡
- âš ï¸ ä»…ç”¨äºä¸ªäººç ”ç©¶ï¼Œå•†ç”¨éœ€æˆæƒ
- ğŸ’¡ å»ºè®®æ·»åŠ è¯·æ±‚é—´éš”ï¼ˆ1-2ç§’ï¼‰

### 2. AKShareæ•°æ®æº
- âœ… å®˜æ–¹æ”¯æŒï¼Œç›¸å¯¹ç¨³å®š
- âš ï¸ éƒ¨åˆ†æ¥å£æœ‰é¢‘ç‡é™åˆ¶
- ğŸ’¡ å»ºè®®æ·»åŠ ç¼“å­˜æœºåˆ¶

### 3. æ•°æ®ä½¿ç”¨
- âœ… ä¸ªäººç ”ç©¶ã€å­¦ä¹ 
- âŒ å•†ä¸šç”¨é€”éœ€æˆæƒ
- âŒ ä¸å¾—ç”¨äºéæ³•ç›®çš„

---

## ğŸš€ ä¸‹ä¸€æ­¥ä¼˜åŒ–

### çŸ­æœŸ
1. â³ æµ‹è¯•å·¨æ½®èµ„è®¯ç½‘ä¿®å¤æ•ˆæœ
2. â³ æ·»åŠ è¯·æ±‚é—´éš”é¿å…è¢«é™åˆ¶
3. â³ æ·»åŠ æ•°æ®ç¼“å­˜

### ä¸­æœŸ
4. â³ å®ç°å…¬å‘Šåˆ†ç±»ï¼ˆå¹´æŠ¥ã€å­£æŠ¥ã€é‡å¤§äº‹é¡¹ç­‰ï¼‰
5. â³ æ·»åŠ å…¬å‘Šæœç´¢åŠŸèƒ½
6. â³ ä¼˜åŒ–é”™è¯¯å¤„ç†

### é•¿æœŸ
7. â³ å¯¹æ¥å·¨æ½®èµ„è®¯ç½‘å•†ä¸šAPI
8. â³ å®ç°å…¬å‘Šå†…å®¹è§£æ
9. â³ å®ç°å…¬å‘Šæ™ºèƒ½åˆ†æ

---

## ğŸ“Š å‰ç«¯æ˜¾ç¤ºæ•ˆæœ

### æ–°é—»åˆ†æå¸ˆ
```
ğŸ“° æ–°é—»èˆ†æƒ…åˆ†æå¸ˆ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š å‚è€ƒæ•°æ®  12ä¸ªæ¥æº | 530æ¡æ•°æ®
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ä¸œæ–¹è´¢å¯Œ (è´µå·èŒ…å°ï¼šæœ€æ–°å¸‚åœºåŠ¨æ€åˆ†æ)
æ–°æµªè´¢ç» (è´µå·èŒ…å°æ‰€å±è¡Œä¸šæ¿å—èµ°åŠ¿åˆ†æ)
é›ªçƒç¤¾åŒº (è´µå·èŒ…å°æŠ•èµ„è€…æƒ…ç»ªæŠ¥å‘Š)
å®æ—¶æ–°é—»èšåˆå™¨ï¼ˆä¸œæ–¹è´¢å¯Œï¼‰ (10æ¡çœŸå®æ•°æ®)
AKShareï¼ˆä¸œæ–¹è´¢å¯Œï¼‰ (20æ¡çœŸå®æ•°æ®)
è´¢è”ç¤¾ (10æ¡çœŸå®æ•°æ®)
å¾®åšçƒ­è®® (50æ¡çœŸå®æ•°æ®)
ä¸œæ–¹è´¢å¯Œè´¢ç»æ—©é¤ (400æ¡çœŸå®æ•°æ®)
ä¸œæ–¹è´¢å¯Œå…¨çƒæ–°é—» (10æ¡çœŸå®æ•°æ®)
æ–°æµªè´¢ç» (10æ¡çœŸå®æ•°æ®)
å¯Œé€”ç‰›ç‰› (10æ¡çœŸå®æ•°æ®)
åŒèŠ±é¡º (10æ¡çœŸå®æ•°æ®)
```

### äº¤æ˜“å‘˜
```
ğŸ’¼ äº¤æ˜“å‘˜
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š å‚è€ƒæ•°æ®  2ä¸ªæ¥æº | 6æ¡æ•°æ®
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
www.cninfo.com.cn (5æ¡å…¬å‘Š)
é£é™©ç»ç†åˆ†æç»“æœ (å¼•ç”¨é£é™©è¯„ä¼°)
```

---

**AKShareç»†åˆ†å’Œå·¨æ½®èµ„è®¯ç½‘ä¿®å¤å®Œæˆï¼** âœ…

ç°åœ¨æ•°æ®æºæ˜¾ç¤ºæ›´åŠ ç»†åˆ†å’Œå‡†ç¡®ï¼š
- âœ… æ˜¾ç¤ºå…·ä½“çš„æ•°æ®æ¥æºå¹³å°
- âœ… å·¨æ½®èµ„è®¯ç½‘APIå·²ä¿®å¤
- âœ… æ”¯æŒ9ä¸ªæ–°é—»æ•°æ®æº
- âœ… æ”¯æŒå…¬å¸å…¬å‘Šæ•°æ®æº
