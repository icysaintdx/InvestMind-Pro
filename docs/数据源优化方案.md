# InvestMindPro 数据源优化方案

生成时间: 2026-01-01

---

## 一、测试结果汇总

### 1.1 各数据源响应时间测试

| 数据源 | 接口 | 响应时间 | 状态 | 备注 |
|--------|------|---------|------|------|
| **TDX** | 单只行情 | 60ms | 正常 | 最快 |
| **TDX** | 批量行情(20只) | 64ms | 正常 | 最快 |
| **TDX** | K线数据 | 60ms | 正常 | 最快 |
| **TDX** | 股票列表 | 123ms | 正常 | |
| **Tushare** | 日K线 | 100-180ms | 正常 | 稳定 |
| **Tushare** | 股票列表 | 220-240ms | 正常 | 5470条 |
| **Tushare** | 利润表 | 120-140ms | 正常 | |
| **Tushare** | 资金流向 | 100-120ms | 正常 | |
| **Tushare** | 龙虎榜 | 90-120ms | 正常 | |
| **Tushare** | 融资融券 | 97-116ms | 正常 | |
| **AKShare** | 全市场行情 | 18-23秒 | 慢 | 5792条数据量大 |
| **AKShare** | 全球资讯 | 180-200ms | 正常 | |
| **AKShare** | 五档盘口 | 160-510ms | 正常 | |
| **AKShare** | 历史K线 | 160-510ms | 正常 | |
| **AKShare** | 龙虎榜 | 370ms | 正常 | |
| **AKShare** | 融资融券 | 540-600ms | 正常 | |
| **AKShare** | 行业板块 | 250-1200ms | 波动 | |
| **AKShare** | 概念板块 | 600ms | 正常 | |
| **AKShare** | 个股资金流 | 85-94ms | 正常 | 很快 |
| **AKShare** | 公司信息 | 84-100ms | 正常 | |
| **AKShare** | 个股新闻 | 80ms | 错误 | JSON解析错误 |
| **AKShare** | 主营构成 | - | 错误 | 接口异常 |
| **巨潮** | 所有接口 | 120-150ms | 需Token | 响应快但需认证 |

### 1.2 关键发现

1. **AKShare大部分接口是快的**（100-600ms），只有全市场行情慢（因为5792只股票）
2. **TDX最快最稳定**（60-120ms），适合实时行情
3. **Tushare稳定可靠**（100-240ms），适合财务数据
4. **巨潮需要Token**，响应本身很快（120-150ms）
5. **AKShare部分接口有bug**（个股新闻JSON解析、主营构成接口异常）

---

## 二、数据分类与接口覆盖对照表

### 2.1 实时行情类

| 数据类型 | TDX | Tushare | AKShare | 巨潮 | 推荐 |
|---------|-----|---------|---------|------|------|
| 单只股票实时行情 | 60ms | X | 200ms | X | TDX |
| 批量股票行情 | 64ms | X | 18s | X | TDX |
| 五档盘口 | 60ms | X | 300ms | X | TDX |
| 指数行情 | 60ms | X | 200ms | X | TDX |
| 分时数据 | 60ms | X | 500ms | X | TDX |

### 2.2 K线历史类

| 数据类型 | TDX | Tushare | AKShare | 巨潮 | 推荐 |
|---------|-----|---------|---------|------|------|
| 日K线 | 60ms | 120ms | 300ms | 需Token | TDX/Tushare |
| 周K线 | 60ms | 120ms | 300ms | 需Token | TDX/Tushare |
| 分钟K线 | 60ms | X | 500ms | X | TDX |
| 复权数据 | X | 120ms | 300ms | X | Tushare |

### 2.3 财务数据类

| 数据类型 | TDX | Tushare | AKShare | 巨潮 | 推荐 |
|---------|-----|---------|---------|------|------|
| 利润表 | X | 130ms | 500ms | 需Token | Tushare |
| 资产负债表 | X | 130ms | 500ms | 需Token | Tushare |
| 现金流量表 | X | 130ms | 500ms | 需Token | Tushare |
| 财务指标 | X | 130ms | 500ms | 需Token | Tushare |
| 主营构成 | X | 130ms | 错误 | X | Tushare |
| 业绩预告 | X | 130ms | 500ms | X | Tushare |

### 2.4 资金流向类

| 数据类型 | TDX | Tushare | AKShare | 巨潮 | 推荐 |
|---------|-----|---------|---------|------|------|
| 个股资金流向 | X | 110ms | 90ms | X | AKShare |
| 板块资金流向 | X | X | 600ms | X | AKShare |
| 北向资金 | X | 150ms | 500ms | X | Tushare |
| 融资融券 | X | 100ms | 550ms | X | Tushare |

### 2.5 龙虎榜类

| 数据类型 | TDX | Tushare | AKShare | 巨潮 | 推荐 |
|---------|-----|---------|---------|------|------|
| 龙虎榜明细 | X | 110ms | 370ms | X | Tushare |
| 机构龙虎榜 | X | 110ms | 400ms | X | Tushare |
| 游资统计 | X | X | 400ms | X | AKShare |

### 2.6 新闻公告类

| 数据类型 | TDX | Tushare | AKShare | 巨潮 | 推荐 |
|---------|-----|---------|---------|------|------|
| 全球资讯 | X | X | 190ms | X | AKShare |
| 财联社电报 | X | X | 450ms | X | AKShare |
| 个股新闻 | X | X | 错误 | 需Token | 巨潮 |
| 公司公告 | X | X | 500ms | 需Token | AKShare/巨潮 |

### 2.7 公司信息类

| 数据类型 | TDX | Tushare | AKShare | 巨潮 | 推荐 |
|---------|-----|---------|---------|------|------|
| 公司基本信息 | X | 200ms | 90ms | 需Token | AKShare |
| 股票列表 | 123ms | 230ms | 18s | X | TDX |
| 管理层信息 | X | X | 500ms | 需Token | AKShare/巨潮 |
| 股东信息 | X | 200ms | 500ms | 需Token | Tushare |

### 2.8 市场统计类

| 数据类型 | TDX | Tushare | AKShare | 巨潮 | 推荐 |
|---------|-----|---------|---------|------|------|
| 涨跌停统计 | 计算 | X | 240ms | X | TDX缓存 |
| 行业板块 | X | X | 700ms | X | AKShare+缓存 |
| 概念板块 | X | X | 600ms | X | AKShare+缓存 |
| ST股票列表 | X | 200ms | 500ms | X | Tushare |

---

## 三、灵活数据源管理方案设计

### 3.1 核心设计理念

1. **按数据类型配置**：每种数据类型独立配置数据源优先级
2. **动态健康检测**：实时监控各数据源可用性和响应时间
3. **智能降级切换**：主数据源失败自动切换到备用源
4. **分层缓存机制**：根据数据特性设置不同缓存策略
5. **前端可配置**：用户可在界面调整数据源和缓存设置

### 3.2 缓存策略分类

| 数据类型 | 缓存时效(TTL) | 更新间隔 | 更新时机 |
|---------|-------------|---------|---------|
| 实时行情 | 60秒 | 30秒 | 交易时段持续更新 |
| 分时数据 | 60秒 | 60秒 | 交易时段持续更新 |
| 日K线 | 24小时 | 1小时 | 收盘后更新 |
| 财务报表 | 24小时 | 6小时 | 定期报告期更新 |
| 资金流向 | 5分钟 | 5分钟 | 交易时段更新 |
| 龙虎榜 | 1小时 | 30分钟 | 收盘后更新 |
| 新闻资讯 | 5分钟 | 3分钟 | 持续更新 |
| 公司信息 | 24小时 | 24小时 | 每日更新 |
| 板块信息 | 10分钟 | 10分钟 | 交易时段更新 |

### 3.3 系统架构



### 3.4 健康检测机制

- provider: 数据源名称
- is_available: 是否可用
- avg_response_time: 平均响应时间(ms)
- success_rate: 成功率(0-1)
- last_check: 最后检测时间
- last_error: 最后错误信息
- consecutive_failures: 连续失败次数

### 3.5 智能路由算法

1. 按配置的优先级遍历数据源
2. 检查可用性
3. 检查连续失败次数（>=3跳过）
4. 检查成功率（<0.5跳过）
5. 返回第一个满足条件的数据源
6. 所有源都不可用时，返回主数据源尝试

---

## 四、前端配置界面设计

### 4.1 数据源管理页面功能

- 每种数据类型独立配置
- 主数据源和备用数据源选择
- 缓存开关、TTL、更新间隔设置
- 实时显示各数据源状态和响应时间
- 测试所有数据源按钮
- 重置为默认配置
- 保存配置

### 4.2 数据源测试页面功能

- 选择数据类型
- 显示该类型所有可用数据源
- 测试每个数据源的响应时间
- 显示返回数据条数
- 推荐最优数据源
- 导出测试报告

---

## 五、实施计划

### 第一阶段：核心框架
1. 创建 DataSourceConfig 配置模型
2. 创建 DataSourceManager 管理类
3. 创建 ProviderHealthMonitor 健康监控
4. 实现配置文件读写

### 第二阶段：缓存服务
1. 扩展现有 TDXCacheService 为通用 DataCacheService
2. 实现分类缓存策略
3. 实现后台定时更新

### 第三阶段：数据源适配
1. 统一各数据源Provider接口
2. 实现智能路由选择
3. 实现降级切换逻辑

### 第四阶段：前端界面
1. 创建数据源管理页面
2. 创建数据源测试页面
3. 实现配置保存和加载

---

## 六、总结

本方案的核心优势：

1. **灵活性**：每种数据类型可独立配置数据源和缓存策略
2. **可靠性**：自动健康检测和降级切换，保证服务可用
3. **可维护性**：配置文件驱动，无需修改代码即可调整
4. **可观测性**：前端可视化监控各数据源状态
5. **可扩展性**：新增数据源只需实现Provider接口

通过这套方案，可以：
- 根据实际测试结果动态调整数据源优先级
- 在某个数据源出问题时自动切换
- 通过缓存减少对外部接口的依赖
- 让用户根据自己的需求自定义配置
