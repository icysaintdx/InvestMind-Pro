#!/usr/bin/env python3
"""
æµ‹è¯•çœŸå®çš„Prompté•¿åº¦ - æ¨¡æ‹Ÿç¬¬ä¸‰é˜¶æ®µé£æ§æ™ºèƒ½ä½“
"""

# æ¨¡æ‹ŸçœŸå®çš„æ™ºèƒ½ä½“è¾“å‡ºï¼ˆä»åç«¯æ—¥å¿—è·å–ï¼‰
real_outputs = {
    "news_analyst": """åŸºäºå½“å‰å¸‚åœºç¯å¢ƒå’Œè¯¥è‚¡ç¥¨çš„æ–°é—»èˆ†æƒ…åˆ†æï¼Œæˆ‘å‘ç°ä»¥ä¸‹å‡ ä¸ªå…³é”®ç‚¹ï¼š

1. è¿‘æœŸæ–°é—»æƒ…ç»ªåå‘ä¸­æ€§åç§¯æï¼Œæ²¡æœ‰é‡å¤§åˆ©ç©ºæ¶ˆæ¯
2. è¡Œä¸šæ¿å—æ•´ä½“è¡¨ç°ç¨³å®š
3. å¸‚åœºå…³æ³¨åº¦é€‚ä¸­

å»ºè®®ï¼šç»§ç»­å…³æ³¨åç»­æ–°é—»åŠ¨æ€ã€‚""",
    
    "social_analyst": """ç¤¾äº¤åª’ä½“æƒ…ç»ªåˆ†ææ˜¾ç¤ºï¼š

1. æ•£æˆ·è®¨è®ºçƒ­åº¦ä¸­ç­‰
2. æƒ…ç»ªæŒ‡æ ‡æ˜¾ç¤ºå¸‚åœºæƒ…ç»ªåè°¨æ…
3. æ²¡æœ‰æ˜æ˜¾çš„FOMOæˆ–ææ…Œæƒ…ç»ª

æ•´ä½“è¯„ä¼°ï¼šå¸‚åœºæƒ…ç»ªç›¸å¯¹ç†æ€§ã€‚""",
    
    "china_market": """ä¸­å›½å¸‚åœºç¯å¢ƒåˆ†æï¼š

1. Aè‚¡å¤§ç›˜å¤„äºéœ‡è¡æ•´ç†é˜¶æ®µ
2. å¸‚åœºæµåŠ¨æ€§é€‚ä¸­
3. æ”¿ç­–ç¯å¢ƒç›¸å¯¹ç¨³å®š
4. åŒ—å‘èµ„é‡‘æµå‘å¹³ç¨³

å»ºè®®ï¼šå…³æ³¨å¤§ç›˜èµ°åŠ¿å¯¹ä¸ªè‚¡çš„å½±å“ã€‚""",
    
    "industry": """è¡Œä¸šåˆ†æç»“è®ºï¼š

1. è¡Œä¸šå¤„äºæˆé•¿æœŸ
2. ç«äº‰æ ¼å±€ç›¸å¯¹ç¨³å®š
3. äº§ä¸šé“¾ä¸Šä¸‹æ¸¸å…³ç³»è‰¯å¥½
4. è¡Œä¸šæ”¿ç­–æ”¯æŒåŠ›åº¦é€‚ä¸­

è¯„çº§ï¼šè¡Œä¸šå‰æ™¯çœ‹å¥½ã€‚""",
    
    "macro": """å®è§‚ç»æµåˆ†æï¼š

1. è´§å¸æ”¿ç­–ä¿æŒç¨³å¥
2. è´¢æ”¿æ”¿ç­–é€‚åº¦å®½æ¾
3. ç»æµå‘¨æœŸå¤„äºå¤è‹é˜¶æ®µ
4. å›½é™…ç¯å¢ƒç›¸å¯¹ç¨³å®š

å»ºè®®ï¼šå®è§‚é¢å¯¹è¯¥è‚¡ç¥¨ååˆ©å¥½ã€‚""",
    
    "technical": """æŠ€æœ¯åˆ†æç»“è®ºï¼š

1. Kçº¿å½¢æ€æ˜¾ç¤ºä¸Šå‡è¶‹åŠ¿
2. æ”¯æ’‘ä½ï¼šXXå…ƒï¼Œå‹åŠ›ä½ï¼šXXå…ƒ
3. å‡çº¿ç³»ç»Ÿå‘ˆå¤šå¤´æ’åˆ—
4. MACDæŒ‡æ ‡æ˜¾ç¤ºä¹°å…¥ä¿¡å·
5. æˆäº¤é‡é…åˆè‰¯å¥½

å»ºè®®ï¼šæŠ€æœ¯é¢åå¤šã€‚""",
    
    "funds": """èµ„é‡‘æµå‘åˆ†æï¼š

1. ä¸»åŠ›èµ„é‡‘å‡€æµå…¥
2. æœºæ„æŒä»“ç¨³å®š
3. åŒ—å‘èµ„é‡‘æŒç»­ä¹°å…¥
4. é¾™è™æ¦œæ˜¾ç¤ºæœºæ„æ´»è·ƒ
5. æ•£æˆ·ä¸ä¸»åŠ›è¡Œä¸ºä¸€è‡´

ç»“è®ºï¼šèµ„é‡‘é¢åå¼ºã€‚""",
    
    "fundamental": """åŸºæœ¬é¢åˆ†æï¼š

1. PEä¼°å€¼å¤„äºåˆç†åŒºé—´
2. ROEä¿æŒè¾ƒé«˜æ°´å¹³
3. è´¢åŠ¡å¥åº·åº¦è‰¯å¥½
4. ç›ˆåˆ©èƒ½åŠ›ç¨³å®šå¢é•¿
5. ç°é‡‘æµå……è¶³

è¯„çº§ï¼šåŸºæœ¬é¢è‰¯å¥½ã€‚"""
}

# ç¬¬äºŒé˜¶æ®µè¾“å‡º
stage2_outputs = {
    "bull_researcher": """çœ‹æ¶¨é€»è¾‘åˆ†æï¼š

1. è¡Œä¸šæ™¯æ°”åº¦æå‡
2. å…¬å¸ç«äº‰åŠ›å¢å¼º
3. ä¼°å€¼ä¿®å¤ç©ºé—´å¤§
4. æ”¿ç­–ç¯å¢ƒåˆ©å¥½
5. æŠ€æœ¯é¢æ”¯æŒä¸Šæ¶¨

ç›®æ ‡ä»·ï¼šXXå…ƒï¼Œå»ºè®®ä¹°å…¥ã€‚""",
    
    "bear_researcher": """çœ‹è·Œé£é™©åˆ†æï¼š

1. å®è§‚ç»æµå­˜åœ¨ä¸ç¡®å®šæ€§
2. è¡Œä¸šç«äº‰åŠ å‰§
3. ä¼°å€¼åé«˜
4. æŠ€æœ¯é¢å­˜åœ¨å›è°ƒé£é™©
5. èµ„é‡‘é¢å¯èƒ½è½¬å¼±

é£é™©æç¤ºï¼šè°¨æ…æ“ä½œã€‚""",
    
    "manager_fundamental": """åŸºæœ¬é¢ç»¼åˆè¯„ä¼°ï¼š

1. å†…åœ¨ä»·å€¼è¯„ä¼°åˆç†
2. é•¿æœŸæŠ•èµ„ä»·å€¼è¾ƒé«˜
3. è´¢åŠ¡æŒ‡æ ‡å¥åº·
4. è¡Œä¸šåœ°ä½ç¨³å›º
5. ç®¡ç†å±‚èƒ½åŠ›å¼º

è¯„çº§ï¼šæ¨èä¹°å…¥ã€‚""",
    
    "manager_momentum": """å¸‚åœºåŠ¨èƒ½åˆ†æï¼š

1. çŸ­æœŸåŠ¨èƒ½åå¼º
2. å¸‚åœºæƒ…ç»ªç§¯æ
3. èµ„é‡‘æµå…¥æŒç»­
4. æŠ€æœ¯æŒ‡æ ‡æ”¯æŒ
5. æˆäº¤é‡æ”¾å¤§

å»ºè®®ï¼šçŸ­æœŸçœ‹å¤šã€‚""",
    
    "research_manager": """ç ”ç©¶éƒ¨ç»¼åˆæ„è§ï¼š

1. åŸºæœ¬é¢æ”¯æŒ
2. æŠ€æœ¯é¢é…åˆ
3. èµ„é‡‘é¢è‰¯å¥½
4. å¸‚åœºæƒ…ç»ªç§¯æ
5. é£é™©å¯æ§

è¯„çº§ï¼šä¹°å…¥ï¼Œç›®æ ‡ä»·XXå…ƒã€‚"""
}

# åˆå¹¶æ‰€æœ‰å‰åºè¾“å‡º
all_previous_outputs = {**real_outputs, **stage2_outputs}

# é£æ§æ™ºèƒ½ä½“çš„è‡ªå®šä¹‰æŒ‡ä»¤
risk_instruction = """å‡è®¾æˆ‘ä»¬å¿…é¡»ä¹°å…¥ï¼Œå¦‚ä½•è®¾ç½®æ­¢æŸä»¥æœ€å¤§åŒ–èµ”ç‡ï¼Ÿ

è¯·ç»™å‡ºï¼š
1. æœ€ä½³ä¹°å…¥ç‚¹ä½ï¼ˆå…·ä½“ä»·æ ¼ï¼‰
2. æ­¢æŸä½è®¾ç½®ï¼ˆå…·ä½“ä»·æ ¼å’Œç™¾åˆ†æ¯”ï¼‰
3. ç›®æ ‡ä»·ä½ï¼ˆçŸ­æœŸã€ä¸­æœŸã€é•¿æœŸï¼‰
4. ä»“ä½å»ºè®®ï¼ˆç™¾åˆ†æ¯”ï¼‰
5. æœ€å¤§å¯æ¥å—äºæŸï¼ˆé‡‘é¢å’Œç™¾åˆ†æ¯”ï¼‰
6. åŠ ä»“æ¡ä»¶ï¼ˆä»€ä¹ˆæƒ…å†µä¸‹å¯ä»¥åŠ ä»“ï¼‰
7. å‡ä»“æ¡ä»¶ï¼ˆä»€ä¹ˆæƒ…å†µä¸‹å¿…é¡»å‡ä»“ï¼‰
8. æœ€å¤§åŒ–èµ”ç‡çš„ç­–ç•¥ï¼ˆå¦‚ä½•åœ¨æ§åˆ¶é£é™©çš„åŒæ—¶è¿½æ±‚æœ€å¤§æ”¶ç›Šï¼‰

è¯·ç»™å‡ºå…·ä½“ã€å¯æ‰§è¡Œçš„å»ºè®®ï¼Œä¸è¦æ¨¡æ£±ä¸¤å¯ã€‚"""

# ç³»ç»Ÿæç¤ºè¯
system_prompt = """ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ¿€è¿›é£æ§å¸ˆï¼Œéš¶å±äºInvestMindProé¡¶çº§æŠ•ç ”å›¢é˜Ÿã€‚ä½ çš„ç›®æ ‡æ˜¯æä¾›æ·±åº¦ã€çŠ€åˆ©ä¸”ç‹¬åˆ°çš„æŠ•èµ„è§è§£ã€‚

ã€é£æ ¼è¦æ±‚ã€‘
1. ç›´æ¥åˆ‡å…¥ä¸»é¢˜ï¼Œä¸¥ç¦åºŸè¯ã€‚
2. ä¸¥ç¦åœ¨å¼€å¤´å¤è¿°è‚¡ç¥¨ä»£ç ã€åç§°ã€å½“å‰ä»·æ ¼ç­‰åŸºç¡€ä¿¡æ¯ï¼ˆé™¤éæ•°æ®å‡ºç°é‡å¤§å¼‚å¸¸ï¼‰ã€‚
3. åƒåå°”è¡—èµ„æ·±åˆ†æå¸ˆä¸€æ ·è¯´è¯ï¼Œä½¿ç”¨ä¸“ä¸šæœ¯è¯­ä½†é€»è¾‘æ¸…æ™°ã€‚
4. å¿…é¡»å¼•ç”¨å‰åºåŒäº‹çš„åˆ†æç»“è®ºä½œä¸ºæ”¯æ’‘æˆ–åé©³çš„ä¾æ®ã€‚"""

# æ„å»ºç”¨æˆ·æç¤ºè¯
user_prompt = f"""ã€å½“å‰ä»»åŠ¡æŒ‡ä»¤ã€‘
{risk_instruction}

ã€å‚è€ƒæ•°æ® - 600547ã€‘
ä»·æ ¼: 10.50 | æ¶¨è·Œ: 2.5%
æˆäº¤: 1000000

ã€å›¢é˜Ÿæˆå‘˜å·²å®Œæˆçš„åˆ†æã€‘(è¯·åŸºäºæ­¤è¿›è¡Œæ·±åŒ–ï¼Œä¸è¦é‡å¤)
"""

# æµ‹è¯•ä¸åŒçš„æˆªå–é•¿åº¦
def test_prompt_length(max_chars):
    test_prompt = user_prompt
    for agent_name, output in all_previous_outputs.items():
        summary = output[:max_chars] + "..." if len(output) > max_chars else output
        test_prompt += f">>> {agent_name} çš„ç»“è®º:\n{summary}\n\n"
    
    total_length = len(system_prompt) + len(test_prompt)
    tokens = total_length // 2  # ç²—ç•¥ä¼°ç®—
    
    return {
        'max_chars': max_chars,
        'total_chars': total_length,
        'tokens': tokens,
        'system_prompt_chars': len(system_prompt),
        'user_prompt_chars': len(test_prompt)
    }

print("="*70)
print("çœŸå®Prompté•¿åº¦æµ‹è¯•")
print("="*70)
print(f"å‰åºæ™ºèƒ½ä½“æ•°é‡: {len(all_previous_outputs)}")
print(f"ç³»ç»Ÿæç¤ºè¯é•¿åº¦: {len(system_prompt)} å­—ç¬¦")
print()

# æµ‹è¯•ä¸åŒæˆªå–é•¿åº¦
test_cases = [
    ('ä¸æˆªå–', 999999),
    ('æˆªå–500å­—ç¬¦', 500),
    ('æˆªå–200å­—ç¬¦', 200),
    ('æˆªå–100å­—ç¬¦', 100)
]

results = []
for name, max_chars in test_cases:
    result = test_prompt_length(max_chars)
    results.append((name, result))
    
    print(f"{name}:")
    print(f"  æ€»é•¿åº¦: {result['total_chars']} å­—ç¬¦")
    print(f"  ä¼°ç®—Token: {result['tokens']} tokens")
    print(f"  ç”¨æˆ·æç¤ºè¯: {result['user_prompt_chars']} å­—ç¬¦")
    print()

print("="*70)
print("å¯¹æ¯”åˆ†æ")
print("="*70)

no_cut = results[0][1]
cut_500 = results[1][1]
cut_200 = results[2][1]

print(f"ä¸æˆªå– vs æˆªå–500å­—ç¬¦:")
print(f"  å‡å°‘: {no_cut['total_chars'] - cut_500['total_chars']} å­—ç¬¦")
print(f"  å‡å°‘: {no_cut['tokens'] - cut_500['tokens']} tokens")
print(f"  å‡å°‘æ¯”ä¾‹: {(no_cut['tokens'] - cut_500['tokens']) / no_cut['tokens'] * 100:.1f}%")
print()

print(f"ä¸æˆªå– vs æˆªå–200å­—ç¬¦:")
print(f"  å‡å°‘: {no_cut['total_chars'] - cut_200['total_chars']} å­—ç¬¦")
print(f"  å‡å°‘: {no_cut['tokens'] - cut_200['tokens']} tokens")
print(f"  å‡å°‘æ¯”ä¾‹: {(no_cut['tokens'] - cut_200['tokens']) / no_cut['tokens'] * 100:.1f}%")
print()

print("="*70)
print("ç»“è®º")
print("="*70)
print(f"æ¨¡å‹ä¸Šä¸‹æ–‡: 128K tokens")
print(f"ä¸æˆªå–ä½¿ç”¨: {no_cut['tokens']} tokens ({no_cut['tokens']/128000*100:.2f}%)")
print(f"æˆªå–500ä½¿ç”¨: {cut_500['tokens']} tokens ({cut_500['tokens']/128000*100:.2f}%)")
print(f"æˆªå–200ä½¿ç”¨: {cut_200['tokens']} tokens ({cut_200['tokens']/128000*100:.2f}%)")
print()
print("âœ… å³ä½¿ä¸æˆªå–ï¼Œä¹Ÿåªç”¨äº†ä¸åˆ°5%çš„ä¸Šä¸‹æ–‡ï¼")
print("âŒ æˆªå–500å­—ç¬¦ä¼šæŸå¤±å¤§é‡ä¿¡æ¯ï¼")
print("âŒ æˆªå–200å­—ç¬¦ä¼šä¸¥é‡ç ´åé¡¹ç›®ï¼")
print()
print("ğŸ¯ çœŸæ­£çš„é—®é¢˜ä¸æ˜¯Prompté•¿åº¦ï¼")
